!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Model=t()}(this,function(){"use strict";var l=function(){function t(){}return t.prototype.init=function(e,t){var n;for(var r in"string"==typeof e?(n={})[e]=t:n=e,n)if(n.hasOwnProperty(r)){var i=this.meta.type.property(r);if(!i)throw new Error('Could not find property "'+r+'" on type "'+this.meta.type.fullName+'".');i.value(this,t)}},t.prototype.set=function(e,t){var n;for(var r in"string"==typeof e?(n={})[e]=t:n=e,n)if(n.hasOwnProperty(r)){var i=this.meta.type.property(r);if(!i)throw new Error('Could not find property "'+r+'" on type "'+this.meta.type.fullName+'".');i.value(this,t)}},t.prototype.get=function(e){return this.meta.type.property(e).value(this)},t.prototype.toString=function(e){return t.toIdString(this)},t.toIdString=function(e){return e.meta.type.fullName+"|"+e.meta.id},t.fromIdString=function(e){var t=e.substring(0,e.indexOf("|")),n=e.substring(t.length+1);return U.getJsType(t).meta.get(n,!1)},t}(),a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var u=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.unsub=e,this.propagationStopped=!1}return e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}();t.EventManagement=n});e(u);u.EventManagement;var o=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}return e.prototype.execute=function(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;e?setTimeout(function(){r.apply(t,n)},1):r.apply(t,n)}},e}();t.Subscription=n});e(o);o.Subscription;var n=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._wrap=new i(this),this._subscriptions=new Array}return e.prototype.subscribe=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!1)),function(){t.unsubscribe(e)}},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.one=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!0)),function(){t.unsubscribe(e)}},e.prototype.has=function(t){return!!t&&this._subscriptions.some(function(e){return e.handler==t})},e.prototype.unsubscribe=function(e){if(e)for(var t=0;t<this._subscriptions.length;t++)if(this._subscriptions[t].handler==e){this._subscriptions.splice(t,1);break}},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype._dispatch=function(r,i,o){for(var s=this,e=function(e){var t=new u.EventManagement(function(){return s.unsub(e.handler)}),n=Array.prototype.slice.call(o);if(n.push(t),e.execute(r,i,n),a.cleanup(e),!r&&t.propagationStopped)return"break"},a=this,t=0,n=this._subscriptions.slice();t<n.length;t++){if("break"===e(n[t]))break}},e.prototype.cleanup=function(e){if(e.isOnce&&e.isExecuted){var t=this._subscriptions.indexOf(e);-1<t&&this._subscriptions.splice(t,1)}},e.prototype.asEvent=function(){return this._wrap},e.prototype.clear=function(){this._subscriptions.splice(0,this._subscriptions.length)},e}();t.DispatcherBase=n;var r=function(){function e(){this._events={}}return e.prototype.get=function(e){var t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t)},e.prototype.remove=function(e){delete this._events[e]},e}();t.EventListBase=r;var i=function(){function e(t){this._subscribe=function(e){return t.subscribe(e)},this._unsubscribe=function(e){return t.unsubscribe(e)},this._one=function(e){return t.one(e)},this._has=function(e){return t.has(e)},this._clear=function(){return t.clear()}}return e.prototype.subscribe=function(e){return this._subscribe(e)},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.unsubscribe=function(e){this._unsubscribe(e)},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype.one=function(e){return this._one(e)},e.prototype.has=function(e){return this._has(e)},e.prototype.clear=function(){this._clear()},e}();t.DispatcherWrapper=i});e(n);n.DispatcherBase,n.EventListBase,n.DispatcherWrapper;var p=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherBase=n.DispatcherBase,t.DispatcherWrapper=n.DispatcherWrapper,t.EventListBase=n.EventListBase,t.Subscription=o.Subscription});e(p);p.DispatcherBase,p.DispatcherWrapper,p.EventListBase,p.Subscription;var r=t(function(e,t){var r,n=a&&a.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.dispatch=function(e,t){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(e,t){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(p.DispatcherBase);t.EventDispatcher=i;var o=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.createDispatcher=function(){return new i},t}(p.EventListBase);t.EventList=o;var s=function(){function e(){this._events=new o}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e}();t.EventHandlingBase=s});e(r);r.EventDispatcher,r.EventList,r.EventHandlingBase;var i=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=r.EventDispatcher,t.EventHandlingBase=r.EventHandlingBase,t.EventList=r.EventList});e(i);var s=i.EventDispatcher;i.EventHandlingBase,i.EventList;function f(e,t){var n,r=t;return r.constructor===String?(n=r.split("."),r=window,n.forEach(function(e){if(void 0===(r=r[e]))throw new Error('Parent namespace "'+t+'" could not be found.')})):null==r&&(r=window),e in r?r[e]:r[e]={}}var c=/function\s*([\w_\$]*)/i;function h(e){var t=c.exec(e.toString());return t&&t[1]||"{anonymous}"}var d=/\s([a-z|A-Z]+)/;function y(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).match(d)[1].toLowerCase()}function v(e,t){void 0===e&&(e=0),void 0===t&&(t=9);var n=Math.random();return 1===n?t:Math.floor(n*(t-e+1))+e}var b={secrets:{}};function g(e,t,n,r,i){var o;if(void 0===t&&(t=8),void 0===n&&(n=!0),void 0===r&&(r=!1),void 0===i&&(i=null),b.secrets.hasOwnProperty(e))(o=b.secrets[e]).indexOf(i);else{var s="";if(n)s=function(e,t){void 0===t&&(t=!1);for(var n="",r=0;r<e;r++){var i,o=v(0,t?35:25);i=o<=25?o+97:o-26+48,n+=String.fromCharCode(i)}return n}(t,r);else if(r)for(var a=0;a<t;a++)s+=v(0,9).toString();o=i?i+s:s,b.secrets[e]=o}return o}var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function m(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var w=g("ObservableList.markerField",3,!1,!0,"_oL"),O=function(){function e(){}return e.add=function(e,t){var n=[t],r=Array.prototype.push.apply(e,n)-1;e._changedEvent.dispatch(e,{added:n,addedIndex:r,removed:[],removedIndex:-1})},e.remove=function(e,t){var n=Array.prototype.indexOf.call(e,t);if(-1!==n){var r=Array.prototype.splice.call(e,n,1);return e._changedEvent.dispatch(e,{added:[],addedIndex:-1,removed:r,removedIndex:n}),!0}},e}(),P=function(t){function e(e){return void 0===e&&(e=null),t.apply(this,e)||this}return m(e,t),e.isObservableList=function(e){return Object.prototype.hasOwnProperty.call(e,w)&&!0===e[w]},e._markObservable=function(e){Object.defineProperty(e,w,{configurable:!1,enumerable:!1,value:!0,writable:!1})},e.ensureObservable=function(e){return this.isObservableList(e)?e:j.implementObservableList(e)},e.create=function(e){void 0===e&&(e=null);var t=new j(e);return j.ensureObservable(t)},e}(Array),j=function(n){function r(e){void 0===e&&(e=null);var t=n.call(this,e)||this;return r._initFields(t),P._markObservable(t),t}return m(r,n),r._initFields=function(e,t){void 0===t&&(t=null),null==t&&(t=new s),Object.defineProperty(e,"_changedEvent",{configurable:!1,enumerable:!1,value:t,writable:!1})},r.implementObservableList=function(e){return r._initFields(e),e.add=function(e){O.add(this,e)},e.remove=function(e){return O.remove(this,e)},Object.defineProperty(e,"changed",{get:function(){return this._changedEvent.asEvent()}}),r._markObservable(e),e},r.prototype.add=function(e){O.add(this,e)},r.prototype.remove=function(e){return O.remove(this,e)},Object.defineProperty(r.prototype,"changed",{get:function(){return this._changedEvent.asEvent()},enumerable:!0,configurable:!0}),r}(P),E=g("Property.fieldNamePrefix",3,!1,!0,"_fN"),S=function(){this.changed=new s,this.accessed=new s},D=function(){function t(e,t,n,r,i,o,s,a,u,p,c,l){var f,h;void 0===c&&(c=void 0),void 0===l&&(l=e.originForNewProperties),Object.defineProperty(this,"containingType",{enumerable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,value:t}),Object.defineProperty(this,"jstype",{enumerable:!0,value:n}),Object.defineProperty(this,"isList",{enumerable:!0,value:!0===s}),Object.defineProperty(this,"isStatic",{enumerable:!0,value:!0===a}),this.helptext=i,this.isPersisted=u,this.isCalculated=p,r&&Object.defineProperty(this,"_label",{enumerable:!1,value:r,writable:!0}),o&&Object.defineProperty(this,"_format",{enumerable:!1,value:o,writable:!0}),l&&Object.defineProperty(this,"_origin",{enumerable:!1,value:e.originForNewProperties,writable:!0}),c&&Object.defineProperty(this,"_defaultValue",{enumerable:!1,value:c,writable:!0}),Object.defineProperty(this,"_eventDispatchers",{value:new S}),Object.defineProperty(this,"_getter",{value:(f=this,h=x,function(e){void 0===e&&(e=null);var t=h(f,this,e);return t})}),Object.defineProperty(this,"_setter",{value:function(n,r,i){void 0===i&&(i=!1);return function(e,t){void 0===t&&(t=null),r(n,this,e,t,i)}}(this,A)}),"client"===this.origin&&this.isPersisted}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return E+"_"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changedEvent",{get:function(){return this._eventDispatchers.changed.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessedEvent",{get:function(){return this._eventDispatchers.accessed.asEvent()},enumerable:!0,configurable:!0}),t.prototype.equals=function(e){if(null!=e&&e instanceof t)return this===e},t.prototype.toString=function(){return this.isStatic?this.getPath():"this<"+this.containingType+">."+this.name},t.prototype.isDefinedBy=function(e){return this.containingType===e||e.isSubclassOf(this.containingType)},Object.defineProperty(t.prototype,"label",{get:function(){return this._label||function(e){var t,n,r,i,o;for(r=e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),t=0,n=(i=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;t<n;t++)r=r.replace(new RegExp("\\s"+i[t]+"\\s","g"),function(e){return e.toLowerCase()});for(t=0,n=(o=["Id","Tv"]).length;t<n;t++)r=r.replace(new RegExp("\\b"+o[t]+"\\b","g"),o[t].toUpperCase());return r}(this.name.replace(/([^A-Z]+)([A-Z])/g,"$1 $2"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin?this._origin:this.containingType.origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultValue",{get:function(){return Object.prototype.hasOwnProperty.call(this,"_defaultValue")?this._defaultValue instanceof Array?this._defaultValue.slice():this._defaultValue instanceof Date?new Date(+this._defaultValue):this._defaultValue instanceof Function?this._defaultValue():this._defaultValue:(e=this.isList,t=this.jstype,e?[]:t!==Boolean&&(t===Number?0:null));var e,t},enumerable:!0,configurable:!0}),t.prototype.getPath=function(){return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t.prototype.canSetValue=function(e,t){if(void 0===t)return!0;if(null===t)return!0;if(t.constructor&&t.constructor.meta){for(var n=t.constructor.meta;n;n=n.baseType)if(n.jstype===this.jstype)return!0;return!1}var r=t.constructor;switch(y(t)){case"string":r=String;break;case"number":r=Number;break;case"boolean":r=Boolean;break;case"date":r=Date;break;case"array":r=Array}return r===this.jstype||r===Array&&this.isList&&t.every(function(e){if(e.constructor&&e.constructor.meta){for(var t=e.constructor.meta;t;t=t.baseType)if(t._jstype===this._jstype)return!0;return!1}},this)},t.prototype.value=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null);var r=this.isStatic?this.containingType.jstype:e;if(null==r)throw new Error("Cannot "+(1<arguments.length?"set":"get")+" value for "+(this.isStatic?"":"non-")+'static property "'+this.getPath()+'" on type "'+this.containingType.fullName+'": target is null or undefined.');if(!(1<arguments.length))return x(this,e);A(this,e,t,n)},t.prototype.rootedPath=function(e){if(this.isDefinedBy(e))return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t}();function T(e,t){Object.defineProperty(t,e.name,{configurable:!1,enumerable:!0,get:e._getter,set:e._setter})}function N(e,t){if(!t.hasOwnProperty(e.fieldName)&&!e.isCalculated){var n=e.isStatic?e.containingType.jstype:t,r=(a=e.defaultValue,Array.isArray(a)&&(a=P.ensureObservable(a)),a);Object.defineProperty(n,e.fieldName,{value:r,writable:!0}),Array.isArray(r)&&(i=t,o=e,(s=r).changed.subscribe(function(e,t){if(t.added&&0<t.added.length||t.removed&&0<t.removed.length){var n={property:o,newValue:s,oldValue:void 0};n.changes=[{newItems:t.added,oldItems:t.removed}],n.collectionChanged=!0,o._eventDispatchers.changed.dispatch(i,n)}}))}var i,o,s,a}function x(e,t){N(e,t);var n={property:e,value:t[e.fieldName]};return e._eventDispatchers.accessed.dispatch(t,n),t[e.fieldName]}function A(e,t,n,r,i){void 0===r&&(r=null),void 0===i&&(i=!1),N(e,t);var o=t[e.fieldName];(function(e,t,n,r,i){void 0===i&&(i=!1);if(!e.canSetValue(t,r))throw new Error("Cannot set "+e.name+"="+(void 0===r?"<undefined>":r)+" for instance "+t.meta.type.fullName+"|"+t.meta.id+": a value of type "+(e.jstype&&e.jstype.meta?e.jstype.meta.fullName:h(e.jstype))+" was expected.");{if(e.isList)throw new Error("Property set on lists is not permitted.");var o=null==n?n:n.valueOf(),s=null==r?r:r.valueOf();return o!==s&&!(e.jstype===Number&&isNaN(o)&&isNaN(s))}})(e,t,o,n,i)&&function(e,t,n,r,i){void 0===i&&(i=null);{if(e.isList)throw new Error("Property set on lists is not implemented.");if(t[e.fieldName]=r,void 0!==n){var o={property:e,newValue:r,oldValue:n};if(i)for(var s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);e._eventDispatchers.changed.dispatch(t,o)}}}(e,t,o,n,r)}var L=function(){function e(e,t,n,r){Object.defineProperty(this,"type",{enumerable:!0,value:e}),Object.defineProperty(this,"entity",{enumerable:!0,value:t}),Object.defineProperty(this,"_id",{enumerable:!1,value:n,writable:!0}),Object.defineProperty(this,"_isNew",{enumerable:!1,value:r,writable:!0})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legacyId",{get:function(){return this._legacyId},set:function(e){this._legacyId=e},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.type.unregister(this.entity);for(var e=this.type;e;e=e.baseType)e._eventDispatchers.destroy.dispatch(e,{entity:this.entity})},e}(),B="+c",I=function(){this.initNew=new s,this.initExisting=new s,this.destroy=new s},k=function(){function e(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r="client"),Object.defineProperty(this,"model",{enumerable:!0,value:e}),Object.defineProperty(this,"fullName",{enumerable:!0,value:t}),Object.defineProperty(this,"jstype",{enumerable:!0,value:function(o,e,t){void 0===t&&(t=null);var n=e.split("."),r=n.shift(),i=R,s=window;for(;0<n.length;)i=f(r,i),s=f(r,s),r=n.shift();var a=r;var u=new Function("construct","return function "+a+" () { construct.apply(this, arguments); }")(function(){if(!F)if(0<arguments.length&&null!=arguments[0]&&arguments[0].constructor===String){var e=arguments[0],t=arguments[1],n=arguments[2],r=o.get(e,!0);if(r)return t&&r.init(t),r;o.register(this,e,n),t&&this.init(t);for(var i=o;i;i=i.baseType)i._eventDispatchers.initExisting.dispatch(i,{entity:this})}else{var t=arguments[0],n=arguments[2];o.register(this,null,n),t&&this.set(t);for(var i=o;i;i=i.baseType)i._eventDispatchers.initNew.dispatch(i,{entity:this})}}),p=u;i[a]?i["$"+a]=p:i[a]=p;s[a]?s["$"+a]=p:s[a]=p;var c=null;c=c?t.jstype:l;return F=!0,u.prototype=new c,F=!1,u.prototype.constructor=u,Object.defineProperty(u,"meta",{enumerable:!1,value:o,configurable:!1,writable:!1}),u}(this,t,n)}),Object.defineProperty(this,"baseType",{enumerable:!0,value:n}),this.origin=r,this.originForNewProperties=this.origin,Object.defineProperty(this,"_counter",{enumerable:!1,value:0,writable:!0}),Object.defineProperty(this,"_pool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_legacyPool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_properties",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_derivedTypes",{enumerable:!1,value:[],writable:!1}),Object.defineProperty(this,"_eventDispatchers",{value:new I}),e._types[t]=this}return Object.defineProperty(e.prototype,"destroyEvent",{get:function(){return this._eventDispatchers.destroy.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initNewEvent",{get:function(){return this._eventDispatchers.initNew.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initExistingEvent",{get:function(){return this._eventDispatchers.initExisting.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"newIdPrefix",{get:function(){return B.substring(1)},set:function(e){if("string"!=typeof e)throw new TypeError("Property `Type.newIdPrefix` must be a string, found <"+typeof e+">");if(0===e.length)throw new Error("Property `Type.newIdPrefix` cannot be empty string");B="+"+e},enumerable:!0,configurable:!0}),e.prototype.newId=function(){for(var e,t=this;t;t=t.baseType)e=Math.max(e||0,t._counter);for(t=this;t;t=t.baseType)t._counter=e+1;return B+e},e.prototype.register=function(e,t,n){var r;void 0===n&&(n=!1),2===arguments.length&&C(this,t),t||(t=this.newId(),r=!0),Object.defineProperty(e,"meta",{value:new L(this,e,t,r),configurable:!1,enumerable:!1,writable:!1});for(var i=t.toLowerCase(),o=this;o;o=o.baseType){if(o._pool.hasOwnProperty(i))throw new Error('Object "'+this.fullName+"|"+t+'" has already been registered.');o._pool[i]=e,o._known&&o._known.add(e)}if(!0===this.model._settings.createOwnProperties)for(var s in this._properties)if(Object.prototype.hasOwnProperty.call(this._properties,s)){var a=this._properties[s];a.isStatic||T(a,e)}n||this.model._eventDispatchers.entityRegistered.dispatch(this.model,{entity:e})},e.prototype.changeObjectId=function(e,t){C(this,e),C(this,t);var n=e.toLowerCase(),r=t.toLowerCase(),i=this._pool[n];if(i){i.meta.legacyId=e;for(var o=this;o;o=o.baseType)o._pool[r]=i,delete o._pool[n],o._legacyPool[n]=i;return i.meta.id=t,i}},e.prototype.unregister=function(e){for(var t=this;t;t=t.baseType)delete t._pool[e.meta.id.toLowerCase()],e.meta.legacyId&&delete t._legacyPool[e.meta.legacyId.toLowerCase()],t._known&&t._known.remove(e);this.model._eventDispatchers.entityUnregistered.dispatch(this.model,{entity:e})},e.prototype.get=function(e,t){void 0===t&&(t=!1);var n=e.toLowerCase(),r=this._pool[n]||this._legacyPool[n];if(r&&!0===t&&r.meta.type!==this)throw new Error("The entity with id='"+e+"' is expected to be of type '"+this.fullName+"' but found type '"+r.meta.type.fullName+"'.");return r},e.prototype.known=function(){var e=this._known;if(!e){var t=[];for(var n in this._pool)Object.prototype.hasOwnProperty.call(this._pool,n)&&t.push(this._pool[n]);e=this._known=P.ensureObservable(t)}return e},e.prototype.addProperty=function(e,t,n,r,i){void 0===i&&(i={});var o,s,a=new D(this,e,t,i.label,i.helptext,i.format,n,r,i.isPersisted,i.isCalculated,i.defaultValue);if(function t(n,e,r,i){void 0===r&&(r=!0),void 0===i&&(i=null);var o="$"+n.name;Object.prototype.hasOwnProperty.call(e,o)&&!i||(e[o]=n),r&&(null==i&&(i=!1),n.containingType.derivedTypes.forEach(function(e){t(n,e,!0,i)}))}(this._properties[e]=a,a.containingType.jstype),a.isStatic)s=a,Object.defineProperty(s.containingType.jstype,s.name,{configurable:!1,enumerable:!0,get:s._getter,set:s._setter});else if(!0===this.model._settings.createOwnProperties)for(var u in this._pool)Object.prototype.hasOwnProperty.call(this._pool,u)&&T(a,this._pool[u]);else o=a,Object.defineProperty(o.containingType.jstype.prototype,o.name,{configurable:!1,enumerable:!0,get:o._getter,set:o._setter});return this.model._eventDispatchers.propertyAdded.dispatch(this.model,{property:a}),a},e.prototype.property=function(e){for(var t,n=this;n&&!t;n=n.baseType)if(t=n._properties[e])return t;return null},Object.defineProperty(e.prototype,"properties",{get:function(){for(var e=[],t=this;null!=t;t=t.baseType)for(var n in t._properties)t._properties.hasOwnProperty(n)&&e.push(t._properties[n]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"derivedTypes",{get:function(){return this._derivedTypes},enumerable:!0,configurable:!0}),e.prototype.isSubclassOf=function(t){var n=!1;return function(e,t,n,r){void 0===r&&(r=null);for(var i=e[t];null!=i;i=i[t])if(!1===n.call(r||e,i))return}(this,"baseType",function(e){if(e===t)return!(n=!0)}),n},e.prototype.toString=function(){return this.fullName},e}();function C(e,t){if(null==t)throw new Error("Id cannot be "+(null===t?"null":"undefined")+" (entity = "+e.fullName+").");if("string"!==y(t))throw new Error("Id must be a string:  encountered id "+t+' of type "'+h(t.constructor)+'" (entity = '+e.fullName+").");if(""===t)throw new Error("Id cannot be a blank string (entity = "+e.fullName+").")}var F=!1;var V=["Object","String","Number","Boolean","Date","TimeSpan","Array"],M={createOwnProperties:!1},W=function(){this.typeAdded=new s,this.entityRegistered=new s,this.entityUnregistered=new s,this.propertyAdded=new s},R={},U=function(){function e(e){void 0===e&&(e=void 0),Object.defineProperty(this,"_types",{value:{}}),Object.defineProperty(this,"_settings",{value:function(e){void 0===e&&(e=M.createOwnProperties);return{createOwnProperties:e}}(e)}),Object.defineProperty(this,"_eventDispatchers",{value:new W})}return Object.defineProperty(e.prototype,"typeAddedEvent",{get:function(){return this._eventDispatchers.typeAdded.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityRegisteredEvent",{get:function(){return this._eventDispatchers.entityRegistered.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityUnregisteredEvent",{get:function(){return this._eventDispatchers.entityUnregistered.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propertyAddedEvent",{get:function(){return this._eventDispatchers.propertyAdded.asEvent()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"types",{get:function(){var e=[];for(var t in this._types)this._types.hasOwnProperty(t)&&e.push(this._types[t]);return e},enumerable:!0,configurable:!0}),e.prototype.addType=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n="client");var r=new k(this,e,t,n);return this._types[e]=r,this._eventDispatchers.typeAdded.dispatch(this,{type:r}),r},e.getJsType=function(e,t){void 0===t&&(t=!1);var n=R,r=e.split(".");if(1===r.length&&-1<V.indexOf(e))return n[e];for(var i=0;i<r.length;i++){var o=r[i];if(void 0===(n=n[o])){if(t)return;throw new Error('The type "'+e+'" could not be found.  Failed on step "'+o+'".')}}return n},e}();var $=function(){function e(e){if(!e.hasOwnProperty("specifier")||"string"!=typeof e.specifier)throw new Error("Format specifier string must be provided.");this.specifier=e.specifier,this.convertFn=e.convert,this.convertBackFn=e.convertBack,this.description=e.description,this.nullString=e.nullString||"",this.undefinedString=e.undefinedString||"",this.formatEval=e.formatEval}return e.prototype.convert=function(e){return void 0===e?this.undefinedString:null===e?this.nullString:this.convertFn?this.convertFn(e):e},e.prototype.convertBack=function(e){return null===e||e==this.nullString?null:void 0!==e&&e!=this.undefinedString?e.constructor==String&&0===(e=e.trim()).length?null:this.convertBackFn?this.convertBackFn(e):e:void 0},e.prototype.toString=function(){return this.specifier},e}(),H=U;return H.Model=U,H.Type=k,H.Property=D,H.Entity=l,H.Format=$,H});
