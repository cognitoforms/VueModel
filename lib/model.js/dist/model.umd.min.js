!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Model={})}(this,function(e){"use strict";var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e,t){return e(t={exports:{}},t.exports),t.exports}var s=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.unsub=e,this.propagationStopped=!1}return e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}();t.EventManagement=r});t(s);s.EventManagement;var i=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}return e.prototype.execute=function(e,t,r){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var n=this.handler;e?setTimeout(function(){n.apply(t,r)},1):n.apply(t,r)}},e}();t.Subscription=r});t(i);i.Subscription;var n=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._wrap=new u(this),this._subscriptions=new Array}return e.prototype.subscribe=function(e){var t=this;return e&&this._subscriptions.push(new i.Subscription(e,!1)),function(){t.unsubscribe(e)}},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.one=function(e){var t=this;return e&&this._subscriptions.push(new i.Subscription(e,!0)),function(){t.unsubscribe(e)}},e.prototype.has=function(t){return!!t&&this._subscriptions.some(function(e){return e.handler==t})},e.prototype.unsubscribe=function(e){if(e)for(var t=0;t<this._subscriptions.length;t++)if(this._subscriptions[t].handler==e){this._subscriptions.splice(t,1);break}},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype._dispatch=function(n,u,i){for(var o=this,e=function(e){var t=new s.EventManagement(function(){return o.unsub(e.handler)}),r=Array.prototype.slice.call(i);if(r.push(t),e.execute(n,u,r),a.cleanup(e),!n&&t.propagationStopped)return"break"},a=this,t=0,r=this._subscriptions.slice();t<r.length;t++){if("break"===e(r[t]))break}},e.prototype.cleanup=function(e){if(e.isOnce&&e.isExecuted){var t=this._subscriptions.indexOf(e);-1<t&&this._subscriptions.splice(t,1)}},e.prototype.asEvent=function(){return this._wrap},e.prototype.clear=function(){this._subscriptions.splice(0,this._subscriptions.length)},e}();t.DispatcherBase=r;var n=function(){function e(){this._events={}}return e.prototype.get=function(e){var t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t)},e.prototype.remove=function(e){delete this._events[e]},e}();t.EventListBase=n;var u=function(){function e(t){this._subscribe=function(e){return t.subscribe(e)},this._unsubscribe=function(e){return t.unsubscribe(e)},this._one=function(e){return t.one(e)},this._has=function(e){return t.has(e)},this._clear=function(){return t.clear()}}return e.prototype.subscribe=function(e){return this._subscribe(e)},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.unsubscribe=function(e){this._unsubscribe(e)},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype.one=function(e){return this._one(e)},e.prototype.has=function(e){return this._has(e)},e.prototype.clear=function(){this._clear()},e}();t.DispatcherWrapper=u});t(n);n.DispatcherBase,n.EventListBase,n.DispatcherWrapper;var c=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherBase=n.DispatcherBase,t.DispatcherWrapper=n.DispatcherWrapper,t.EventListBase=n.EventListBase,t.Subscription=i.Subscription});t(c);c.DispatcherBase,c.DispatcherWrapper,c.EventListBase,c.Subscription;var u=r(function(e,t){var n,r=a&&a.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.dispatch=function(e,t){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(e,t){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(c.DispatcherBase);t.EventDispatcher=u;var i=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.createDispatcher=function(){return new u},t}(c.EventListBase);t.EventList=i;var o=function(){function e(){this._events=new i}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e}();t.EventHandlingBase=o});t(u);u.EventDispatcher,u.EventList,u.EventHandlingBase;var o=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=u.EventDispatcher,t.EventHandlingBase=u.EventHandlingBase,t.EventList=u.EventList});t(o);var f=o.EventDispatcher,p=(o.EventHandlingBase,o.EventList,function(){function e(e,t,r,n){Object.defineProperty(this,"type",{enumerable:!0,value:e}),Object.defineProperty(this,"entity",{enumerable:!0,value:t}),Object.defineProperty(this,"_id",{enumerable:!1,value:r,writable:!0}),Object.defineProperty(this,"_isNew",{enumerable:!1,value:n,writable:!0})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legacyId",{get:function(){return this._legacyId},set:function(e){this._legacyId=e},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.type.unregister(this.entity);for(var e=this.type;e;e=e.baseType)Te(e).destroyEvent.dispatch(e,{entity:this.entity})},e}());function l(e,t){var r,n=t;return n.constructor===String?(r=n.split("."),n=window,r.forEach(function(e){if(void 0===(n=n[e]))throw new Error('Parent namespace "'+t+'" could not be found.')})):null==n&&(n=window),e in n?n[e]:n[e]={}}var d=/function\s*([\w_\$]*)/i;function h(e){var t=d.exec(e.toString());return t&&t[1]||"{anonymous}"}var b=/\s([a-z|A-Z]+)/;function y(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).match(b)[1].toLowerCase()}function v(e,t){void 0===e&&(e=0),void 0===t&&(t=9);var r=Math.random();return 1===r?t:Math.floor(r*(t-e+1))+e}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _(e){return e._subscriptions}var m={secrets:{}};function w(e,t,r,n,u){var i;if(void 0===t&&(t=8),void 0===r&&(r=!0),void 0===n&&(n=!1),void 0===u&&(u=null),m.secrets.hasOwnProperty(e))(i=m.secrets[e]).indexOf(u);else{var o="";if(r)o=function(e,t){void 0===t&&(t=!1);for(var r="",n=0;n<e;n++){var u,i=v(0,t?35:25);u=i<=25?i+97:i-26+48,r+=String.fromCharCode(u)}return r}(t,n);else if(n)for(var a=0;a<t;a++)o+=v(0,9).toString();i=u?u+o:o,m.secrets[e]=i}return i}var E=function(e,t){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function P(e,t){function r(){this.constructor=e}E(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var O=w("ObservableList.markerField",3,!1,!0,"_oL"),j=function(){function e(){}return e.add=function(e,t){var r=[t],n=Array.prototype.push.apply(e,r)-1;e._changedEvent.dispatch(e,{added:r,addedIndex:n,removed:[],removedIndex:-1})},e.remove=function(e,t){var r=Array.prototype.indexOf.call(e,t);if(-1!==r){var n=Array.prototype.splice.call(e,r,1);return e._changedEvent.dispatch(e,{added:[],addedIndex:-1,removed:n,removedIndex:r}),!0}},e}(),T=function(t){function e(e){return void 0===e&&(e=null),t.apply(this,e)||this}return P(e,t),e.isObservableList=function(e){return Object.prototype.hasOwnProperty.call(e,O)&&!0===e[O]},e._markObservable=function(e){Object.defineProperty(e,O,{configurable:!1,enumerable:!1,value:!0,writable:!1})},e.ensureObservable=function(e){return this.isObservableList(e)?e:x.implementObservableList(e)},e.create=function(e){void 0===e&&(e=null);var t=new x(e);return x.ensureObservable(t)},e}(Array),x=function(r){function n(e){void 0===e&&(e=null);var t=r.call(this,e)||this;return n._initFields(t),T._markObservable(t),t}return P(n,r),n._initFields=function(e,t){void 0===t&&(t=null),null==t&&(t=new f),Object.defineProperty(e,"_changedEvent",{configurable:!1,enumerable:!1,value:t,writable:!1})},n.implementObservableList=function(e){return n._initFields(e),e.add=function(e){j.add(this,e)},e.remove=function(e){return j.remove(this,e)},Object.defineProperty(e,"changed",{get:function(){return this._changedEvent.asEvent()}}),n._markObservable(e),e},n.prototype.add=function(e){j.add(this,e)},n.prototype.remove=function(e){return j.remove(this,e)},Object.defineProperty(n.prototype,"changed",{get:function(){return this._changedEvent.asEvent()},enumerable:!0,configurable:!0}),n}(T);function A(e,u){void 0===e&&(e=null),void 0===u&&(u=!1);var i=[];e&&Array.prototype.push.apply(i,e.map(function(e){return I(e)}));var t=function(){var e;u&&(e=[]);for(var t=0;t<i.length;++t){var r=i[t];if(!0!==r.applied&&(!r.filter||!0===r.filter.apply(this,arguments))){!0===r.once&&(r.applied=!0);var n=r.fn.apply(this,arguments);e.push(n)}}if(u)return e};return t._funcs=i,t.add=S,t.remove=N,t.isEmpty=D,t.clear=F,t}function I(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n={fn:e};return null!=t&&(n.filter=t),null!=r&&(n.once=r),n}function S(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var n=I(e,t,r);this._funcs.push(n)}function N(e){for(var t=this._funcs.length-1;0<=t;--t)if(this._funcs[t].fn===e)return this._funcs.splice(t,1),!0;return!1}function D(t){return void 0===t&&(t=null),!this._funcs.some(function(e){return!0!==e.applied&&(!t||!e.filter||e.filter.apply(this,t))},this)}function F(){this._funcs.length=0}var C=null,V=!1,k=function(){function e(e){Object.defineProperty(this,"label",{enumerable:!0,value:e}),Object.defineProperty(this,"_waitForAll",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"_pending",{enumerable:!1,value:0,writable:!0})}return Object.defineProperty(e.prototype,"isActive",{get:function(){return 0<this._pending},enumerable:!0,configurable:!0}),e.prototype.pending=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var n=function(e,t,r,n){void 0===r&&(r=null);void 0===n&&(n=null);var u=!1;return function(){B("pending",r||this,function(){u||(u=!0,t&&t.apply(this,arguments),e.decrement())},0<arguments.length?Array.prototype.slice.call(arguments):null,n)}}(this,e,t,r);return this._pending++,n},e.prototype.waitForAll=function(e,t,r,n){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),e&&(0===this._pending?B("waitForAll",t,e,n,r):this._waitForAll.push({callback:e,thisPtr:t,executeImmediately:r,args:n}))},e.prototype.decrement=function(){for(--this._pending;0===this._pending&&0<this._waitForAll.length;){var e=this._waitForAll.shift();B("waitForAll",e.thisPtr,e.callback,e.args,e.executeImmediately)}},e}(),L=function n(u,i){void 0===i&&(i=null),window.setTimeout(function(){var e,t,r=("number"!==y(t=null)||isNaN(t),null);r&&C.length>r?(e=C.splice(0,r),n(u,i)):(e=C,C=null),e.forEach(function(e){return e.apply(u,i)})},1)};function B(e,t,r,n,u){if(void 0===n&&(n=null),void 0===u&&(u=null),!1===u||!0===V){var i=!1;null===C&&(C=[],i=!0),C.push(function(){r.apply(t,n||[])}),i&&L(t,n)}else r.apply(t,n||[])}var R=function(){this.changedEvent=new f,this.accessedEvent=new f},M=function(){function d(e,t,r){Object.defineProperty(this,"rootType",{enumerable:!0,value:e}),Object.defineProperty(this,"_properties",{value:t}),Object.defineProperty(this,"_propertyFilters",{value:r||new Array(t.length)}),Object.defineProperty(this,"_propertyAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_eventDispatchers",{value:new R})}return Object.defineProperty(d.prototype,"changedEvent",{get:function(){return this._eventDispatchers.changedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"accessedEvent",{get:function(){return this._eventDispatchers.accessedEvent.asEvent()},enumerable:!0,configurable:!0}),d.prototype.equals=function(e){if(null!=e){if(ye(e))return 1===this._properties.length&&this._properties[0]===e;if(e instanceof d){if(e._properties.length!==this._properties.length)return!1;for(var t=0;t<this._properties.length;t++)if(!this._properties[t].equals(e._properties[t]))return!1;return!0}}},d.prototype.forEach=function(e,t,r,n){if(void 0===r&&(r=null),void 0===n&&(n=null),null==e)throw new Error("Argument 'obj' cannot be null or undefined.");if(null==t)throw new Error("Argument 'callback' cannot be null or undefined.");if("function"!=typeof t)throw new Error("Argument 'callback' must be of type function: "+t+".");for(var u=arguments[4]||e,i=arguments[6]||null,o=this._properties.slice(arguments[5]||0),a=arguments[5]||0;a<this._properties.length;a++){var s=this._properties[a],c=a===this._properties.length-1||n&&i===n,f=!n||i===n;if(u instanceof Array){for(var p=0;p<u.length;++p)if(!this._propertyFilters||!this._propertyFilters[a]||this._propertyFilters[a](u[p])){if(f&&!1===t.call(r||this,u[p],p,u,s,a,o))return!1;if(!c){var l=s.value(u[p]);if(!l||!1===d.prototype.forEach.call(this,e,t,r,n,l,a+1,s))return!1}}return!0}if(this._propertyFilters&&this._propertyFilters[a]&&!1===this._propertyFilters[a](u))break;if(f&&!1===t.call(r||this,u,-1,null,s,a,o))return!1;if(c)break;if(null==(u=u[s.fieldName]))break;i=s}return!0},Object.defineProperty(d.prototype,"path",{get:function(){if(!this._path){var e=W(this,0);Object.defineProperty(this,"_path",{enumerable:!1,value:e,writable:!0})}return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"firstProperty",{get:function(){return this._properties[0]},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lastProperty",{get:function(){return this._properties[this._properties.length-1]},enumerable:!0,configurable:!0}),d.prototype.toPropertyArray=function(){return this._properties.slice()},d.prototype.getLastTarget=function(e){for(var t=0;t<this._properties.length-1;t++){var r=this._properties[t];if(null==e)return e;e=r.value(e)}return e},d.prototype.append=function(e){var t=this._properties.slice(),r=this._propertyFilters?this._propertyFilters.slice():new Array(this._properties.length);if(ye(e))t.push(e),r.push(null);else{if(!(e instanceof d))throw new Error("Method `IPropertyChain.append(prop)` expects an argument of type `IProperty` or `IPropertyChain`.");Array.prototype.push.apply(t,e._properties),Array.prototype.push.apply(r,e._propertyFilters||new Array(e._properties.length))}return new d(this.rootType,t,r)},d.prototype.prepend=function(e){var t,r,n;if(ye(e))t=this._properties.slice(),n=this._propertyFilters.slice(),r=e.containingType,t.splice(0,0,e),n.splice(0,0,null);else{if(!(e instanceof d))throw new Error("Method `IPropertyChain.prepend(prop)` expects an argument of type `IProperty` or `IPropertyChain`.");t=this._properties.slice(),n=this._propertyFilters.slice(),r=e._properties[0].containingType;var u=[0,0];Array.prototype.splice.apply(t,u.concat(e._properties)),Array.prototype.splice.apply(n,u.concat(e._propertyFilters||new Array(e._properties.length)))}return new d(r,t,n)},d.prototype.canSetValue=function(e,t){return this.lastProperty.canSetValue(this.getLastTarget(e),t)},d.prototype.testConnection=function(e,t,r){var n=!1;return r?(this.forEach(e,function(e){if(e===t)return!(n=!0)},this,r),n):e===t},d.prototype.getRootedPath=function(e){for(var t=0;t<this._properties.length;t++)if(e.hasModelProperty(this._properties[t])){var r=W(this,t);return this._properties[t].isStatic?this._properties[t].containingType.fullName+"."+r:r}},Object.defineProperty(d.prototype,"containingType",{get:function(){return this.rootType},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"propertyType",{get:function(){return this.lastProperty.propertyType},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"format",{get:function(){return this.lastProperty.format},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isList",{get:function(){return this.lastProperty.isList},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isStatic",{get:function(){return this.lastProperty.isStatic},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"label",{get:function(){return this.lastProperty.label},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"helptext",{get:function(){return this.lastProperty.helptext},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"name",{get:function(){return this.lastProperty.name},enumerable:!0,configurable:!0}),d.prototype.value=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null);var n=this.getLastTarget(e),u=this.lastProperty;if(1<arguments.length)u.value(n,t,r);else if(n)return u.value(n)},d.prototype.isInited=function(e,o){void 0===o&&(o=!1);var a=!0,s=[],t=arguments[2]||0,r=arguments[3]||null,n=this._properties.length-t;return d.prototype.forEach.call(this,e,function(e,t,r,n,u,i){return r&&o?(r.every(function(e){return this.isInited(e,!0,u,i[u-1])},this)?Array.prototype.push.apply(s,i.slice(u)):a=!1,!1):n.isInited(e)?void(r&&0!==t||s.push(n)):a=!1},this,null,e,t,r),a&&(!o||s.length===n)},d.prototype.toString=function(){if(this.isStatic)return this.path;var e=this._properties.map(function(e){return e.name}).join(".");return"this<"+this.containingType+">."+e},d}();function $(e){return e instanceof M}function H(e){return e._eventDispatchers}function U(o,a){var s=o,c=[],f=[],p=[],l=!!(3<=arguments.length&&arguments[2]&&arguments[2].constructor===Boolean)&&arguments[2],d=4<=arguments.length&&arguments[3]&&arguments[3]instanceof Function?arguments[3]:null,h=5<=arguments.length&&arguments[4]&&arguments[4]instanceof Function?arguments[4]:function(e){if(d)throw new Error(e)},b=function(){var e=a.steps.shift();if(!e)return h("Syntax error in property path: "+a.expression),null;var t=s.getProperty(e.property);if(!t)return h("Path '"+a.expression+"' references an unknown property: \""+s.fullName+"."+e.property+'".'),null;if(t.isStatic)return h("Path '"+a.expression+"' references a static property: \""+s.fullName+"."+e.property+'".'),null;if(c.push(t),e.cast){if(!(s=Le(e.cast,!0).meta))return h("Path '"+a.expression+"' references an invalid type: \""+e.cast+'".'),null;var r=s.ctor;p[c.length]=r,f[c.length]=function(e){return e instanceof r}}else s=t.propertyType.meta;if(0<a.steps.length)return ke(s,l,b);if(0===c.length)return h("IPropertyChain cannot be zero-length."),null;var n,u=new k("filterType"),i=p[c.length-1];return i&&ke(i.meta,l,u.pending(null,null,!0)),u.waitForAll(function(){var e=new M(o,c,f);d&&d(e),n=e},null,!0),n};return ke(s,l,b)}function W(e,t){var r,n=[],u=e.toPropertyArray();return u[t].isStatic&&n.push(u[t].containingType.fullName),u.slice(t).forEach(function(e,t){0!==t&&e.containingType!==r&&e.containingType.isSubclassOf(r)&&(n[n.length-1]=n[n.length-1]+"<"+e.containingType.fullName+">"),n.push(e.name),r=e.propertyType.meta}),n.join(".")}function G(a,u,i){var e=_(H(a).accessedEvent),t=e&&0<e.length,r=null!==i&&0<i.length;!t&&r&&(u.forEach(function(e,t){return i[t].unsubscribe()}),i.length=0),t&&!r&&(i.length=0,u.forEach(function(e,t){var o=0===t?void 0:u[t-1],r=function(e,t){return n=o,u=e,i=t,void(r=a).rootType.known().forEach(function(e){if(r.testConnection(e,u,n)){var t={property:i.property,value:i.value};t.originalSender=u,t.triggeredBy=t.property,H(t.property=r).accessedEvent.dispatch(e,t)}});var r,n,u,i},n=ge(e).accessedEvent.subscribe(r);i.push({handler:r,unsubscribe:n})},a))}function Z(a,u,i){void 0===u&&(u=null);var e=_(H(a).changedEvent),t=e&&0<e.length,r=null!==i&&0<i.length;!t&&r&&(u.forEach(function(e,t){return i[t].unsubscribe()}),i.length=0),t&&!r&&(i.length=0,u.forEach(function(e,t){var o=0===t?void 0:u[t-1],r=function(e,t){return n=o,u=e,i=t,void(r=a).rootType.known().forEach(function(e){if(r.testConnection(e,u,n)){var t={property:i.property,oldValue:i.oldValue,newValue:i.newValue};t.originalSender=u,t.triggeredBy=t.property,H(t.property=r).changedEvent.dispatch(e,t)}});var r,n,u,i},n=e.changedEvent.subscribe(r);i.push({handler:r,unsubscribe:n})},a))}var q,z,Q=function(){this.accessedEvent=new f,this.changedEvent=new f},J=function(){function e(){Object.defineProperty(this,"_eventDispatchers",{value:new Q})}return Object.defineProperty(e.prototype,"accessedEvent",{get:function(){return this._eventDispatchers.accessedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changedEvent",{get:function(){return this._eventDispatchers.changedEvent.asEvent()},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){var r;for(var n in"string"==typeof e?(r={})[e]=t:r=e,r)if(r.hasOwnProperty(n)){var u=this.meta.type.getProperty(n);if(!u)throw new Error('Could not find property "'+n+'" on type "'+this.meta.type.fullName+'".');u.value(this,t)}},e.prototype.set=function(e,t){var r;for(var n in"string"==typeof e?(r={})[e]=t:r=e,r)if(r.hasOwnProperty(n)){var u=this.meta.type.getProperty(n);if(!u)throw new Error('Could not find property "'+n+'" on type "'+this.meta.type.fullName+'".');u.value(this,t)}},e.prototype.get=function(e){return this.meta.type.getProperty(e).value(this)},e.prototype.toString=function(e){return(t=this).meta.type.fullName+"|"+t.meta.id;var t},e}();function K(e){return e._eventDispatchers}(z=q||(q={}))[z.InitExisting=2]="InitExisting",z[z.InitNew=4]="InitNew",z[z.PropertyGet=8]="PropertyGet",z[z.PropertyChanged=16]="PropertyChanged";var X=null,Y=function(){this.exitEvent=new f,this.abortEvent=new f},ee=function(){function e(){var e=X;Object.defineProperty(this,"parent",{enumerable:!0,value:e}),Object.defineProperty(this,"_isActive",{enumerable:!1,value:!0,writable:!0}),Object.defineProperty(this,"_eventDispatchers",{value:new Y}),X=this}return Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exitEvent",{get:function(){return this._eventDispatchers.exitEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"abortEvent",{get:function(){return this._eventDispatchers.abortEvent.asEvent()},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){if(void 0===e&&(e=!1),!this.isActive)throw new Error("The event scope cannot be aborted because it is not active.");try{this._eventDispatchers.abortEvent.dispatch(this,{maxNestingExceeded:e}),this._eventDispatchers.abortEvent.clear(),this._eventDispatchers.exitEvent.clear()}finally{if(this._isActive=!1,X&&X===this)for(;X&&!X.isActive;)X=X.parent}},e.prototype.exit=function(){var t=this;if(!this.isActive)throw new Error("The event scope cannot be exited because it is not active.");try{var e=_(this._eventDispatchers.exitEvent);if(e&&0<e.length){if(null!==this.parent&&this.parent.isActive){if(this.parent.hasOwnProperty("_exitEventVersion")&&99<=this.parent._exitEventVersion)return void this.abort(!0);e.forEach(function(e){e.isOnce&&e.isExecuted||t.parent._eventDispatchers.exitEvent.subscribe(e.handler)}),this.parent.hasOwnProperty("_exitEventVersion")&&this.parent._exitEventVersion++}else this._exitEventVersion=0,this._exitEventHandlerCount=e.length,this._eventDispatchers.exitEvent.dispatch(this,{}),delete this._exitEventHandlerCount,delete this._exitEventVersion;this._eventDispatchers.abortEvent.clear(),this._eventDispatchers.exitEvent.clear()}}finally{if(this._isActive=!1,X&&X===this)for(;X&&!X.isActive;)X=X.parent}},e}();function te(e,t){if(void 0===t&&(t=null),null===X)t?e.call(t):e();else{if(!X.isActive)throw new Error("The current event scope cannot be inactive.");X._eventDispatchers.exitEvent.subscribe(e.bind(t))}}function re(e,t){if(void 0===t&&(t=null),null!==X){if(!X.isActive)throw new Error("The current event scope cannot be inactive.");X._eventDispatchers.abortEvent.subscribe(e.bind(t))}}var ne=function(){function e(e){0<(e=(this.expression=e).replace(/<[^>]*>/gi,function(e){return e.replace(/\./gi,function(){return"$_$"})})).length?this.steps=e.split(".").map(function(e){var t=e.match(/^([_0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]+)(<([_$0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc$]+)>)?$/i);if(!t)return null;var r={property:null,cast:null};return r.property=t[1],t[3]&&(r.cast=t[3].replace(/\$_\$/gi,function(){return"."})),r}):this.steps=[]}return e.prototype.buildExpression=function(){var t="";return this.steps.forEach(function(e){t+=(t?".":"")+e.property+(e.cast?"<"+e.cast+">":"")}),t},e.prototype.toString=function(){return this.expression},e}();var ue=100,ie=0,oe=function(){function e(e,t,r,n){if(void 0===n&&(n=!1),this.invocationTypes=0,this.predicates=[],this.returnValues=[],this.rootType=e,this.name=t||(r?r.name:null)||e.fullName+".Custom."+ ++ie,r){var u=function(u){if(!u)return;var i={};return Object.keys(u).filter(function(e){var t=u[e];if("onInit"===e){if("boolean"==typeof t)return i.onInit=t,!0}else if("onInitNew"===e){if("boolean"==typeof t)return i.onInitNew=t,!0}else if("onInitExisting"===e){if("boolean"==typeof t)return i.onInitExisting=t,!0}else if("onChangeOf"===e){if(Array.isArray(t)){var r=null;return i.onChangeOf=t.filter(function(e){return!("string"!=typeof e&&!$(e)&&!ye(e)&&(r||(r=[]),r.push(e),1))}),!r||(u.onChangeOf=r,!1)}if("string"==typeof t)return i.onChangeOf=[t],!0;if($(t))return i.onChangeOf=[t],!0;if(ye(t))return i.onChangeOf=[t],!0}else if("returns"===e){if(Array.isArray(t)){var n=null;return i.returns=t.filter(function(e){return!("string"!=typeof e&&!$(e)&&!ye(e)&&(n||(n=[]),1))}),!n||(u.returns=n,!1)}if("string"==typeof t)return i.returns=[t],!0;if(ye(t))return i.returns=[t],!0}else{if("execute"!==e)return;if(t instanceof Function)return i.execute=t,!0}}).forEach(function(e){delete u[e]}),i}(r);u.onInit&&this.onInit(),u.onInitNew&&this.onInitNew(),u.onInitExisting&&this.onInitExisting(),u.onChangeOf&&this.onChangeOf(u.onChangeOf),u.returns&&this.returns(u.returns),u.execute instanceof Function&&(this.executeFn=u.execute)}n||e.model.registerRule(this)}return e.prototype.execute=function(e){this.executeFn&&this.executeFn(e)},e.prototype.onInitNew=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=q.InitNew,this},e.prototype.onInitExisting=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=q.InitExisting,this},e.prototype.onInit=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=q.InitNew|q.InitExisting,this},e.prototype.onChangeOf=function(e){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return e&&e.constructor===String&&(e=Array.prototype.slice.call(arguments)),this.predicates=0<this.predicates.length?this.predicates.concat(e):e,0==(this.invocationTypes&q.PropertyGet)&&(this.invocationTypes|=q.PropertyChanged),this},e.prototype.returns=function(e){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);if(e&&e.constructor===String&&(e=Array.prototype.slice.call(arguments)),!e)throw new Error("Rule must specify at least one property for returns.");return this.returnValues=0<this.returnValues.length?this.returnValues.concat(e):e,this.invocationTypes|=q.PropertyGet,this.invocationTypes&=~q.PropertyChanged,this},e.prototype.register=function(){if(this._registered)throw new Error("Rules cannot be registered more than once: "+this.name);Object.defineProperty(this,"_registered",{enumerable:!1,value:!0,writable:!1}),function(u,e){u.returnValues&&u.returnValues.forEach(function(e,t){ye(e)||(u.returnValues[t]=u.rootType.getProperty(e))});if(u.predicates){for(var i,o=null,t=function(e){var t,c,r=u.predicates[e];if("string"==typeof r){o||(o=new k("prepare rule predicates"));var n=e;(t=[r],c=[],t&&t.forEach(function(e){for(var t,r=ye(e)?e.name:$(e)?e.path:e,n=[],u=0,i=r.length,o=0;o<i;++o){var a=r.charAt(o);if("{"===a||","===a||"}"===a){var s=r.substring(u,o).trim();u=o+1,"{"===a?t?(n.push(t),t+="."+s):t=s:(0<s.length&&c.push(new ne(t?t+"."+s:s)),"}"===a&&(t=0===n.length?void 0:n.pop()))}}if(0<n.length)throw new Error("Unclosed '{' in path: "+e);0===u&&c.push(new ne(r.trim()))}),c).forEach(function(e){!function(e,t,n,r,u){void 0===t&&(t=null);void 0===n&&(n=!1);void 0===u&&(u=null);var i,o,a,s=null,c=null;if(e.constructor===ne)s=(c=e).expression;else{if("string"!=typeof e)throw new Error("Invalid valud for argument `pathOrTokens`.");s=e}if(t&&t._chains&&t._chains[s])return r?r.call(u||this,t._chains[s]):t._chains[s];c||(c=new ne(s));i=t instanceof Function?t.meta:t,"this"===c.steps[0].property&&c.steps[0].cast&&(i=Le(c.steps[0].cast,!1).meta,c.steps.shift());if(o=function(e,t,r){ke(e,n,function(){r.call(u||this,e.getProperty(t))})},1===c.steps.length){if(a=c.steps[0].property,!r)return i.property(a);o(i,a,r)}else{var f=c.steps.slice(0,c.steps.length-1).map(function(e){return e.property}).join("."),p=c.steps[c.steps.length-1].property,l=(Array.prototype.slice.call(arguments),function(e){if(!(i=Le(f,!0)))throw new Error(e||'Error getting type "'+f+'".');if(i=i.meta,!r)return i.getProperty(p);o(i,p,r)});if(!r)return U.call(null,i,c,n)||l(null);U.call(null,i,c,n,u?r.bind(u):r,l)}}(e,u.rootType,!1,o.pending(function(e){u.predicates[n]=e},this,!0),this)},a)}else ye(r)&&!$(r)||u.predicates.splice(e--,1);i=e},a=this,r=0;r<u.predicates.length;r++)t(r),r=i;o?o.waitForAll(e,this,!0,[u]):e(u)}}(this,fe)},e}();function ae(e,t,r){var n;void 0===r&&(r=null),Object.prototype.hasOwnProperty.call(e,"_pendingInvocation")?n=e._pendingInvocation:Object.defineProperty(e,"_pendingInvocation",{enumerable:!1,value:n=[],writable:!0});var u=n.indexOf(t);if(!(2<arguments.length))return 0<=u;r&&u<0?n.push(t):!r&&0<=u&&n.splice(u,1)}function se(e,t,r){return t instanceof e.rootType.ctor}function ce(r,n,u){se(r,n)&&function(e,t){void 0===t&&(t=null);var r=new ee;try{t?e.call(t):e()}finally{r.exit()}}(function(){if(X.parent){var e,t=X.parent;if(t._exitEventVersion)if(e=ue-1,t._exitEventVersion>e)return}r.execute.call(r,n,u)})}function fe(u){u.invocationTypes&q.InitNew&&u.rootType.initNewEvent.subscribe(function(e,t){return ce(u,t.entity,t)}),u.invocationTypes&q.InitExisting&&u.rootType.initExistingEvent.subscribe(function(e,t){return ce(u,t.entity,t)}),u.invocationTypes&q.PropertyChanged&&u.predicates.forEach(function(e){Pe(e,function(e,t){se(u,e)&&!ae(e.meta,u)&&(ae(e.meta,u,!0),te(function(){ae(e.meta,u,!1),ce(u,e,t)}),re(function(){ae(e.meta,u,!1)}))},null,!0)}),u.invocationTypes&q.PropertyGet&&u.returnValues&&(u.returnValues.forEach(function(r){!function(e,t,r,n){void 0===r&&(r=null);void 0===n&&(n=!1);{if(e instanceof he)return function(e,t,r){void 0===r&&(r=null);var n,u=e,i=null;if(r){var o=t;t=function(e,t){e===r&&o(e,t)},i=r}n=u._eventDispatchers.accessedEvent.subscribe(t),u._propertyAccessSubscriptions.push({handler:t,sender:i,unsubscribe:n})}(e,t,r);if($(e))return function(t,r,n,e){void 0===n&&(n=null);var u=A(null,!0);n&&u.add(function(e){return e===n}),u.add(function(e){return t.isInited(e,!0)}),G(t,t._properties,t._propertyAccessSubscriptions),H(t).accessedEvent.subscribe(function(e,t){u(e).some(function(e){return!e})||r(e,t)})}(e,t,r);throw new Error("Invalid property passed to `Property$addAccessed(prop)`.")}}(r,function(e,t){se(u,e)&&_e(e.meta,r)&&(_e(e.meta,r,!1),ce(u,e,t))})}),u.predicates.forEach(function(e){Pe(e,function(n,e){u.returnValues.some(function(e){return t=n,0<(r=e._propertyChangeSubscriptions).length&&r.some(function(e){return e.sender===t});var t,r})?se(u,n)&&!ae(n.meta,u)&&(ae(n.meta,u,!0),te(function(){ae(n.meta,u,!1),ce(u,n,e)}),re(function(){ae(n.meta,u,!1)})):(u.returnValues.forEach(function(e){_e(n.meta,e,!0)}),te(function(){u.returnValues.forEach(function(e){K(n).changedEvent.dispatch(e,{entity:n,property:e})})}))},null,!0)})),u.onRegister instanceof Function&&u.onRegister()}function pe(e){(function(e){var t,r=e;r._rules?t=r._rules:(t=[],Object.defineProperty(r,"_rules",{enumerable:!1,value:t,writable:!1}));return t})(e.property).push(e);var t=ge(e.property),r=_(t.ruleRegisteredEvent);r&&0<r.length&&t.ruleRegisteredEvent.dispatch(e,{property:e.property,rule:e})}var le=function(c){function e(e,t,r,n){void 0===n&&(n=!1);var u,i,o=this,a=void 0;if(t||(t=r.name),r){var s=function(r){if(!r)return;var n={};Object.keys(r).filter(function(e){var t=r[e];if("property"===e){if(ye(t))return n.property=t,!0}else{if("calculate"!==e&&"fn"!==e)return"defaultIfError"===e?(n.defaultIfError=t,!0):void 0;if(t instanceof Function)return n.calculate=t,!0;if("string"==typeof t)return n.calculate=t,!0}}).forEach(function(e){delete r[e]});return n}(r);s.property&&(u=ye(s.property)?s.property:e.getProperty(s.property),r.returns=[s.property]),t||(t=r.name=e.fullName+"."+("string"==typeof u?u:u.name)+".Calculated"),a=s.defaultIfError,i=s.calculate}return o=c.call(this,e,t,r,!0)||this,Object.defineProperty(o,"property",{enumerable:!0,value:u}),o.defaultIfError=a,i&&Object.defineProperty(o,"_calculateFn",{enumerable:!1,value:i,writable:!0}),n||e.model.registerRule(o),o}return P(e,c),e.prototype.execute=function(e){var t,r;if(this._calculateFn.constructor===String){var n=this._calculateFn,u=new Function("return "+n+";");t=this._calculateFn=u}else t=this._calculateFn;if(void 0===this.defaultIfError)r=t.call(e);else try{r=t.apply(e)}catch(e){r=this.defaultIfError}if(void 0!==r){if(this.property.isList){var i=r,o=this.property.value(e);if(i.length===o.length){for(var a=!0,s=0;s<i.length;++s)if(i[s]!==o[s]){a=!1;break}if(a)return}throw new Error("Calculated list properties are not yet implemented.")}this.property.value(e,r,{calculated:!0})}},e.prototype.toString=function(){return"calculation of "+this.property.name},e.prototype.onRegister=function(){pe(this),this.property.isCalculated=!0},e}(oe);var de=w("Property.fieldNamePrefix",3,!1,!0,"_fN"),he=function(){function t(e,t,r,n,u,i,o,a,s,c,f,p){var l,d;void 0===f&&(f=void 0),void 0===p&&(p=e.originForNewProperties),Object.defineProperty(this,"containingType",{enumerable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,value:t}),Object.defineProperty(this,"propertyType",{enumerable:!0,value:r}),Object.defineProperty(this,"isList",{enumerable:!0,value:!0===o}),Object.defineProperty(this,"isStatic",{enumerable:!0,value:!0===a}),this.helptext=u,this.isPersisted=s,this.isCalculated=c,n&&Object.defineProperty(this,"_label",{enumerable:!1,value:n,writable:!0}),i&&Object.defineProperty(this,"_format",{enumerable:!1,value:i,writable:!0}),p&&Object.defineProperty(this,"_origin",{enumerable:!1,value:e.originForNewProperties,writable:!0}),f&&Object.defineProperty(this,"_defaultValue",{enumerable:!1,value:f,writable:!0}),Object.defineProperty(this,"_propertyAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_eventDispatchers",{value:new be}),Object.defineProperty(this,"getter",{value:(l=this,d=we,function(e){void 0===e&&(e=null);var t=d(l,this,e);return t})}),Object.defineProperty(this,"setter",{value:function(r,n,u){void 0===u&&(u=!1);return function(e,t){void 0===t&&(t=null),n(r,this,e,t,u)}}(this,Ee)}),"client"===this.origin&&this.isPersisted}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return de+"_"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changedEvent",{get:function(){return this._eventDispatchers.changedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessedEvent",{get:function(){return this._eventDispatchers.accessedEvent.asEvent()},enumerable:!0,configurable:!0}),t.prototype.equals=function(e){if(null!=e)return $(e)?e.equals(this):e instanceof t?this===e:void 0},t.prototype.toString=function(){return this.isStatic?this.getPath():"this<"+this.containingType+">."+this.name},Object.defineProperty(t.prototype,"label",{get:function(){return this._label||function(e){var t,r,n,u,i;for(n=e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),t=0,r=(u=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;t<r;t++)n=n.replace(new RegExp("\\s"+u[t]+"\\s","g"),function(e){return e.toLowerCase()});for(t=0,r=(i=["Id","Tv"]).length;t<r;t++)n=n.replace(new RegExp("\\b"+i[t]+"\\b","g"),i[t].toUpperCase());return n}(this.name.replace(/([^A-Z]+)([A-Z])/g,"$1 $2"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin?this._origin:this.containingType.origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultValue",{get:function(){return Object.prototype.hasOwnProperty.call(this,"_defaultValue")?this._defaultValue instanceof Array?this._defaultValue.slice():this._defaultValue instanceof Date?new Date(+this._defaultValue):this._defaultValue instanceof Function?this._defaultValue():this._defaultValue:(e=this.isList,t=this.propertyType,e?[]:t!==Boolean&&(t===Number?0:null));var e,t},enumerable:!0,configurable:!0}),t.prototype.getPath=function(){return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t.prototype.canSetValue=function(e,t){if(void 0===t)return!0;if(null===t)return!0;if(t.constructor&&t.constructor.meta){for(var r=t.constructor.meta;r;r=r.baseType)if(r.ctor===this.propertyType)return!0;return!1}var n=t.constructor;switch(y(t)){case"string":n=String;break;case"number":n=Number;break;case"boolean":n=Boolean;break;case"date":n=Date;break;case"array":n=Array}return n===this.propertyType||n===Array&&this.isList&&t.every(function(e){if(e.constructor&&e.constructor.meta){for(var t=e.constructor.meta;t;t=t.baseType)if(t._jstype===this._jstype)return!0;return!1}},this)},t.prototype.value=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null);var n=this.isStatic?this.containingType.ctor:e;if(null==n)throw new Error("Cannot "+(1<arguments.length?"set":"get")+" value for "+(this.isStatic?"":"non-")+'static property "'+this.getPath()+'" on type "'+this.containingType.fullName+'": target is null or undefined.');if(!(1<arguments.length))return we(this,e);Ee(this,e,t,r)},t.prototype.isInited=function(e){return!!(this.isStatic?this.containingType.ctor:e).hasOwnProperty(this.fieldName)},t.prototype.calculated=function(e){var t,r,n,u,i=this.containingType;e.rootType&&(i=e.rootType,delete e.rootType),e.property=this,t=i,r=this,(n=e)&&(u=n instanceof Function?{calculate:n}:n),u.property=r,new le(t,u.name,u)},t}(),be=function(){this.changedEvent=new f,this.accessedEvent=new f,this.ruleRegisteredEvent=new f};function ye(e){return e instanceof he}function ve(e,t){Object.defineProperty(t,e.name,{configurable:!1,enumerable:!0,get:e.getter,set:e.setter})}function ge(e){return e._eventDispatchers}function _e(e,t,r){var n;if(void 0===r&&(r=null),Object.prototype.hasOwnProperty.call(e,"_pendingInit")?n=e._pendingInit:Object.defineProperty(e,"_pendingInit",{enumerable:!1,value:n={},writable:!0}),!(2<arguments.length)){var u=void 0;return e instanceof je?u=e.ctor:e instanceof p&&(u=e.entity),void 0===u[t.fieldName]||!0===n[t.name]}!1===r?delete n[t.name]:n[t.name]=r}function me(e,t){var n,u,i,r,o=e.isStatic?e.containingType.ctor:t;if(!t.hasOwnProperty(e.fieldName)){if(!e.isCalculated){_e(o.meta,e,!1);var a=(r=e.defaultValue,Array.isArray(r)&&(r=T.ensureObservable(r)),r);Object.defineProperty(o,e.fieldName,{value:a,writable:!0}),Array.isArray(a)&&(n=t,u=e,(i=a).changed.subscribe(function(e,t){if(t.added&&0<t.added.length||t.removed&&0<t.removed.length){var r={property:u,newValue:i,oldValue:void 0};r.changes=[{newItems:t.added,oldItems:t.removed}],r.collectionChanged=!0,ge(u).changedEvent.dispatch(n,r),K(n).changedEvent.dispatch(u,{entity:n,property:u})}})),K(t).changedEvent.dispatch(e,{entity:t,property:e})}_e(o.meta,e,!0)}}function we(e,t){return me(e,t),ge(e).accessedEvent.dispatch(t,{property:e,value:t[e.fieldName]}),K(t).accessedEvent.dispatch(e,{entity:t,property:e}),t[e.fieldName]}function Ee(e,t,r,n,u){void 0===n&&(n=null),void 0===u&&(u=!1),me(e,t);var i=t[e.fieldName];(function(e,t,r,n,u){void 0===u&&(u=!1);if(!e.canSetValue(t,n))throw new Error("Cannot set "+e.name+"="+(void 0===n?"<undefined>":n)+" for instance "+t.meta.type.fullName+"|"+t.meta.id+": a value of type "+(e.propertyType&&e.propertyType.meta?e.propertyType.meta.fullName:h(e.propertyType))+" was expected.");{if(e.isList)throw new Error("Property set on lists is not permitted.");var i=null==r?r:r.valueOf(),o=null==n?n:n.valueOf();return i!==o&&!(e.propertyType===Number&&isNaN(i)&&isNaN(o))}})(e,t,i,r,u)&&function(e,t,r,n,u){void 0===u&&(u=null);{if(e.isList)throw new Error("Property set on lists is not implemented.");if(t.hasOwnProperty(e.fieldName)?t[e.fieldName]=n:Object.defineProperty(t,e.fieldName,{value:n,writable:!0}),_e(t.meta,e,!1),void 0!==r){var i={property:e,newValue:n,oldValue:r};ge(e).changedEvent.dispatch(t,u?function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n={};for(var u in e)g(e,u)&&(n[u]=e[u]);for(var i=0;i<t.length;i++){var o=t[i];for(var u in o)g(o,u)&&(n[u]=o[u])}return n}(i,u):i),K(t).changedEvent.dispatch(e,{entity:t,property:e})}}}(e,t,i,r,n)}function Pe(e,t,r,n){if(void 0===r&&(r=null),void 0===n&&(n=!1),e instanceof he)return function(e,t,r){void 0===r&&(r=null);var n,u=null;if(r){var i=t;t=function(e,t){e===r&&i(e,t)},u=r}return n=e._eventDispatchers.changedEvent.subscribe(t),e._propertyChangeSubscriptions.push({handler:t,sender:u,unsubscribe:n}),n}(e,t,r);if($(e))return function(t,r,n,e){void 0===n&&(n=null);var u=A(null,!0);return n&&u.add(function(e){return e===n}),u.add(function(e){return t.isInited(e,!0)}),Z(t,t._properties,t._propertyChangeSubscriptions),H(t).changedEvent.subscribe(function(e,t){u(e).some(function(e){return!e})||r(e,t)})}(e,t,r);throw new Error("Invalid property passed to `Property$addChanged(prop)`.")}var Oe=function(){this.initNewEvent=new f,this.initExistingEvent=new f,this.destroyEvent=new f},je=function(){function e(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n="client"),Object.defineProperty(this,"model",{enumerable:!0,value:e}),Object.defineProperty(this,"fullName",{enumerable:!0,value:t}),Object.defineProperty(this,"ctor",{enumerable:!0,value:function(i,e,t){void 0===t&&(t=null);var r=e.split("."),n=r.shift(),u=Fe,o=window;for(;0<r.length;)u=l(n,u),o=l(n,o),n=r.shift();var a=n;var s=new Function("construct","return function "+a+" () { construct.apply(this, arguments); }")(function(){if(!Ae)if(0<arguments.length&&null!=arguments[0]&&arguments[0].constructor===String){var e=arguments[0],t=arguments[1],r=arguments[2],n=i.get(e,!0);if(n)return t&&n.init(t),n;i.register(this,e,r),t&&this.init(t);for(var u=i;u;u=u.baseType)u._eventDispatchers.initExistingEvent.dispatch(u,{entity:this})}else{var t=arguments[0],r=arguments[2];i.register(this,null,r),t&&this.set(t);for(var u=i;u;u=u.baseType)Te(u).initNewEvent.dispatch(u,{entity:this})}});u[a]?u["$"+a]=s:u[a]=s;o[a]?o["$"+a]=s:o[a]=s;var c=null;c=c?t.ctor:J;return Ae=!0,s.prototype=new c,Ae=!1,s.prototype.constructor=s,Object.defineProperty(s,"meta",{enumerable:!1,value:i,configurable:!1,writable:!1}),s}(this,t,r)}),Object.defineProperty(this,"baseType",{enumerable:!0,value:r}),this.origin=n,this.originForNewProperties=this.origin,Object.defineProperty(this,"_lastId",{enumerable:!1,value:0,writable:!0}),Object.defineProperty(this,"_pool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_legacyPool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_properties",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_derivedTypes",{enumerable:!1,value:[],writable:!1}),Object.defineProperty(this,"_eventDispatchers",{value:new Oe})}return Object.defineProperty(e.prototype,"destroyEvent",{get:function(){return this._eventDispatchers.destroyEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initNewEvent",{get:function(){return this._eventDispatchers.initNewEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initExistingEvent",{get:function(){return this._eventDispatchers.initExistingEvent.asEvent()},enumerable:!0,configurable:!0}),e.prototype.newId=function(){for(var e,t=this;t;t=t.baseType)e=Math.max(e||0,t._lastId);var r=e+1;for(t=this;t;t=t.baseType)t._lastId=r;return"+c"+r},e.prototype.register=function(e,t,r){var n;void 0===r&&(r=!1),2===arguments.length&&xe(this,t),t||(t=this.newId(),n=!0),Object.defineProperty(e,"meta",{value:new p(this,e,t,n),configurable:!1,enumerable:!1,writable:!1});for(var u=t.toLowerCase(),i=this;i;i=i.baseType){if(i._pool.hasOwnProperty(u))throw new Error('Object "'+this.fullName+"|"+t+'" has already been registered.');i._pool[u]=e,i._known&&i._known.add(e)}if(!0===this.model.settings.createOwnProperties)for(var o in this._properties)if(Object.prototype.hasOwnProperty.call(this._properties,o)){var a=this._properties[o];a.isStatic||ve(a,e)}r||Ve(this.model).entityRegisteredEvent.dispatch(this.model,{entity:e})},e.prototype.changeObjectId=function(e,t){xe(this,e),xe(this,t);var r=e.toLowerCase(),n=t.toLowerCase(),u=this._pool[r];if(u){u.meta.legacyId=e;for(var i=this;i;i=i.baseType)i._pool[n]=u,delete i._pool[r],i._legacyPool[r]=u;return u.meta.id=t,u}},e.prototype.unregister=function(e){for(var t=this;t;t=t.baseType)delete t._pool[e.meta.id.toLowerCase()],e.meta.legacyId&&delete t._legacyPool[e.meta.legacyId.toLowerCase()],t._known&&t._known.remove(e);Ve(this.model).entityUnregisteredEvent.dispatch(this.model,{entity:e})},e.prototype.get=function(e,t){if(void 0===t&&(t=!1),!e)throw new Error('Method "'+this.fullName+'.meta.get()" was called without a valid id argument.');var r=e.toLowerCase(),n=this._pool[r]||this._legacyPool[r];if(n&&!0===t&&n.meta.type!==this)throw new Error("The entity with id='"+e+"' is expected to be of type '"+this.fullName+"' but found type '"+n.meta.type.fullName+"'.");return n},e.prototype.known=function(){var e=this._known;if(!e){var t=[];for(var r in this._pool)Object.prototype.hasOwnProperty.call(this._pool,r)&&t.push(this._pool[r]);e=this._known=T.ensureObservable(t)}return e},e.prototype.addProperty=function(e,t,r,n,u){void 0===u&&(u={});var i,o,a=new he(this,e,t,u.label,u.helptext,u.format,r,n,u.isPersisted,u.isCalculated,u.defaultValue);if(function t(r,e,n,u){void 0===n&&(n=!0),void 0===u&&(u=null);var i="$"+r.name;Object.prototype.hasOwnProperty.call(e,i)&&!u||(e[i]=r),n&&(null==u&&(u=!1),r.containingType.derivedTypes.forEach(function(e){t(r,e,!0,u)}))}(this._properties[e]=a,a.containingType.ctor),a.isStatic)o=a,Object.defineProperty(o.containingType.ctor,o.name,{configurable:!1,enumerable:!0,get:o.getter,set:o.setter});else if(!0===this.model.settings.createOwnProperties)for(var s in this._pool)Object.prototype.hasOwnProperty.call(this._pool,s)&&ve(a,this._pool[s]);else i=a,Object.defineProperty(i.containingType.ctor.prototype,i.name,{configurable:!1,enumerable:!0,get:i.getter,set:i.setter});return Ve(this.model).propertyAddedEvent.dispatch(this.model,{property:a}),a},e.prototype.getProperty=function(e){for(var t,r=this;r&&!t;r=r.baseType)if(t=r._properties[e])return t;return null},Object.defineProperty(e.prototype,"properties",{get:function(){for(var e=[],t=this;null!=t;t=t.baseType)for(var r in t._properties)t._properties.hasOwnProperty(r)&&e.push(t._properties[r]);return e},enumerable:!0,configurable:!0}),e.prototype.addRule=function(e){var t,r;return(t=e)&&(r=t instanceof Function?{execute:t}:t),new oe(this,r.name,r)},Object.defineProperty(e.prototype,"derivedTypes",{get:function(){return this._derivedTypes},enumerable:!0,configurable:!0}),e.prototype.hasModelProperty=function(e){return e.containingType===this||this.isSubclassOf(e.containingType)},e.prototype.isSubclassOf=function(t){var r=!1;return function(e,t,r,n){void 0===n&&(n=null);for(var u=e[t];null!=u;u=u[t])if(!1===r.call(n||e,u))return}(this,"baseType",function(e){if(e===t)return!(r=!0)}),r},e.prototype.toString=function(){return this.fullName},e}();function Te(e){return e._eventDispatchers}function xe(e,t){if(null==t)throw new Error("Id cannot be "+(null===t?"null":"undefined")+" (entity = "+e.fullName+").");if("string"!==y(t))throw new Error("Id must be a string:  encountered id "+t+' of type "'+h(t.constructor)+'" (entity = '+e.fullName+").");if(""===t)throw new Error("Id cannot be a blank string (entity = "+e.fullName+").")}var Ae=!1;var Ie=["Object","String","Number","Boolean","Date","TimeSpan","Array"],Se=function(e){Object.defineProperty(this,"createOwnProperties",{configurable:!1,enumerable:!0,value:e,writable:!1})},Ne={createOwnProperties:!1},De=function(){this.typeAddedEvent=new f,this.entityRegisteredEvent=new f,this.entityUnregisteredEvent=new f,this.propertyAddedEvent=new f},Fe={},Ce=function(){function e(e){void 0===e&&(e=void 0),Object.defineProperty(this,"settings",{configurable:!1,enumerable:!0,value:function(e){void 0===e&&(e=Ne.createOwnProperties);return new Se(e)}(e),writable:!1}),Object.defineProperty(this,"_types",{value:{}}),Object.defineProperty(this,"_eventDispatchers",{value:new De})}return Object.defineProperty(e.prototype,"typeAddedEvent",{get:function(){return this._eventDispatchers.typeAddedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityRegisteredEvent",{get:function(){return this._eventDispatchers.entityRegisteredEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityUnregisteredEvent",{get:function(){return this._eventDispatchers.entityUnregisteredEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propertyAddedEvent",{get:function(){return this._eventDispatchers.propertyAddedEvent.asEvent()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"types",{get:function(){var e=[];for(var t in this._types)this._types.hasOwnProperty(t)&&e.push(this._types[t]);return e},enumerable:!0,configurable:!0}),e.prototype.addType=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r="client");var n,u,i=(void 0===(n=t)&&(n=null),void 0===(u=r)&&(u="client"),new je(this,e,n||null,u));return this._types[e]=i,this._eventDispatchers.typeAddedEvent.dispatch(this,{type:i}),i},e.prototype.registerRule=function(e){this._ruleQueue?e.register():this._ruleQueue.push(e)},e.prototype.registerRules=function(){var e,t=this._ruleQueue;for(delete this._ruleQueue,e=0;e<t.length;e+=1)t[e].register()},e}();function Ve(e){return e._eventDispatchers}function ke(e,t,r){return r()}function Le(e,t){void 0===t&&(t=!1);var r=e.split(".");if(1===r.length&&-1<Ie.indexOf(e))return Fe[e];for(var n=void 0,u=Fe,i=0;void 0!==u&&i<r.length-1;i++){var o=r[i];u=u[o]}if(void 0!==u&&(n=u[r.length-1]),void 0!==n)return n;if(!t)throw new Error('The type "'+e+'" could not be found.  Failed on step "'+o+'".')}var Be=function(){function e(e){if(!e.hasOwnProperty("specifier")||"string"!=typeof e.specifier)throw new Error("Format specifier string must be provided.");this.specifier=e.specifier,this.convertFn=e.convert,this.convertBackFn=e.convertBack,this.description=e.description,this.nullString=e.nullString||"",this.undefinedString=e.undefinedString||"",this.formatEval=e.formatEval}return e.prototype.convert=function(e){return void 0===e?this.undefinedString:null===e?this.nullString:this.convertFn?this.convertFn(e):e},e.prototype.convertBack=function(e){return null===e||e==this.nullString?null:void 0!==e&&e!=this.undefinedString?e.constructor==String&&0===(e=e.trim()).length?null:this.convertBackFn?this.convertBackFn(e):e:void 0},e.prototype.toString=function(){return this.specifier},e}(),Re=Ce,Me=je,$e=he,He=M,Ue=J,We=p,Ge=Be,Ze=oe,qe=le;e.Model=Re,e.Type=Me,e.Property=$e,e.PropertyChain=He,e.Entity=Ue,e.ObjectMeta=We,e.Format=Ge,e.Rule=Ze,e.CalculatedPropertyRule=qe,Object.defineProperty(e,"__esModule",{value:!0})});
