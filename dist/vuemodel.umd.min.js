!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueModel=t()}(this,function(){"use strict";var l=function(){function t(){}return t.prototype.init=function(e,t){var r;for(var n in"string"==typeof e?(r={})[e]=t:r=e,r)if(r.hasOwnProperty(n)){var i=this.meta.type.property(n);if(!i)throw new Error('Could not find property "'+n+'" on type "'+this.meta.type.fullName+'".');i.value(this,t)}},t.prototype.set=function(e,t){var r;for(var n in"string"==typeof e?(r={})[e]=t:r=e,r)if(r.hasOwnProperty(n)){var i=this.meta.type.property(n);if(!i)throw new Error('Could not find property "'+n+'" on type "'+this.meta.type.fullName+'".');i.value(this,t)}},t.prototype.get=function(e){return this.meta.type.property(e).value(this)},t.prototype.toString=function(e){return t.toIdString(this)},t.toIdString=function(e){return e.meta.type.fullName+"|"+e.meta.id},t.fromIdString=function(e){var t=e.substring(0,e.indexOf("|")),r=e.substring(t.length+1);return W.getJsType(t).meta.get(r,!1)},t}(),a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var u=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.unsub=e,this.propagationStopped=!1}return e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}();t.EventManagement=r});e(u);u.EventManagement;var o=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}return e.prototype.execute=function(e,t,r){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var n=this.handler;e?setTimeout(function(){n.apply(t,r)},1):n.apply(t,r)}},e}();t.Subscription=r});e(o);o.Subscription;var r=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._wrap=new i(this),this._subscriptions=new Array}return e.prototype.subscribe=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!1)),function(){t.unsubscribe(e)}},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.one=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!0)),function(){t.unsubscribe(e)}},e.prototype.has=function(t){return!!t&&this._subscriptions.some(function(e){return e.handler==t})},e.prototype.unsubscribe=function(e){if(e)for(var t=0;t<this._subscriptions.length;t++)if(this._subscriptions[t].handler==e){this._subscriptions.splice(t,1);break}},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype._dispatch=function(n,i,o){for(var s=this,e=function(e){var t=new u.EventManagement(function(){return s.unsub(e.handler)}),r=Array.prototype.slice.call(o);if(r.push(t),e.execute(n,i,r),a.cleanup(e),!n&&t.propagationStopped)return"break"},a=this,t=0,r=this._subscriptions.slice();t<r.length;t++){if("break"===e(r[t]))break}},e.prototype.cleanup=function(e){if(e.isOnce&&e.isExecuted){var t=this._subscriptions.indexOf(e);-1<t&&this._subscriptions.splice(t,1)}},e.prototype.asEvent=function(){return this._wrap},e.prototype.clear=function(){this._subscriptions.splice(0,this._subscriptions.length)},e}();t.DispatcherBase=r;var n=function(){function e(){this._events={}}return e.prototype.get=function(e){var t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t)},e.prototype.remove=function(e){delete this._events[e]},e}();t.EventListBase=n;var i=function(){function e(t){this._subscribe=function(e){return t.subscribe(e)},this._unsubscribe=function(e){return t.unsubscribe(e)},this._one=function(e){return t.one(e)},this._has=function(e){return t.has(e)},this._clear=function(){return t.clear()}}return e.prototype.subscribe=function(e){return this._subscribe(e)},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.unsubscribe=function(e){this._unsubscribe(e)},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype.one=function(e){return this._one(e)},e.prototype.has=function(e){return this._has(e)},e.prototype.clear=function(){this._clear()},e}();t.DispatcherWrapper=i});e(r);r.DispatcherBase,r.EventListBase,r.DispatcherWrapper;var p=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherBase=r.DispatcherBase,t.DispatcherWrapper=r.DispatcherWrapper,t.EventListBase=r.EventListBase,t.Subscription=o.Subscription});e(p);p.DispatcherBase,p.DispatcherWrapper,p.EventListBase,p.Subscription;var n=t(function(e,t){var n,r=a&&a.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.dispatch=function(e,t){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(e,t){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(p.DispatcherBase);t.EventDispatcher=i;var o=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.createDispatcher=function(){return new i},t}(p.EventListBase);t.EventList=o;var s=function(){function e(){this._events=new o}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e}();t.EventHandlingBase=s});e(n);n.EventDispatcher,n.EventList,n.EventHandlingBase;var i=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=n.EventDispatcher,t.EventHandlingBase=n.EventHandlingBase,t.EventList=n.EventList});e(i);var s=i.EventDispatcher;i.EventHandlingBase,i.EventList;function f(e,t){var r,n=t;return n.constructor===String?(r=n.split("."),n=window,r.forEach(function(e){if(void 0===(n=n[e]))throw new Error('Parent namespace "'+t+'" could not be found.')})):null==n&&(n=window),e in n?n[e]:n[e]={}}var c=/function\s*([\w_\$]*)/i;function d(e){var t=c.exec(e.toString());return t&&t[1]||"{anonymous}"}var h=/\s([a-z|A-Z]+)/;function y(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).match(h)[1].toLowerCase()}function b(e,t){void 0===e&&(e=0),void 0===t&&(t=9);var r=Math.random();return 1===r?t:Math.floor(r*(t-e+1))+e}var v={secrets:{}};function _(e,t,r,n,i){var o;if(void 0===t&&(t=8),void 0===r&&(r=!0),void 0===n&&(n=!1),void 0===i&&(i=null),v.secrets.hasOwnProperty(e))(o=v.secrets[e]).indexOf(i);else{var s="";if(r)s=function(e,t){void 0===t&&(t=!1);for(var r="",n=0;n<e;n++){var i,o=b(0,t?35:25);i=o<=25?o+97:o-26+48,r+=String.fromCharCode(i)}return r}(t,n);else if(n)for(var a=0;a<t;a++)s+=b(0,9).toString();o=i?i+s:s,v.secrets[e]=o}return o}var g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function m(e,t){function r(){this.constructor=e}g(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var O=_("ObservableList.markerField",3,!1,!0,"_oL"),w=function(){function e(){}return e.add=function(e,t){var r=[t],n=Array.prototype.push.apply(e,r)-1;e._changedEvent.dispatch(e,{added:r,addedIndex:n,removed:[],removedIndex:-1})},e.remove=function(e,t){var r=Array.prototype.indexOf.call(e,t);if(-1!==r){var n=Array.prototype.splice.call(e,r,1);return e._changedEvent.dispatch(e,{added:[],addedIndex:-1,removed:n,removedIndex:r}),!0}},e}(),P=function(t){function e(e){return void 0===e&&(e=null),t.apply(this,e)||this}return m(e,t),e.isObservableList=function(e){return Object.prototype.hasOwnProperty.call(e,O)&&!0===e[O]},e._markObservable=function(e){Object.defineProperty(e,O,{configurable:!1,enumerable:!1,value:!0,writable:!1})},e.ensureObservable=function(e){return this.isObservableList(e)?e:j.implementObservableList(e)},e.create=function(e){void 0===e&&(e=null);var t=new j(e);return j.ensureObservable(t)},e}(Array),j=function(r){function n(e){void 0===e&&(e=null);var t=r.call(this,e)||this;return n._initFields(t),P._markObservable(t),t}return m(n,r),n._initFields=function(e,t){void 0===t&&(t=null),null==t&&(t=new s),Object.defineProperty(e,"_changedEvent",{configurable:!1,enumerable:!1,value:t,writable:!1})},n.implementObservableList=function(e){return n._initFields(e),e.add=function(e){w.add(this,e)},e.remove=function(e){return w.remove(this,e)},Object.defineProperty(e,"changed",{get:function(){return this._changedEvent.asEvent()}}),n._markObservable(e),e},n.prototype.add=function(e){w.add(this,e)},n.prototype.remove=function(e){return w.remove(this,e)},Object.defineProperty(n.prototype,"changed",{get:function(){return this._changedEvent.asEvent()},enumerable:!0,configurable:!0}),n}(P),E=_("Property.fieldNamePrefix",3,!1,!0,"_fN"),$=function(){this.changed=new s,this.accessed=new s},D=function(){function t(e,t,r,n,i,o,s,a,u,p,c,l){var f,d;void 0===c&&(c=void 0),void 0===l&&(l=e.originForNewProperties),Object.defineProperty(this,"containingType",{enumerable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,value:t}),Object.defineProperty(this,"jstype",{enumerable:!0,value:r}),Object.defineProperty(this,"isList",{enumerable:!0,value:!0===s}),Object.defineProperty(this,"isStatic",{enumerable:!0,value:!0===a}),this.helptext=i,this.isPersisted=u,this.isCalculated=p,n&&Object.defineProperty(this,"_label",{enumerable:!1,value:n,writable:!0}),o&&Object.defineProperty(this,"_format",{enumerable:!1,value:o,writable:!0}),l&&Object.defineProperty(this,"_origin",{enumerable:!1,value:e.originForNewProperties,writable:!0}),c&&Object.defineProperty(this,"_defaultValue",{enumerable:!1,value:c,writable:!0}),Object.defineProperty(this,"_eventDispatchers",{value:new $}),Object.defineProperty(this,"_getter",{value:(f=this,d=x,function(e){void 0===e&&(e=null);var t=d(f,this,e);return t})}),Object.defineProperty(this,"_setter",{value:function(r,n,i){void 0===i&&(i=!1);return function(e,t){void 0===t&&(t=null),n(r,this,e,t,i)}}(this,T)}),"client"===this.origin&&this.isPersisted}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return E+"_"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changedEvent",{get:function(){return this._eventDispatchers.changed.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessedEvent",{get:function(){return this._eventDispatchers.accessed.asEvent()},enumerable:!0,configurable:!0}),t.prototype.equals=function(e){if(null!=e&&e instanceof t)return this===e},t.prototype.toString=function(){return this.isStatic?this.getPath():"this<"+this.containingType+">."+this.name},t.prototype.isDefinedBy=function(e){return this.containingType===e||e.isSubclassOf(this.containingType)},Object.defineProperty(t.prototype,"label",{get:function(){return this._label||function(e){var t,r,n,i,o;for(n=e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),t=0,r=(i=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;t<r;t++)n=n.replace(new RegExp("\\s"+i[t]+"\\s","g"),function(e){return e.toLowerCase()});for(t=0,r=(o=["Id","Tv"]).length;t<r;t++)n=n.replace(new RegExp("\\b"+o[t]+"\\b","g"),o[t].toUpperCase());return n}(this.name.replace(/([^A-Z]+)([A-Z])/g,"$1 $2"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin?this._origin:this.containingType.origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultValue",{get:function(){return Object.prototype.hasOwnProperty.call(this,"_defaultValue")?this._defaultValue instanceof Array?this._defaultValue.slice():this._defaultValue instanceof Date?new Date(+this._defaultValue):this._defaultValue instanceof Function?this._defaultValue():this._defaultValue:(e=this.isList,t=this.jstype,e?[]:t!==Boolean&&(t===Number?0:null));var e,t},enumerable:!0,configurable:!0}),t.prototype.getPath=function(){return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t.prototype.canSetValue=function(e,t){if(void 0===t)return!0;if(null===t)return!0;if(t.constructor&&t.constructor.meta){for(var r=t.constructor.meta;r;r=r.baseType)if(r.jstype===this.jstype)return!0;return!1}var n=t.constructor;switch(y(t)){case"string":n=String;break;case"number":n=Number;break;case"boolean":n=Boolean;break;case"date":n=Date;break;case"array":n=Array}return n===this.jstype||n===Array&&this.isList&&t.every(function(e){if(e.constructor&&e.constructor.meta){for(var t=e.constructor.meta;t;t=t.baseType)if(t._jstype===this._jstype)return!0;return!1}},this)},t.prototype.value=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null);var n=this.isStatic?this.containingType.jstype:e;if(null==n)throw new Error("Cannot "+(1<arguments.length?"set":"get")+" value for "+(this.isStatic?"":"non-")+'static property "'+this.getPath()+'" on type "'+this.containingType.fullName+'": target is null or undefined.');if(!(1<arguments.length))return x(this,e);T(this,e,t,r)},t.prototype.rootedPath=function(e){if(this.isDefinedBy(e))return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t}();function A(e,t){Object.defineProperty(t,e.name,{configurable:!1,enumerable:!0,get:e._getter,set:e._setter})}function N(e,t){if(!t.hasOwnProperty(e.fieldName)&&!e.isCalculated){var r=e.isStatic?e.containingType.jstype:t,n=(a=e.defaultValue,Array.isArray(a)&&(a=P.ensureObservable(a)),a);Object.defineProperty(r,e.fieldName,{value:n,writable:!0}),Array.isArray(n)&&(i=t,o=e,(s=n).changed.subscribe(function(e,t){if(t.added&&0<t.added.length||t.removed&&0<t.removed.length){var r={property:o,newValue:s,oldValue:void 0};r.changes=[{newItems:t.added,oldItems:t.removed}],r.collectionChanged=!0,o._eventDispatchers.changed.dispatch(i,r)}}))}var i,o,s,a}function x(e,t){N(e,t);var r={property:e,value:t[e.fieldName]};return e._eventDispatchers.accessed.dispatch(t,r),t[e.fieldName]}function T(e,t,r,n,i){void 0===n&&(n=null),void 0===i&&(i=!1),N(e,t);var o=t[e.fieldName];(function(e,t,r,n,i){void 0===i&&(i=!1);if(!e.canSetValue(t,n))throw new Error("Cannot set "+e.name+"="+(void 0===n?"<undefined>":n)+" for instance "+t.meta.type.fullName+"|"+t.meta.id+": a value of type "+(e.jstype&&e.jstype.meta?e.jstype.meta.fullName:d(e.jstype))+" was expected.");{if(e.isList)throw new Error("Property set on lists is not permitted.");var o=null==r?r:r.valueOf(),s=null==n?n:n.valueOf();return o!==s&&!(e.jstype===Number&&isNaN(o)&&isNaN(s))}})(e,t,o,r,i)&&function(e,t,r,n,i){void 0===i&&(i=null);{if(e.isList)throw new Error("Property set on lists is not implemented.");if(t[e.fieldName]=n,void 0!==r){var o={property:e,newValue:n,oldValue:r};if(i)for(var s in i)i.hasOwnProperty(s)&&(o[s]=i[s]);e._eventDispatchers.changed.dispatch(t,o)}}}(e,t,o,r,n)}var S=function(){function e(e,t,r,n){Object.defineProperty(this,"type",{enumerable:!0,value:e}),Object.defineProperty(this,"entity",{enumerable:!0,value:t}),Object.defineProperty(this,"_id",{enumerable:!1,value:r,writable:!0}),Object.defineProperty(this,"_isNew",{enumerable:!1,value:n,writable:!0})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legacyId",{get:function(){return this._legacyId},set:function(e){this._legacyId=e},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.type.unregister(this.entity);for(var e=this.type;e;e=e.baseType)e._eventDispatchers.destroy.dispatch(e,{entity:this.entity})},e}(),V="+c",I=function(){this.initNew=new s,this.initExisting=new s,this.destroy=new s},M=function(){function e(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n="client"),Object.defineProperty(this,"model",{enumerable:!0,value:e}),Object.defineProperty(this,"fullName",{enumerable:!0,value:t}),Object.defineProperty(this,"jstype",{enumerable:!0,value:function(o,e,t){void 0===t&&(t=null);var r=e.split("."),n=r.shift(),i=R,s=window;for(;0<r.length;)i=f(n,i),s=f(n,s),n=r.shift();var a=n;var u=new Function("construct","return function "+a+" () { construct.apply(this, arguments); }")(function(){if(!C)if(0<arguments.length&&null!=arguments[0]&&arguments[0].constructor===String){var e=arguments[0],t=arguments[1],r=arguments[2],n=o.get(e,!0);if(n)return t&&n.init(t),n;o.register(this,e,r),t&&this.init(t);for(var i=o;i;i=i.baseType)i._eventDispatchers.initExisting.dispatch(i,{entity:this})}else{var t=arguments[0],r=arguments[2];o.register(this,null,r),t&&this.set(t);for(var i=o;i;i=i.baseType)i._eventDispatchers.initNew.dispatch(i,{entity:this})}}),p=u;i[a]?i["$"+a]=p:i[a]=p;s[a]?s["$"+a]=p:s[a]=p;var c=null;c=c?t.jstype:l;return C=!0,u.prototype=new c,C=!1,u.prototype.constructor=u,Object.defineProperty(u,"meta",{enumerable:!1,value:o,configurable:!1,writable:!1}),u}(this,t,r)}),Object.defineProperty(this,"baseType",{enumerable:!0,value:r}),this.origin=n,this.originForNewProperties=this.origin,Object.defineProperty(this,"_counter",{enumerable:!1,value:0,writable:!0}),Object.defineProperty(this,"_pool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_legacyPool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_properties",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_derivedTypes",{enumerable:!1,value:[],writable:!1}),Object.defineProperty(this,"_eventDispatchers",{value:new I}),e._types[t]=this}return Object.defineProperty(e.prototype,"destroyEvent",{get:function(){return this._eventDispatchers.destroy.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initNewEvent",{get:function(){return this._eventDispatchers.initNew.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initExistingEvent",{get:function(){return this._eventDispatchers.initExisting.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"newIdPrefix",{get:function(){return V.substring(1)},set:function(e){if("string"!=typeof e)throw new TypeError("Property `Type.newIdPrefix` must be a string, found <"+typeof e+">");if(0===e.length)throw new Error("Property `Type.newIdPrefix` cannot be empty string");V="+"+e},enumerable:!0,configurable:!0}),e.prototype.newId=function(){for(var e,t=this;t;t=t.baseType)e=Math.max(e||0,t._counter);for(t=this;t;t=t.baseType)t._counter=e+1;return V+e},e.prototype.register=function(e,t,r){var n;void 0===r&&(r=!1),2===arguments.length&&L(this,t),t||(t=this.newId(),n=!0),Object.defineProperty(e,"meta",{value:new S(this,e,t,n),configurable:!1,enumerable:!1,writable:!1});for(var i=t.toLowerCase(),o=this;o;o=o.baseType){if(o._pool.hasOwnProperty(i))throw new Error('Object "'+this.fullName+"|"+t+'" has already been registered.');o._pool[i]=e,o._known&&o._known.add(e)}if(!0===this.model._settings.createOwnProperties)for(var s in this._properties)if(Object.prototype.hasOwnProperty.call(this._properties,s)){var a=this._properties[s];a.isStatic||A(a,e)}r||this.model._eventDispatchers.entityRegistered.dispatch(this.model,{entity:e})},e.prototype.changeObjectId=function(e,t){L(this,e),L(this,t);var r=e.toLowerCase(),n=t.toLowerCase(),i=this._pool[r];if(i){i.meta.legacyId=e;for(var o=this;o;o=o.baseType)o._pool[n]=i,delete o._pool[r],o._legacyPool[r]=i;return i.meta.id=t,i}},e.prototype.unregister=function(e){for(var t=this;t;t=t.baseType)delete t._pool[e.meta.id.toLowerCase()],e.meta.legacyId&&delete t._legacyPool[e.meta.legacyId.toLowerCase()],t._known&&t._known.remove(e);this.model._eventDispatchers.entityUnregistered.dispatch(this.model,{entity:e})},e.prototype.get=function(e,t){void 0===t&&(t=!1);var r=e.toLowerCase(),n=this._pool[r]||this._legacyPool[r];if(n&&!0===t&&n.meta.type!==this)throw new Error("The entity with id='"+e+"' is expected to be of type '"+this.fullName+"' but found type '"+n.meta.type.fullName+"'.");return n},e.prototype.known=function(){var e=this._known;if(!e){var t=[];for(var r in this._pool)Object.prototype.hasOwnProperty.call(this._pool,r)&&t.push(this._pool[r]);e=this._known=P.ensureObservable(t)}return e},e.prototype.addProperty=function(e,t,r,n,i){void 0===i&&(i={});var o,s,a=new D(this,e,t,i.label,i.helptext,i.format,r,n,i.isPersisted,i.isCalculated,i.defaultValue);if(function t(r,e,n,i){void 0===n&&(n=!0),void 0===i&&(i=null);var o="$"+r.name;Object.prototype.hasOwnProperty.call(e,o)&&!i||(e[o]=r),n&&(null==i&&(i=!1),r.containingType.derivedTypes.forEach(function(e){t(r,e,!0,i)}))}(this._properties[e]=a,a.containingType.jstype),a.isStatic)s=a,Object.defineProperty(s.containingType.jstype,s.name,{configurable:!1,enumerable:!0,get:s._getter,set:s._setter});else if(!0===this.model._settings.createOwnProperties)for(var u in this._pool)Object.prototype.hasOwnProperty.call(this._pool,u)&&A(a,this._pool[u]);else o=a,Object.defineProperty(o.containingType.jstype.prototype,o.name,{configurable:!1,enumerable:!0,get:o._getter,set:o._setter});return this.model._eventDispatchers.propertyAdded.dispatch(this.model,{property:a}),a},e.prototype.property=function(e){for(var t,r=this;r&&!t;r=r.baseType)if(t=r._properties[e])return t;return null},Object.defineProperty(e.prototype,"properties",{get:function(){for(var e=[],t=this;null!=t;t=t.baseType)for(var r in t._properties)t._properties.hasOwnProperty(r)&&e.push(t._properties[r]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"derivedTypes",{get:function(){return this._derivedTypes},enumerable:!0,configurable:!0}),e.prototype.isSubclassOf=function(t){var r=!1;return function(e,t,r,n){void 0===n&&(n=null);for(var i=e[t];null!=i;i=i[t])if(!1===r.call(n||e,i))return}(this,"baseType",function(e){if(e===t)return!(r=!0)}),r},e.prototype.toString=function(){return this.fullName},e}();function L(e,t){if(null==t)throw new Error("Id cannot be "+(null===t?"null":"undefined")+" (entity = "+e.fullName+").");if("string"!==y(t))throw new Error("Id must be a string:  encountered id "+t+' of type "'+d(t.constructor)+'" (entity = '+e.fullName+").");if(""===t)throw new Error("Id cannot be a blank string (entity = "+e.fullName+").")}var C=!1;var B=["Object","String","Number","Boolean","Date","TimeSpan","Array"],k={createOwnProperties:!1},F=function(){this.typeAdded=new s,this.entityRegistered=new s,this.entityUnregistered=new s,this.propertyAdded=new s},R={},W=function(){function e(e){void 0===e&&(e=void 0),Object.defineProperty(this,"_types",{value:{}}),Object.defineProperty(this,"_settings",{value:function(e){void 0===e&&(e=k.createOwnProperties);return{createOwnProperties:e}}(e)}),Object.defineProperty(this,"_eventDispatchers",{value:new F})}return Object.defineProperty(e.prototype,"typeAddedEvent",{get:function(){return this._eventDispatchers.typeAdded.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityRegisteredEvent",{get:function(){return this._eventDispatchers.entityRegistered.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityUnregisteredEvent",{get:function(){return this._eventDispatchers.entityUnregistered.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propertyAddedEvent",{get:function(){return this._eventDispatchers.propertyAdded.asEvent()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"types",{get:function(){var e=[];for(var t in this._types)this._types.hasOwnProperty(t)&&e.push(this._types[t]);return e},enumerable:!0,configurable:!0}),e.prototype.addType=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r="client");var n=new M(this,e,t,r);return this._types[e]=n,this._eventDispatchers.typeAdded.dispatch(this,{type:n}),n},e.getJsType=function(e,t){void 0===t&&(t=!1);var r=R,n=e.split(".");if(1===n.length&&-1<B.indexOf(e))return r[e];for(var i=0;i<n.length;i++){var o=n[i];if(void 0===(r=r[o])){if(t)return;throw new Error('The type "'+e+'" could not be found.  Failed on step "'+o+'".')}}return r},e}();function U(e,t){return e[t]}var H=Object.prototype.hasOwnProperty;function Z(e,t){return H.call(e,t)}function J(e,t,r){Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:function(){return this[t][r]},set:function(e){this[t][r]=e}})}var q=[];function z(e,r){if(null!=e){if(0<=q.indexOf(e))return;var t=r.Model$Model,n=r.VueModel$observeEntity;e instanceof t&&(e.entityRegisteredEvent.subscribe(function(e,t){n(t.entity)}),e.types.forEach(function(e){e.known().forEach(function(e){n(e)})}),e.propertyAddedEvent.subscribe(function(e,t){K(t.property,r)}),e.types.forEach(function(e){e.properties.forEach(function(e){return K(e,r)})}),q.push(e))}}var G=[];function K(e,i){if(null!=e){if(0<=G.indexOf(e))return;var o=i.Vue$Dep,s=i.VueModel$observeEntity;e instanceof i.Model$Property&&(e.accessedEvent.subscribe(function(e,t){var r=Q(e,t.property,i);if(o.target){r.depend();var n=s(t.value);n?n.dep.depend():Array.isArray(t.value)&&function e(t){for(var r,n=0,i=t.length;n<i;n++)(r=t[n])&&r.__ob__&&r.__ob__.dep.depend(),Array.isArray(r)&&e(r)}(t.value)}}),e.changedEvent.subscribe(function(e,t){var r=Q(e,t.property,i);s(t.newValue),r.notify()}),G.push(e))}}function Q(e,t,r){var n,i=t.fieldName+"_Dep",o=r.Vue$Dep,s=e;return Z(s,i)&&s[i]instanceof o?n=s[i]:(n=new o,Object.defineProperty(s,i,{configurable:!0,enumerable:!1,value:n,writable:!0})),n}function X(e,t){var r,n,i,o;return t.entitiesAreVueObservable?z(e,t):(n=(r=t).Vue$Observer,(((i=function(){n.apply(this,arguments)}).prototype=new n({})).constructor=i).prototype.walk=function(){},r.VueModel$EntityObserver=i,(o=t).VueModel$observeEntity=function(e,t){void 0===t&&(t=!1);var r,n=o.Model$Entity,i=o.VueModel$EntityObserver;if(e instanceof n)return r=Z(e,"__ob__")&&U(e,"__ob__")instanceof i?U(e,"__ob__"):new i(e),t&&r&&r.vmCount++,r},z(e,t),t.entitiesAreVueObservable=!0),t}function Y(e,t,r){var n=r.Model$Entity;return null!=t&&t instanceof n?(e._entity=t,{}):t}function ee(e,t){var r=t.VueModel$observeEntity,n=e;n._data=n._entity,function(e,t){for(var r,n,i=t.meta.type.properties,o=e.$options.props,s=e.$options.methods,a=0;a<i.length;a++){var u=i[a];s&&Z(s,u.name)?u.name:o&&Z(o,u.name)?u.name:(r=u.name,36!==(n=(r+"").charCodeAt(0))&&95!==n&&J(e,"_data",u.name))}}(e,n._entity),r(n._entity,!0),n._entity=null}function te(e,t){!t.Vue$Observer&&e.__ob__&&(t.Vue$Observer=e.__ob__.constructor),!t.Vue$Dep&&e.__ob__&&e.__ob__.dep&&(t.Vue$Dep=e.__ob__.dep.constructor)}function re(e,t){e.mixin({beforeCreate:function(){this.$options.data&&function(e,t){if(e.$options.data)if(e.$options.data instanceof Function){var r=e.$options.data;e.$options.data=function(){return Y(e,r.apply(this,arguments),t)}}else t.entitiesAreVueObservable||(e.$options.data=Y(e,e.$options.data,t))}(this,t)},created:function(){var e=this;e._data&&te(e._data,t),e._entity&&(te(e._entity,t),t.entitiesAreVueObservable||X(e._entity.meta.type.model,t),ee(this,t))}})}var ne=function(e){e=function(e){void 0===e&&(e=null);var t={createOwnProperties:!1};return e&&Object.prototype.hasOwnProperty.call(e,"createOwnProperties")&&"boolean"==typeof e.createOwnProperties&&(t.createOwnProperties=e.createOwnProperties),t}(e),Object.defineProperty(this,"$meta",{enumerable:!0,value:new W(e.createOwnProperties)})};var ie=function(){function e(e){Object.defineProperty(this,"entity",{enumerable:!0,value:e})}return Object.defineProperty(e.prototype,"value",{get:function(){return this.entity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){return this.entity.meta.type.fullName+"|"+this.entity.meta.id},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.entity.meta.type.fullName+"|"+this.entity.meta.id},e}(),oe=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"path",{enumerable:!0,value:t})}return Object.defineProperty(e.prototype,"property",{get:function(){return this.source.value.meta.type.property(this.path)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.property.label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"helptext",{get:function(){return this.property.helptext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.property.value(this.source.value)},set:function(e){this.property.value(this.source.value,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e,t=this,r=this.property.value(this.source.value);if(null==r)e="";else if(null!=this.property.format){if(Array.isArray(r))e=r.map(function(e){return t.property.format.convert(e)});else e=this.property.format.convert(r)}else if(Array.isArray(r)){e=r.map(function(e){return null==r?"":e.toString()})}else e=r.toString();return Array.isArray(e)?e.join(", "):e},set:function(e){this.value=null!=this.property.format?this.property.format.convertBack(e):e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Source['"+this.path+"']"},e}(),se=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"index",{enumerable:!0,value:t})}return Object.defineProperty(e.prototype,"value",{get:function(){return this.source.value[this.index]},set:function(e){var t=this.source.value,r=t[this.index];if(e!==r){var n=r,i=e;t[this.index]=i;var o={property:this.source.property,newValue:t,oldValue:void 0};o.changes=[{newItems:[i],oldItems:[n]}],o.collectionChanged=!0,this.source.property._eventDispatchers.changed.dispatch(this.source.source.value,o)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e=this.source.value[this.index];return null!=this.source.property.format?this.source.property.format.convert(e):e.toString()},set:function(e){this.value=null!=this.source.property.format?this.source.property.format.convertBack(e):e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Source["+this.index+"]"},e}();function ae(e){return e instanceof ie||(e instanceof oe||e instanceof se)}function ue(e,t){var r=e;if(Z(r,t)&&ae(r[t])){r[t];r.$options._componentTag,r[t]instanceof oe&&(J(e,t,"label"),J(e,t,"helptext")),J(e,t,"value"),J(e,t,"displayValue")}}function pe(e,t){var r=e;Z(r,"_source")&&ae(r._source)||(r._source=t),Z(e,"$source")||Object.defineProperty(e,"$source",{get:function(){return this._source},set:function(){}})}function ce(e,t,r){void 0===r&&(r=!1);var n=e,i=t.Model$Entity;if(Z(e,"$source"))return null;if(n._source){var o=n._source;return"string"==typeof o?null:o instanceof i?o:ae(o)?o:null}if(r){var s=n._data;if(s){if(s instanceof i)return s.meta.type.fullName,n.$options._componentTag,n._source=s;if(ae(s))return n.$options._componentTag,n._source=s}if(n._entity){var a=n._entity;if(a instanceof i)return a.meta.type.fullName,n.$options._componentTag,n._source=a}}}function le(e,t,r){void 0===r&&(r=!1);for(var n=null,i=t.Model$Entity,o=e.$parent,s=1;null!=o;o=o.$parent,s+=1){var a=o,u=a.$source;if(u)return"string"==typeof u||ae(u),a.$options._componentTag,o;r&&(void 0===ce(o,t,!0)||n||(n=o,s))}if(r&&n&&ce(n,t)instanceof i)return n.$options._componentTag,n}var fe,de,he={entitiesAreVueObservable:!1,Model$Model:W,Model$Entity:l,Model$Property:D},ye=ne;return ye.SourceRootAdapter=ie,ye.SourcePathAdapter=oe,ye.SourceIndexAdapter=se,ye.mixins={SourceProvider:(de=he,{props:["source","sourceIndex"],beforeCreate:function(){this.$options.propsData&&function(e){var t=e;if(!t._source){var r=e.$options.propsData;Z(r,"source")&&(t._source=r.source)}}(this)},created:function(){var e=this,t=e;ae(t._data)&&(pe(e,t._data),ue(e,"_data")),e.$options.propsData&&Z(e.$options.propsData,"source")&&function e(t,r){var n=t;if(!n._sourcePending&&t.$options.propsData){var i=t.$options.propsData;if(Z(i,"source")){n._sourcePending=!0;var o=r.Model$Entity;n.$options._componentTag,i.source;var s=le(t,r,!0);if(s){var a=s,u=a._source;"string"==typeof u&&(e(s,r),u=a._source);var p=parseInt(i.source,10);isNaN(p)&&(p=null);var c=null;u instanceof o?(u.meta.type.fullName,c=new oe(new ie(u),i.source)):ae(u)&&(c=null!==p?new se(u,parseInt(i.source,10)):new oe(u,i.source)),null!=c&&(pe(t,c),ue(t,"_source"))}delete n._sourcePending}}}(e,de)}}),SourceConsumer:(fe=he,{created:function(){var e=le(this,fe);e.$source&&ae(e.$source)&&(pe(this,e.$source),ue(this,"_source"))}})},ye.install=function(e){return re(e,he)},ye});
