!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueModel=t()}(this,function(){"use strict";function p(u){void 0===u&&(u=!1);var i=[];var e=function(){var e;u&&(e=[]);for(var t=0;t<i.length;++t){var n=i[t];if(!0!==n.applied&&(!n.filter||!0===n.filter.apply(this,arguments))){!0===n.once&&(n.applied=!0);var r=n.fn.apply(this,arguments);u&&e.push(r)}}if(u)return e};return e._funcs=i,e.add=t,e.remove=n,e.isEmpty=r,e.clear=o,e}function t(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r={fn:e};return null!=t&&(r.filter=t),null!=n&&(r.once=n),r}(e,t,n);this._funcs.push(r)}function n(e){for(var t=this._funcs.length-1;0<=t;--t)if(this._funcs[t].fn===e)return this._funcs.splice(t,1),!0;return!1}function r(t){return void 0===t&&(t=null),!this._funcs.some(function(e){return!0!==e.applied&&(!t||!e.filter||e.filter.apply(this,t))},this)}function o(){this._funcs.length=0}function f(e,t){var n,r=t;return r.constructor===String?(n=r.split("."),r=window,n.forEach(function(e){if(void 0===(r=r[e]))throw new Error('Parent namespace "'+t+'" could not be found.')})):null==r&&(r=window),e in r?r[e]:r[e]={}}var u=/function\s*([\w_\$]*)/i;function a(e){var t=u.exec(e.toString());return t&&t[1]||"{anonymous}"}var i=/\s([a-z|A-Z]+)/;function s(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).match(i)[1].toLowerCase()}function c(e,t){void 0===e&&(e=0),void 0===t&&(t=9);var n=Math.random();return 1===n?t:Math.floor(n*(t-e+1))+e}function l(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!0),t||n){for(var r="",u=0;u<e;u++){var i,o=c(t?0:26,n?35:25);i=o<=25?o+97:o-26+48,r+=String.fromCharCode(i)}return r}}function d(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e){var t=e._func;if(t){var n=t._funcs;return 0<n.length?n.map(function(e){return{handler:e.fn,isExecuted:e.applied,isOnce:e.once}}):null}}var b=function(){function e(){}return e.prototype.stopPropagation=function(){throw new Error("Method 'stopPropagation' is not implemented.")},e}();var y=function(){function e(e){Object.defineProperty(this,"_event",{value:e})}return e.prototype.subscribe=function(e){this._event.subscribe(e)},e.prototype.subscribeOne=function(e){this._event.subscribeOne(e)},e.prototype.unsubscribe=function(e){this._event.unsubscribe(e)},e.prototype.hasSubscribers=function(e){return this._event.hasSubscribers(e)},e.prototype.clear=function(){this._event.clear()},e}(),v=function(){function e(){}return e.prototype.asEventSubscriber=function(){return this._subscriber||Object.defineProperty(this,"_subscriber",{value:new y(this)}),this._subscriber},e.prototype.publish=function(e,t){if(this._func){var n=function(e){var t=new b;for(var n in e)d(e,n)&&(t[n]=e[n]);return t}(t);this._func.call(e,n)}},e.prototype.subscribe=function(e){this._func||Object.defineProperty(this,"_func",{value:p()}),this._func.add(e)},e.prototype.subscribeOne=function(e){this._func||Object.defineProperty(this,"_func",{value:p()}),this._func.add(e,null,!0)},e.prototype.hasSubscribers=function(t){return!!this._func&&this._func._funcs.some(function(e){return e.fn===t})},e.prototype.unsubscribe=function(e){this._func&&this._func.remove(e)},e.prototype.clear=function(){this._func&&this._func.clear()},e}(),T=function(){function e(){Object.defineProperty(this,"_events",{value:new g})}return Object.defineProperty(e.prototype,"accessed",{get:function(){return this._events.accessedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changed",{get:function(){return this._events.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){var n;for(var r in"string"==typeof e?(n={})[e]=t:n=e,n)if(n.hasOwnProperty(r)){var u=this.meta.type.getProperty(r);if(!u)throw new Error('Could not find property "'+r+'" on type "'+this.meta.type.fullName+'".');u.value(this,t)}},e.prototype.set=function(e,t){var n;for(var r in"string"==typeof e?(n={})[e]=t:n=e,n)if(n.hasOwnProperty(r)){var u=this.meta.type.getProperty(r);if(!u)throw new Error('Could not find property "'+r+'" on type "'+this.meta.type.fullName+'".');u.value(this,t)}},e.prototype.get=function(e){return this.meta.type.getProperty(e).value(this)},e.prototype.toString=function(e){return(t=this).meta.type.fullName+"|"+t.meta.id;var t},e}(),g=function(){this.accessedEvent=new v,this.changedEvent=new v};var m=null,_=!1,w=function(){function e(e){Object.defineProperty(this,"label",{enumerable:!0,value:e}),Object.defineProperty(this,"_waitForAll",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"_pending",{enumerable:!1,value:0,writable:!0})}return Object.defineProperty(e.prototype,"isActive",{get:function(){return 0<this._pending},enumerable:!0,configurable:!0}),e.prototype.pending=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r=function(e,t,n,r){void 0===n&&(n=null);void 0===r&&(r=null);var u=!1;return function(){P("pending",n||this,function(){u||(u=!0,t&&t.apply(this,arguments),e.decrement())},0<arguments.length?Array.prototype.slice.call(arguments):null,r)}}(this,e,t,n);return this._pending++,r},e.prototype.waitForAll=function(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),e&&(0===this._pending?P("waitForAll",t,e,r,n):this._waitForAll.push({callback:e,thisPtr:t,executeImmediately:n,args:r}))},e.prototype.decrement=function(){for(--this._pending;0===this._pending&&0<this._waitForAll.length;){var e=this._waitForAll.shift();P("waitForAll",e.thisPtr,e.callback,e.args,e.executeImmediately)}},e}(),O=function r(u,i){void 0===i&&(i=null),window.setTimeout(function(){var e,t,n=("number"!==s(t=null)||isNaN(t),null);n&&m.length>n?(e=m.splice(0,n),r(u,i)):(e=m,m=null),e.forEach(function(e){return e.apply(u,i)})},1)};function P(e,t,n,r,u){if(void 0===r&&(r=null),void 0===u&&(u=null),!1===u||!0===_){var i=!1;null===m&&(m=[],i=!0),m.push(function(){n.apply(t,r||[])}),i&&O(t,r)}else n.apply(t,r||[])}var E=function(){function d(e,t,n){Object.defineProperty(this,"rootType",{enumerable:!0,value:e}),Object.defineProperty(this,"_properties",{value:t}),Object.defineProperty(this,"_propertyFilters",{value:n||new Array(t.length)}),Object.defineProperty(this,"_propertyAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_events",{value:new x})}return Object.defineProperty(d.prototype,"changed",{get:function(){return this._events.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"accessed",{get:function(){return this._events.accessedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),d.prototype.equals=function(e){if(null!=e){if(e instanceof R)return 1===this._properties.length&&this._properties[0]===e;if(e instanceof d){if(e._properties.length!==this._properties.length)return!1;for(var t=0;t<this._properties.length;t++)if(!this._properties[t].equals(e._properties[t]))return!1;return!0}}},d.prototype.forEach=function(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),null==e)throw new Error("Argument 'obj' cannot be null or undefined.");if(null==t)throw new Error("Argument 'callback' cannot be null or undefined.");if("function"!=typeof t)throw new Error("Argument 'callback' must be of type function: "+t+".");for(var u=arguments[4]||e,i=arguments[6]||null,o=this._properties.slice(arguments[5]||0),a=arguments[5]||0;a<this._properties.length;a++){var s=this._properties[a],c=a===this._properties.length-1||r&&i===r,f=!r||i===r;if(u instanceof Array){for(var p=0;p<u.length;++p)if(!this._propertyFilters||!this._propertyFilters[a]||this._propertyFilters[a](u[p])){if(f&&!1===t.call(n||this,u[p],p,u,s,a,o))return!1;if(!c){var l=s.value(u[p]);if(!l||!1===d.prototype.forEach.call(this,e,t,n,r,l,a+1,s))return!1}}return!0}if(this._propertyFilters&&this._propertyFilters[a]&&!1===this._propertyFilters[a](u))break;if(f&&!1===t.call(n||this,u,-1,null,s,a,o))return!1;if(c)break;if(null==(u=u[s.fieldName]))break;i=s}return!0},Object.defineProperty(d.prototype,"path",{get:function(){if(!this._path){var e=A(this,0);Object.defineProperty(this,"_path",{enumerable:!1,value:e,writable:!0})}return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"firstProperty",{get:function(){return this._properties[0]},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lastProperty",{get:function(){return this._properties[this._properties.length-1]},enumerable:!0,configurable:!0}),d.prototype.toPropertyArray=function(){return this._properties.slice()},d.prototype.getLastTarget=function(e,t){void 0===t&&(t=!1);for(var n=0;n<this._properties.length-1;n++){var r=this._properties[n];if(null==e){if(t)return e;throw new Error("Property chain is not complete.")}e=r.value(e)}return e},d.prototype.append=function(e){var t=this._properties.slice(),n=this._propertyFilters?this._propertyFilters.slice():new Array(this._properties.length);if(e instanceof R)t.push(e),n.push(null);else{if(!(e instanceof d))throw new Error("Method `IPropertyChain.append(prop)` expects an argument of type `IProperty` or `IPropertyChain`.");Array.prototype.push.apply(t,e._properties),Array.prototype.push.apply(n,e._propertyFilters||new Array(e._properties.length))}return new d(this.rootType,t,n)},d.prototype.prepend=function(e){var t,n,r;if(e instanceof R)t=this._properties.slice(),r=this._propertyFilters.slice(),n=e.containingType,t.splice(0,0,e),r.splice(0,0,null);else{if(!(e instanceof d))throw new Error("Method `IPropertyChain.prepend(prop)` expects an argument of type `IProperty` or `IPropertyChain`.");t=this._properties.slice(),r=this._propertyFilters.slice(),n=e._properties[0].containingType;var u=[0,0];Array.prototype.splice.apply(t,u.concat(e._properties)),Array.prototype.splice.apply(r,u.concat(e._propertyFilters||new Array(e._properties.length)))}return new d(n,t,r)},d.prototype.canSetValue=function(e,t){return this.lastProperty.canSetValue(this.getLastTarget(e),t)},d.prototype.testConnection=function(e,t,n){var r=!1;return n?(this.forEach(e,function(e){if(e===t)return!(r=!0)},this,n),r):e===t},d.prototype.getRootedPath=function(e){for(var t=0;t<this._properties.length;t++)if(e.hasModelProperty(this._properties[t])){var n=A(this,t);return this._properties[t].isStatic?this._properties[t].containingType+"."+n:n}},Object.defineProperty(d.prototype,"propertyType",{get:function(){return this.lastProperty.propertyType},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"format",{get:function(){return this.lastProperty.format},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isList",{get:function(){return this.lastProperty.isList},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"label",{get:function(){return this.lastProperty.label},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"helptext",{get:function(){return this.lastProperty.helptext},enumerable:!0,configurable:!0}),d.prototype.value=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null);var r=this.getLastTarget(e),u=this.lastProperty;if(1<arguments.length)u.value(r,t,n);else if(r)return u.value(r)},d.prototype.isInited=function(e,o){void 0===o&&(o=!1);var a=!0,s=[],t=arguments[2]||0,n=arguments[3]||null,r=this._properties.length-t;return d.prototype.forEach.call(this,e,function(e,t,n,r,u,i){return n&&o?(n.every(function(e){return this.isInited(e,!0,u,i[u-1])},this)?Array.prototype.push.apply(s,i.slice(u)):a=!1,!1):r.isInited(e)?void(n&&0!==t||s.push(r)):a=!1},this,null,e,t,n),a&&(!o||s.length===r)},d.prototype.getPath=function(){return this.path},d.prototype.toString=function(){var e=this._properties.map(function(e){return e.name}).join(".");return"this<"+this.rootType+">."+e},d}();function j(o,a){var s=o,c=[],f=[],p=[],l=!!(3<=arguments.length&&arguments[2]&&arguments[2].constructor===Boolean)&&arguments[2],d=4<=arguments.length&&arguments[3]&&arguments[3]instanceof Function?arguments[3]:null,h=5<=arguments.length&&arguments[4]&&arguments[4]instanceof Function?arguments[4]:function(e){if(d)throw new Error(e)},b=function(){var e=a.steps.shift();if(!e)return h("Syntax error in property path: "+a.expression),null;var t=s.getProperty(e.property);if(!t)return h("Path '"+a.expression+"' references unknown property \""+e.property+'" on type "'+s+'".'),null;if(t.isStatic)return h("Path '"+a.expression+"' references static property \""+e.property+'" on type "'+s+'".'),null;if(c.push(t),e.cast){if(!(s=Ie(e.cast,o.model._allTypesRoot,!0).meta))return h("Path '"+a.expression+"' references an invalid type: \""+e.cast+'".'),null;var n=s.ctor;p[c.length]=n,f[c.length]=function(e){return e instanceof n}}else s=t.propertyType.meta;if(0<a.steps.length)return Ce(s,l,b);if(0===c.length)return h("IPropertyChain cannot be zero-length."),null;var r,u=new w("filterType"),i=p[c.length-1];return i&&Ce(i.meta,l,u.pending(null,null,!0)),u.waitForAll(function(){var e=new E(o,c,f);d&&d(e),r=e},null,!0),r};return Ce(s,l,b)}var x=function(){this.changedEvent=new v,this.accessedEvent=new v};function A(e,t){var n,r=[],u=e.toPropertyArray();return u[t].isStatic&&r.push(u[t].containingType.fullName),u.slice(t).forEach(function(e,t){0!==t&&e.containingType!==n&&e.containingType.isSubclassOf(n)&&(r[r.length-1]=r[r.length-1]+"<"+e.containingType.fullName+">"),r.push(e.name),n=e.propertyType.meta}),r.join(".")}function C(t,n,r,e){void 0===r&&(r=null);var o,u,a,i,s,c,f=p(!0);r&&f.add(function(e){return e===r}),f.add(function(e){return t.isInited(e,!0)}),u=(o=t)._properties,a=t._propertyAccessSubscriptions,i=h(o._events.accessedEvent),s=i&&0<i.length,c=null!==a&&0<a.length,!s&&c&&(u.forEach(function(e,t){return e.accessed.unsubscribe(a[t].handler)}),a.length=0),s&&!c&&(a.length=0,u.forEach(function(e,t){var i=0===t?void 0:u[t-1],n=function(e){var n,r,u;r=i,u=e,(n=o).rootType.known().forEach(function(e){if(n.testConnection(e,u.property,r)){var t={property:u.property,value:u.value};t.originalEntity=u.entity,t.originalProperty=t.property,(t.property=n)._events.accessedEvent.publish(e,t)}})};e._events.accessedEvent.subscribe(n),a.push({handler:n})},o)),t._events.accessedEvent.subscribe(function(e){f(e.entity).some(function(e){return!e})||n.call(this,e)})}function I(t,n,r,e){void 0===r&&(r=null);var u=p(!0);r&&u.add(function(e){return e===r}),u.add(function(e){return t.isInited(e,!0)}),function(o,r,u){void 0===r&&(r=null);var e=h(o._events.changedEvent),t=e&&0<e.length,n=null!==u&&0<u.length;!t&&n&&(r.forEach(function(e,t){return e.changed.unsubscribe(u[t].handler)}),u.length=0),t&&!n&&(u.length=0,r.forEach(function(e,t){var i=0===t?void 0:r[t-1],n=function(e){var n,r,u;r=i,u=e,(n=o).rootType.known().forEach(function(e){if(n.testConnection(e,u.property,r)){var t={property:u.property,oldValue:u.oldValue,newValue:u.newValue};t.originalEntity=u.entity,t.originalProperty=u.property,(t.property=n)._events.changedEvent.publish(e,t)}})};e.changed.subscribe(n),u.push({handler:n})},o))}(t,t._properties,t._propertyChangeSubscriptions),t._events.changedEvent.subscribe(function(e){u(e.entity).some(function(e){return!e})||n.call(this,e)})}var S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function N(e,t){function n(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var V="_oL"+l(3,!1,!0),$=function(t){function e(e){return void 0===e&&(e=null),t.apply(this,e)||this}return N(e,t),e.isObservableList=function(e){return Object.prototype.hasOwnProperty.call(e,V)&&!0===e[V]},e._markObservable=function(e){Object.defineProperty(e,V,{configurable:!1,enumerable:!1,value:!0,writable:!1})},e.ensureObservable=function(e){return this.isObservableList(e)?e:M.implementObservableList(e)},e.create=function(e){void 0===e&&(e=null);var t=new M(e);return M.ensureObservable(t)},e}(Array),F=function(){function e(){}return e.add=function(e,t){var n=[t],r=Array.prototype.push.apply(e,n)-1;e._changedEvent.publish(e,{added:n,addedIndex:r,removed:[],removedIndex:-1})},e.remove=function(e,t){var n=Array.prototype.indexOf.call(e,t);if(-1!==n){var r=Array.prototype.splice.call(e,n,1);return e._changedEvent.publish(e,{added:[],addedIndex:-1,removed:r,removedIndex:n}),!0}},e}(),M=function(n){function r(e){void 0===e&&(e=null);var t=n.call(this,e)||this;return t.constructor===r?(r._initFields(t),$._markObservable(t)):r.implementObservableList(t),t}return N(r,n),r._initFields=function(e,t){void 0===t&&(t=null),null==t&&(t=new v),Object.defineProperty(e,"_changedEvent",{configurable:!1,enumerable:!1,value:t,writable:!1})},r.implementObservableList=function(e){return r._initFields(e),e.add=function(e){F.add(this,e)},e.remove=function(e){return F.remove(this,e)},Object.defineProperty(e,"changed",{get:function(){return this._changedEvent.asEventSubscriber()}}),r._markObservable(e),e},r.prototype.add=function(e){F.add(this,e)},r.prototype.remove=function(e){return F.remove(this,e)},Object.defineProperty(r.prototype,"changed",{get:function(){return this._changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),r}($),R=function(){function t(e,t,n,r,u,i,o,a,s,c,f,p){var l,d;void 0===f&&(f=void 0),void 0===p&&(p="client"),Object.defineProperty(this,"containingType",{enumerable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,value:t}),Object.defineProperty(this,"propertyType",{enumerable:!0,value:n}),Object.defineProperty(this,"isList",{enumerable:!0,value:!0===o}),Object.defineProperty(this,"isStatic",{enumerable:!0,value:!0===a}),this.helptext=u,this.isPersisted=s,this.isCalculated=c,r&&Object.defineProperty(this,"_label",{enumerable:!1,value:r,writable:!0}),i&&Object.defineProperty(this,"_format",{enumerable:!1,value:i,writable:!0}),p&&Object.defineProperty(this,"_origin",{enumerable:!1,value:p,writable:!0}),f&&Object.defineProperty(this,"_defaultValue",{enumerable:!1,value:f,writable:!0}),Object.defineProperty(this,"_events",{value:new k}),Object.defineProperty(this,"_propertyAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_rules",{value:[]}),Object.defineProperty(this,"getter",{value:(l=this,d=U,function(e){void 0===e&&(e=null);var t=d(l,this,e);return t})}),Object.defineProperty(this,"setter",{value:function(n,r,u){void 0===u&&(u=!1);return function(e,t){void 0===t&&(t=null),r(n,this,e,t,u)}}(this,G)}),"client"===this.origin&&this.isPersisted}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return this.containingType.model._fieldNamePrefix+"_"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changed",{get:function(){return this._events.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessed",{get:function(){return this._events.accessedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),t.prototype.getPath=function(){return this.isStatic?this.containingType+"."+this.name:this.name},t.prototype.equals=function(e){if(null!=e)return e instanceof E?e.equals(this):e instanceof t?this===e:void 0},t.prototype.toString=function(){return this.isStatic?this.containingType+"."+this.name:"this<"+this.containingType+">."+this.name},Object.defineProperty(t.prototype,"label",{get:function(){return this._label||function(e){var t,n,r,u,i;for(r=e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),t=0,n=(u=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;t<n;t++)r=r.replace(new RegExp("\\s"+u[t]+"\\s","g"),function(e){return e.toLowerCase()});for(t=0,n=(i=["Id","Tv"]).length;t<n;t++)r=r.replace(new RegExp("\\b"+i[t]+"\\b","g"),i[t].toUpperCase());return r}(this.name.replace(/([^A-Z]+)([A-Z])/g,"$1 $2"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultValue",{get:function(){return Object.prototype.hasOwnProperty.call(this,"_defaultValue")?this._defaultValue instanceof Array?this._defaultValue.slice():this._defaultValue instanceof Date?new Date(+this._defaultValue):this._defaultValue instanceof Function?this._defaultValue():this._defaultValue:(e=this.isList,t=this.propertyType,e?[]:t!==Boolean&&(t===Number?0:null));var e,t},enumerable:!0,configurable:!0}),t.prototype.canSetValue=function(e,t){if(void 0===t)return!0;if(null===t)return!0;if(t.constructor&&t.constructor.meta){for(var n=t.constructor.meta;n;n=n.baseType)if(n.ctor===this.propertyType)return!0;return!1}var r=t.constructor;switch(s(t)){case"string":r=String;break;case"number":r=Number;break;case"boolean":r=Boolean;break;case"date":r=Date;break;case"array":r=Array}return r===this.propertyType||r===Array&&this.isList&&t.every(function(e){if(e.constructor&&e.constructor.meta){for(var t=e.constructor.meta;t;t=t.baseType)if(t._jstype===this._jstype)return!0;return!1}},this)},t.prototype.value=function(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null);var r=this.isStatic?this.containingType.ctor:e;if(null==r)throw new Error("Cannot "+(1<arguments.length?"set":"get")+" value for "+(this.isStatic?"":"non-")+'static property "'+this.name+'" on type "'+this.containingType+'": target is null or undefined.');if(!(1<arguments.length))return U(this,e);G(this,e,t,n)},t.prototype.isInited=function(e){return!!(this.isStatic?this.containingType.ctor:e).hasOwnProperty(this.fieldName)},t}(),k=function(){this.changedEvent=new v,this.accessedEvent=new v,this.ruleRegisteredEvent=new v};function L(e,t){Object.defineProperty(t,e.name,{configurable:!1,enumerable:!0,get:e.getter,set:e.setter})}function D(e,t,n){var r;void 0===n&&(n=null);var u=t.isStatic?t.containingType.ctor:e;if(Object.prototype.hasOwnProperty.call(u,"_pendingInit")?r=u._pendingInit:Object.defineProperty(u,"_pendingInit",{enumerable:!1,value:r={},writable:!0}),!(2<arguments.length)){return void 0===(t.isStatic?t.containingType.ctor:e)[t.fieldName]||!0===r[t.name]}!1===n?delete r[t.name]:r[t.name]=n}function B(e,t){var n,r,u,i,o=e.isStatic?e.containingType.ctor:t;if(!t.hasOwnProperty(e.fieldName)){if(!e.isCalculated){D(o,e,!1);var a=(i=e.defaultValue,Array.isArray(i)&&(i=$.ensureObservable(i)),i);Object.defineProperty(o,e.fieldName,{value:a,writable:!0}),Array.isArray(a)&&(n=t,r=e,(u=a).changed.subscribe(function(e){if(e.added&&0<e.added.length||e.removed&&0<e.removed.length){var t={entity:n,property:r,newValue:u};t.changes=[{newItems:e.added,oldItems:e.removed}],t.collectionChanged=!0,r._events.changedEvent.publish(n,t),n._events.changedEvent.publish(n,{entity:n,property:r})}})),t._events.changedEvent.publish(t,{entity:t,property:e})}D(o,e,!0)}}function U(e,t){return B(e,t),e._events.accessedEvent.publish(t,{entity:t,property:e,value:t[e.fieldName]}),t._events.accessedEvent.publish(t,{entity:t,property:e}),t[e.fieldName]}function G(e,t,n,r,u){void 0===r&&(r=null),void 0===u&&(u=!1),B(e,t);var i=t[e.fieldName];(function(e,t,n,r,u){void 0===u&&(u=!1);if(!e.canSetValue(t,r))throw new Error("Cannot set "+e.name+"="+(void 0===r?"<undefined>":r)+" for instance "+t.meta.type.fullName+"|"+t.meta.id+": a value of type "+(e.propertyType&&e.propertyType.meta?e.propertyType.meta.fullName:a(e.propertyType))+" was expected.");{if(e.isList)throw new Error("Property set on lists is not permitted.");var i=null==n?n:n.valueOf(),o=null==r?r:r.valueOf();return i!==o&&!(e.propertyType===Number&&isNaN(i)&&isNaN(o))}})(e,t,i,n,u)&&function(e,t,n,r,u){void 0===u&&(u=null);{if(e.isList)throw new Error("Property set on lists is not implemented.");if(t.hasOwnProperty(e.fieldName)?t[e.fieldName]=r:Object.defineProperty(t,e.fieldName,{value:r,writable:!0}),D(t,e,!1),void 0!==n){var i={entity:t,property:e,newValue:r,oldValue:n};e._events.changedEvent.publish(t,u?function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r={};for(var u in e)d(e,u)&&(r[u]=e[u]);for(var i=0;i<t.length;i++){var o=t[i];for(var u in o)d(o,u)&&(r[u]=o[u])}return r}(i,u):i),t._events.changedEvent.publish(t,{entity:t,property:e})}}}(e,t,i,n,r)}function W(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=!1),e instanceof R)!function(e,t,n){void 0===n&&(n=null);var r=null;if(n){var u=t;t=function(e){e.entity===n&&u.call(this,e)},r=n}e._events.changedEvent.subscribe(t),e._propertyChangeSubscriptions.push({handler:t,context:r})}(e,t,n);else{if(!(e instanceof E))throw new Error("Invalid property passed to `Property$addChanged(prop)`.");I(e,t,n)}}var Q=function(){function e(e){0<(e=(this.expression=e).replace(/<[^>]*>/gi,function(e){return e.replace(/\./gi,function(){return"$_$"})})).length?this.steps=e.split(".").map(function(e){var t=e.match(/^([_0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]+)(<([_$0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc$]+)>)?$/i);if(!t)return null;var n={property:null,cast:null};return n.property=t[1],t[3]&&(n.cast=t[3].replace(/\$_\$/gi,function(){return"."})),n}):this.steps=[]}return e.prototype.buildExpression=function(){var t="";return this.steps.forEach(function(e){t+=(t?".":"")+e.property+(e.cast?"<"+e.cast+">":"")}),t},e.prototype.toString=function(){return this.expression},e}();function Z(e){var c=[];return e&&e.forEach(function(e){for(var t,n=e instanceof R?e.name:e instanceof E?e.path:e,r=[],u=0,i=n.length,o=0;o<i;++o){var a=n.charAt(o);if("{"===a||","===a||"}"===a){var s=n.substring(u,o).trim();u=o+1,"{"===a?t?(r.push(t),t+="."+s):t=s:(0<s.length&&c.push(new Q(t?t+"."+s:s)),"}"===a&&(t=0===r.length?void 0:r.pop()))}}if(0<r.length)throw new Error("Unclosed '{' in path: "+e);0===u&&c.push(new Q(n.trim()))}),c}var e,q=function(e,t,n){this.condition=e,this.target=t,this.properties=n,t.meta.setCondition(this)},z=function(){function e(e,t,n,r,u){void 0===u&&(u=null),this.type=e,this.message=t||(e?e.message:void 0),this.origin=u;var i=[];if(n){var o=Z(r||[]);if(o.every(function(e){return 1===e.steps.length}))i.push(new q(this,n,o.map(function(e){return n.meta.type.getProperty(e.expression)})));else for(var a=o.length-1;0<=a;a--)for(var s=o[a].steps,c=[n],f=s.length-1,p=0;p<s.length;p++){for(var l=s[p].property,d=[],h=c.length-1;0<=h;h--){var b=c[h],y=b.meta.type.getProperty(l);if(y){if(p===f){for(var v=null,g=i.length-1;0<=g;g--)if(i[g].target===b){v=i[g];break}v?v.properties.indexOf(y)<0&&v.properties.push(y):(v=new q(this,b,[y]),i.push(v))}var m=y.value(b);m instanceof T?d.push(m):m instanceof Array&&0<m.length&&m[0]instanceof T&&(d=d.concat(m))}}c=d}}if(Object.defineProperty(this,"targets",{value:i}),e!=ne()){for(var _=e,w=i.length-1;0<=w;w--){var O=(v=i[w]).target.meta;O._events.conditionsChangedEvent.publish(O,{conditionTarget:v,add:!0});for(var P=v.target.meta.type;null!=P;P=P.baseType)P._events.conditionsChangedEvent.publish(P,{conditionTarget:v,add:!0})}if(_.conditions.push(this),_._events.conditionsChangedEvent.publish(this.type,{condition:this,add:!0}),this.type.sets)for(var E=this.type.sets.length-1;0<=E;E--){var j=this.type.sets[E];j.conditions.push(this),j._events.conditionsChangedEvent.publish(j,{condition:this,add:!0})}}}return e.prototype.destroy=function(){if(this.type.sets)for(var e=this.type.sets.length-1;0<=e;e--){this.type.sets[e].conditions.remove(this)}this.type.conditions.remove(this);for(var t=this.targets.length-1;0<=t;t--){var n=this.targets[t],r=n.target.meta;r.clearCondition(n.condition.type),r._events.conditionsChangedEvent.publish(n.target.meta,{conditionTarget:n,remove:!0});for(var u=n.target.meta.type;null!=u;u=u.baseType)u._events.conditionsChangedEvent.publish(u,{conditionTarget:n,add:!1,remove:!0})}this.targets.splice(0)},e.prototype.toString=function(){return this.message},e}(),H={},J=function(){function e(e,t,n,r,u){if(H[e])throw new Error('A condition type with the code "'+e+'" has already been created.');this.code=e,this.category=t,this.message=n,this.conditions=$.create(),this.sets=r||[],this.origin=u,Object.defineProperty(this,"_events",{value:new K}),H[e]=this}return Object.defineProperty(e.prototype,"conditionsChanged",{get:function(){return this._events.conditionsChangedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.when=function(e,t,n,r){var u=t.meta.getCondition(this);return e?(r=r instanceof Function?r(t):r,u?r&&r!=u.condition.message?(u.condition.destroy(),new z(this,r,t,n,"client")):u.condition:new z(this,r,t,n,"client")):(null!=u&&u.condition.destroy(),null)},e.all=function(){var e=[];for(var t in H.keys)e.push(H[t]);return e},e.get=function(e){return H[e]},e}(),K=function(){this.conditionsChangedEvent=new v},X=function(u){function e(e,t,n,r){return void 0===r&&(r=null),u.call(this,e,"Error",t,n,r)||this}return N(e,u),e}(J),Y=function(u){function e(e,t,n,r){return void 0===r&&(r=null),u.call(this,e,"Warning",t,n,r)||this}return N(e,u),e}(J),ee=function(o){function e(e,t,n,r,u){void 0===u&&(u=null);var i=o.call(this,e,"Warning",t,n,u)||this;return i.isAllowed=r,i}return N(e,o),e}(J);(e=J||(J={})).Error=X,e.Warning=Y,e.Permission=ee;var te=function(){function e(e,t){Object.defineProperty(this,"message",{value:e}),Object.defineProperty(this,"invalidValue",{value:t})}return e.prototype.createCondition=function(e,t){return new z(ne(),this.message.replace("{property}",t.label),e,[t.name],"client")},e.prototype.toString=function(){return this.invalidValue},e}();function ne(){return te._conditionType||(te._conditionType=new X("FormatError","The value is not properly formatted.",[])),te._conditionType}var re,ue,ie=function(){function e(e,t,n,r){Object.defineProperty(this,"type",{enumerable:!0,value:e}),Object.defineProperty(this,"entity",{enumerable:!0,value:t}),Object.defineProperty(this,"_id",{enumerable:!1,value:n,writable:!0}),Object.defineProperty(this,"_isNew",{enumerable:!1,value:r,writable:!0}),Object.defineProperty(this,"_conditions",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"_events",{value:new oe})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legacyId",{get:function(){return this._legacyId},set:function(e){this._legacyId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conditionsChanged",{get:function(){return this._events.conditionsChangedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.getCondition=function(e){return this._conditions[e.code]},e.prototype.setCondition=function(e){e.condition.type!=ne()&&(this._conditions[e.condition.type.code]=e)},e.prototype.clearCondition=function(e){delete this._conditions[e.code]},e.prototype.isAllowed=function(){if(0!==arguments.length){for(var e=arguments.length-1;0<=e;e--){var t=arguments[e],n=J.get(t);if(void 0===n)return;if(!(n instanceof ee))throw new Error('Condition type "'+t+'" should be a Permission.');if(this._conditions[n.code]?!n.isAllowed:n.isAllowed)return!1}return!0}},e.prototype.destroy=function(){this.type.unregister(this.entity);for(var e=this.type;e;e=e.baseType)e._events.destroyEvent.publish(e,{entity:this.entity})},e}(),oe=function(){this.conditionsChangedEvent=new v};(ue=re||(re={}))[ue.InitExisting=2]="InitExisting",ue[ue.InitNew=4]="InitNew",ue[ue.PropertyGet=8]="PropertyGet",ue[ue.PropertyChanged=16]="PropertyChanged";var ae=null,se=function(){function e(){var e=ae;Object.defineProperty(this,"parent",{enumerable:!0,value:e}),Object.defineProperty(this,"_isActive",{enumerable:!1,value:!0,writable:!0}),Object.defineProperty(this,"_events",{value:new ce}),ae=this}return Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exitEvent",{get:function(){return this._events.exitEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"abortEvent",{get:function(){return this._events.abortEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){if(void 0===e&&(e=!1),!this.isActive)throw new Error("The event scope cannot be aborted because it is not active.");try{this._events.abortEvent.publish(this,{maxNestingExceeded:e}),this._events.abortEvent.clear(),this._events.exitEvent.clear()}finally{if(this._isActive=!1,ae&&ae===this)for(;ae&&!ae.isActive;)ae=ae.parent}},e.prototype.exit=function(){var t=this;if(!this.isActive)throw new Error("The event scope cannot be exited because it is not active.");try{var e=h(this._events.exitEvent);if(e&&0<e.length){if(null!==this.parent&&this.parent.isActive){if(this.parent.hasOwnProperty("_exitEventVersion")&&99<=this.parent._exitEventVersion)return void this.abort(!0);e.forEach(function(e){e.isOnce&&e.isExecuted||t.parent._events.exitEvent.subscribe(e.handler)}),this.parent.hasOwnProperty("_exitEventVersion")&&this.parent._exitEventVersion++}else this._exitEventVersion=0,this._exitEventHandlerCount=e.length,this._events.exitEvent.publish(this,{}),delete this._exitEventHandlerCount,delete this._exitEventVersion;this._events.abortEvent.clear(),this._events.exitEvent.clear()}}finally{if(this._isActive=!1,ae&&ae===this)for(;ae&&!ae.isActive;)ae=ae.parent}},e}(),ce=function(){this.exitEvent=new v,this.abortEvent=new v};function fe(e,t){if(void 0===t&&(t=null),null===ae)t?e.call(t):e();else{if(!ae.isActive)throw new Error("The current event scope cannot be inactive.");ae._events.exitEvent.subscribe(e.bind(t))}}function pe(e,t){if(void 0===t&&(t=null),null!==ae){if(!ae.isActive)throw new Error("The current event scope cannot be inactive.");ae._events.abortEvent.subscribe(e.bind(t))}}function le(e,t){void 0===t&&(t=null);var n=new se;try{t?e.call(t):e()}finally{n.exit()}}var de=100,he=0,be=function(){function e(e,t,n,r){if(void 0===r&&(r=!1),this.invocationTypes=0,this.predicates=[],this.returnValues=[],this.rootType=e,this.name=t||(n?n.name:null)||e.fullName+".Custom."+ ++he,n){var u=function(u){if(!u)return;var i={};return Object.keys(u).filter(function(e){var t=u[e];if("onInit"===e){if("boolean"==typeof t)return i.onInit=t,!0}else if("onInitNew"===e){if("boolean"==typeof t)return i.onInitNew=t,!0}else if("onInitExisting"===e){if("boolean"==typeof t)return i.onInitExisting=t,!0}else if("onChangeOf"===e){if(Array.isArray(t)){var n=null;return i.onChangeOf=t.filter(function(e){return"string"==typeof e||e instanceof E||e instanceof R||(n||(n=[]),n.push(e),!1)}),!n||(u.onChangeOf=n,!1)}if("string"==typeof t)return i.onChangeOf=[t],!0;if(t instanceof E)return i.onChangeOf=[t],!0;if(t instanceof R)return i.onChangeOf=[t],!0}else if("returns"===e){if(Array.isArray(t)){var r=null;return i.returns=t.filter(function(e){return"string"==typeof e||e instanceof E||e instanceof R||(r||(r=[]),!1)}),!r||(u.returns=r,!1)}if("string"==typeof t)return i.returns=[t],!0;if(t instanceof R)return i.returns=[t],!0}else{if("execute"!==e)return;if(t instanceof Function)return i.execute=t,!0}}).forEach(function(e){delete u[e]}),i}(n);u.onInit&&this.onInit(),u.onInitNew&&this.onInitNew(),u.onInitExisting&&this.onInitExisting(),u.onChangeOf&&this.onChangeOf(u.onChangeOf),u.returns&&this.returns(u.returns),u.execute instanceof Function&&(this.executeFn=u.execute)}r||e.model.registerRule(this)}return e.prototype.execute=function(e){this.executeFn&&this.executeFn(e)},e.prototype.onInitNew=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=re.InitNew,this},e.prototype.onInitExisting=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=re.InitExisting,this},e.prototype.onInit=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=re.InitNew|re.InitExisting,this},e.prototype.onChangeOf=function(e){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return e&&e.constructor===String&&(e=Array.prototype.slice.call(arguments)),this.predicates=0<this.predicates.length?this.predicates.concat(e):e,0==(this.invocationTypes&re.PropertyGet)&&(this.invocationTypes|=re.PropertyChanged),this},e.prototype.returns=function(e){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);if(e&&e.constructor===String&&(e=Array.prototype.slice.call(arguments)),!e)throw new Error("Rule must specify at least one property for returns.");return this.returnValues=0<this.returnValues.length?this.returnValues.concat(e):e,this.invocationTypes|=re.PropertyGet,this.invocationTypes&=~re.PropertyChanged,this},e.prototype.register=function(){if(this._registered)throw new Error("Rules cannot be registered more than once: "+this.name);Object.defineProperty(this,"_registered",{enumerable:!1,value:!0,writable:!1}),function(r,e){r.returnValues&&r.returnValues.forEach(function(e,t){e instanceof R||(r.returnValues[t]=r.rootType.getProperty(e))});if(r.predicates){for(var u,i=null,t=function(e){var t=r.predicates[e];if("string"==typeof t){i||(i=new w("prepare rule predicates"));var n=e;Z([t]).forEach(function(e){!function(e,t,n,r,u,i){void 0===r&&(r=!1);void 0===u&&(u=null);void 0===i&&(i=null);var o,a,s,c=null,f=null;if(e.constructor===Q)c=(f=e).expression;else{if("string"!=typeof e)throw new Error("Invalid valud for argument `pathOrTokens`.");c=e}if(t&&t._chains&&t._chains[c])return u?u.call(i||this,t._chains[c]):t._chains[c];f||(f=new Q(c));o=t instanceof Function?t.meta:t,"this"===f.steps[0].property&&f.steps[0].cast&&(o=Ie(f.steps[0].cast,n,!1).meta,f.steps.shift());if(a=function(e,t,n){Ce(e,r,function(){n.call(i||this,e.getProperty(t))})},1===f.steps.length){if(s=f.steps[0].property,!u)return o.property(s);a(o,s,u)}else{var p=f.steps.slice(0,f.steps.length-1).map(function(e){return e.property}).join("."),l=f.steps[f.steps.length-1].property,d=(Array.prototype.slice.call(arguments),function(e){if(!(o=Ie(p,n,!0)))throw new Error(e||'Error getting type "'+p+'".');if(o=o.meta,!u)return o.getProperty(l);a(o,l,u)});if(!u)return j.call(null,o,f,r)||d(null);j.call(null,o,f,r,i?u.bind(i):u,d)}}(e,r.rootType,r.rootType.model._allTypesRoot,!1,i.pending(function(e){r.predicates[n]=e},this,!0),this)},o)}else t instanceof R||t instanceof E||r.predicates.splice(e--,1);u=e},o=this,n=0;n<r.predicates.length;n++)t(n),n=u;i?i.waitForAll(e,this,!0,[r]):e(r)}}(this,me)},e}();function ye(e,t,n){var r;void 0===n&&(n=null),Object.prototype.hasOwnProperty.call(e,"_pendingInvocation")?r=e._pendingInvocation:Object.defineProperty(e,"_pendingInvocation",{enumerable:!1,value:r=[],writable:!0});var u=r.indexOf(t);if(!(2<arguments.length))return 0<=u;n&&u<0?r.push(t):!n&&0<=u&&r.splice(u,1)}function ve(e,t,n){return t instanceof e.rootType.ctor}function ge(n,r,u){ve(n,r)&&le(function(){if(ae.parent){var e,t=ae.parent;if(t._exitEventVersion)if(e=de-1,t._exitEventVersion>e)return}n.execute.call(n,r,u)})}function me(n){n.invocationTypes&re.InitNew&&n.rootType._events.initNewEvent.subscribe(function(e){ge(n,e.entity,e)}),n.invocationTypes&re.InitExisting&&n.rootType._events.initExistingEvent.subscribe(function(e){ge(n,e.entity,e)}),n.invocationTypes&re.PropertyChanged&&n.predicates.forEach(function(e){W(e,function(e){ve(n,e.entity)&&!ye(e.entity.meta,n)&&(ye(e.entity.meta,n,!0),fe(function(){ye(e.entity.meta,n,!1),ge(n,e.entity,e)}),pe(function(){ye(e.entity.meta,n,!1)}))},null,!0)}),n.invocationTypes&re.PropertyGet&&n.returnValues&&(n.returnValues.forEach(function(t){!function(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=!1),e instanceof R)!function(e,t,n){void 0===n&&(n=null);var r=e,u=null;if(n){var i=t;t=function(e){e.entity===n&&i.call(this,e)},u=n}r._events.accessedEvent.subscribe(t),r._propertyAccessSubscriptions.push({handler:t,context:u})}(e,t,n);else{if(!(e instanceof E))throw new Error("Invalid property passed to `Property$addAccessed(prop)`.");C(e,t,n)}}(t,function(e){ve(n,e.entity)&&D(e.entity,t)&&(D(e.entity,t,!1),ge(n,e.entity,e))})}),n.predicates.forEach(function(e){W(e,function(u){n.returnValues.some(function(e){return t=e,n=u.entity,0<(r=t._propertyChangeSubscriptions).length&&r.some(function(e){return e.context===n});var t,n,r})?ve(n,u.entity)&&!ye(u.entity.meta,n)&&(ye(u.entity.meta,n,!0),fe(function(){ye(u.entity.meta,n,!1),ge(n,u.entity,u)}),pe(function(){ye(u.entity.meta,n,!1)})):(n.returnValues.forEach(function(e){D(u.entity,e,!0)}),fe(function(){n.returnValues.forEach(function(e){u.entity._events.changedEvent.publish(u.entity,{entity:u.entity,property:e})})}))},null,!0)})),n.onRegister instanceof Function&&n.onRegister()}function _e(e){var t,n,r;(t=e.property,(r=t)._rules?n=r._rules:(n=[],Object.defineProperty(r,"_rules",{enumerable:!1,value:n,writable:!1})),n).push(e);var u=h(e.property._events.ruleRegisteredEvent);u&&0<u.length&&e.property._events.ruleRegisteredEvent.publish(e.property,{rule:e})}var we=function(){function e(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r="client"),Object.defineProperty(this,"model",{enumerable:!0,value:e}),Object.defineProperty(this,"fullName",{enumerable:!0,value:t}),Object.defineProperty(this,"ctor",{enumerable:!0,value:function(i,e,t){void 0===t&&(t=null);var n=e.split("."),r=n.shift(),u=i.model._allTypesRoot,o=window;for(;0<n.length;)u=f(r,u),o=f(r,o),r=n.shift();var a=r;var s,c=new Function("construct","return function "+a+" () { construct.apply(this, arguments); }")(function(){if(!Ee)if(0<arguments.length&&null!=arguments[0]&&arguments[0].constructor===String){var e=arguments[0],t=arguments[1],n=arguments[2],r=i.get(e,!0);if(r)return t&&r.init(t),r;i.register(this,e,n),t&&this.init(t);for(var u=i;u;u=u.baseType)u._events.initExistingEvent.publish(u,{entity:this})}else{var t=arguments[0],n=arguments[2];i.register(this,null,n),t&&this.set(t);for(var u=i;u;u=u.baseType)u._events.initNewEvent.publish(u,{entity:this})}});u[a]?u["$"+a]=c:u[a]=c;o[a]?o["$"+a]=c:o[a]=c;s=t?t.ctor:T;return Ee=!0,c.prototype=new s,Ee=!1,c.prototype.constructor=c,Object.defineProperty(c,"meta",{enumerable:!1,value:i,configurable:!1,writable:!1}),c}(this,t,n)}),Object.defineProperty(this,"baseType",{enumerable:!0,value:n}),this.origin=r,this.originForNewProperties=this.origin,Object.defineProperty(this,"_lastId",{enumerable:!1,value:0,writable:!0}),Object.defineProperty(this,"_pool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_legacyPool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_properties",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_derivedTypes",{enumerable:!1,value:[],writable:!1}),Object.defineProperty(this,"_events",{value:new Oe})}return Object.defineProperty(e.prototype,"destroy",{get:function(){return this._events.destroyEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initNew",{get:function(){return this._events.initNewEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initExisting",{get:function(){return this._events.initExistingEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conditionsChanged",{get:function(){return this._events.conditionsChangedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.newId=function(){for(var e,t=this;t;t=t.baseType)e=Math.max(e||0,t._lastId);var n=e+1;for(t=this;t;t=t.baseType)t._lastId=n;return"+c"+n},e.prototype.register=function(e,t,n){var r;void 0===n&&(n=!1),2===arguments.length&&Pe.call(this,t),t||(t=this.newId(),r=!0),Object.defineProperty(e,"meta",{value:new ie(this,e,t,r),configurable:!1,enumerable:!1,writable:!1});for(var u=t.toLowerCase(),i=this;i;i=i.baseType){if(i._pool.hasOwnProperty(u))throw new Error('Object "'+this.fullName+"|"+t+'" has already been registered.');i._pool[u]=e,i._known&&i._known.add(e)}if(!0===this.model.settings.createOwnProperties)for(var o in this._properties)if(Object.prototype.hasOwnProperty.call(this._properties,o)){var a=this._properties[o];a.isStatic||L(a,e)}n||this.model._events.entityRegisteredEvent.publish(this.model,{entity:e})},e.prototype.changeObjectId=function(e,t){Pe.call(this,e),Pe.call(this,t);var n=e.toLowerCase(),r=t.toLowerCase(),u=this._pool[n];if(u){u.meta.legacyId=e;for(var i=this;i;i=i.baseType)i._pool[r]=u,delete i._pool[n],i._legacyPool[n]=u;return u.meta.id=t,u}},e.prototype.unregister=function(e){for(var t=this;t;t=t.baseType)delete t._pool[e.meta.id.toLowerCase()],e.meta.legacyId&&delete t._legacyPool[e.meta.legacyId.toLowerCase()],t._known&&t._known.remove(e);this.model._events.entityUnregisteredEvent.publish(this.model,{entity:e})},e.prototype.get=function(e,t){if(void 0===t&&(t=!1),!e)throw new Error('Method "'+this.fullName+'.meta.get()" was called without a valid id argument.');var n=e.toLowerCase(),r=this._pool[n]||this._legacyPool[n];if(r&&!0===t&&r.meta.type!==this)throw new Error("The entity with id='"+e+"' is expected to be of type '"+this.fullName+"' but found type '"+r.meta.type.fullName+"'.");return r},e.prototype.known=function(){var e=this._known;if(!e){var t=[];for(var n in this._pool)Object.prototype.hasOwnProperty.call(this._pool,n)&&t.push(this._pool[n]);e=this._known=$.ensureObservable(t)}return e},e.prototype.addProperty=function(e,t,n,r,u){void 0===u&&(u={});var i,o,a,s,c=new R(this,e,t,u.label,u.helptext,u.format,n,r,u.isPersisted,u.isCalculated,u.defaultValue);if(function(e,t,n){void 0===n&&(n=null);var r="$"+e.name;Object.prototype.hasOwnProperty.call(t,r)&&!n||(t[r]=e)}(this._properties[e]=c,c.containingType.ctor),c.isStatic)a=c,s=this.ctor,Object.defineProperty(s,a.name,{configurable:!1,enumerable:!0,get:a.getter,set:a.setter});else if(!0===this.model.settings.createOwnProperties)for(var f in this._pool)Object.prototype.hasOwnProperty.call(this._pool,f)&&L(c,this._pool[f]);else i=c,o=this.ctor.prototype,Object.defineProperty(o,i.name,{configurable:!1,enumerable:!0,get:i.getter,set:i.setter});return this.model._events.propertyAddedEvent.publish(this.model,{property:c}),c},e.prototype.getProperty=function(e){for(var t,n=this;n&&!t;n=n.baseType)if(t=n._properties[e])return t;return null},Object.defineProperty(e.prototype,"properties",{get:function(){for(var e=[],t=this;null!=t;t=t.baseType)for(var n in t._properties)t._properties.hasOwnProperty(n)&&e.push(t._properties[n]);return e},enumerable:!0,configurable:!0}),e.prototype.addRule=function(e){var t;return e&&(t=e instanceof Function?{execute:e}:e),new be(this,t.name,t)},Object.defineProperty(e.prototype,"derivedTypes",{get:function(){return this._derivedTypes},enumerable:!0,configurable:!0}),e.prototype.hasModelProperty=function(e){return e.containingType===this||this.isSubclassOf(e.containingType)},e.prototype.isSubclassOf=function(t){var n=!1;return function(e,t,n,r){void 0===r&&(r=null);for(var u=e[t];null!=u;u=u[t])if(!1===n.call(r||e,u))return}(this,"baseType",function(e){if(e===t)return!(n=!0)}),n},e.prototype.toString=function(){return this.fullName},e}(),Oe=function(){this.initNewEvent=new v,this.initExistingEvent=new v,this.destroyEvent=new v,this.conditionsChangedEvent=new v};function Pe(e){if(null==e)throw new Error("Id cannot be "+(null===e?"null":"undefined")+" (entity = "+this.fullName+").");if("string"!==s(e))throw new Error("Id must be a string:  encountered id "+e+' of type "'+a(e.constructor)+'" (entity = '+this.fullName+").");if(""===e)throw new Error("Id cannot be a blank string (entity = "+this.fullName+").")}var Ee=!1;var je=["Object","String","Number","Boolean","Date","TimeSpan","Array"],Te=function(){function e(e){void 0===e&&(e=void 0),Object.defineProperty(this,"settings",{configurable:!1,enumerable:!0,value:new Ae(e),writable:!1}),Object.defineProperty(this,"_types",{value:{}}),Object.defineProperty(this,"_allTypesRoot",{value:{}}),Object.defineProperty(this,"_fieldNamePrefix",{value:"_fN"+l(3,!1,!0)}),Object.defineProperty(this,"_events",{value:new xe})}return Object.defineProperty(e.prototype,"typeAdded",{get:function(){return this._events.typeAddedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityRegistered",{get:function(){return this._events.entityRegisteredEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityUnregistered",{get:function(){return this._events.entityUnregisteredEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propertyAdded",{get:function(){return this._events.propertyAddedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.getTypes=function(){var e=[];for(var t in this._types)this._types.hasOwnProperty(t)&&e.push(this._types[t]);return e},e.prototype.addType=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n="client");var r=new we(this,e,t||null,n);return this._types[e]=r,this._events.typeAddedEvent.publish(this,{type:r}),r},e.prototype.registerRule=function(e){this._ruleQueue?e.register():this._ruleQueue.push(e)},e.prototype.registerRules=function(){var e,t=this._ruleQueue;for(delete this._ruleQueue,e=0;e<t.length;e+=1)t[e].register()},e}(),xe=function(){this.typeAddedEvent=new v,this.entityRegisteredEvent=new v,this.entityUnregisteredEvent=new v,this.propertyAddedEvent=new v},Ae=function(e){void 0===e&&(e=!1),this.createOwnProperties=!1,Object.defineProperty(this,"createOwnProperties",{configurable:!1,enumerable:!0,value:e,writable:!1})};function Ce(e,t,n){return n()}function Ie(e,t,n){void 0===n&&(n=!1);var r=e.split(".");if(1===r.length&&-1<je.indexOf(e))return t[e];for(var u=void 0,i=t,o=0;void 0!==i&&o<r.length-1;o++){var a=r[o];i=i[a]}if(void 0!==i&&(u=i[r.length-1]),void 0!==u)return u;if(!n)throw new Error('The type "'+e+'" could not be found.  Failed on step "'+a+'".')}function Se(e,t){return e[t]}var Ne=Object.prototype.hasOwnProperty;function Ve(e,t){return Ne.call(e,t)}function $e(e,t,n){Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return this[t][n]},set:function(e){this[t][n]=e}})}function Fe(){!0!==this._observable&&(this.value.accessed.subscribe(function(e){var t=this._dependencies,n=t.Vue$Dep,r=t.Model$Type,u=t.VueModel$observeEntity;if(n.target){var i=Me.call(this,e.property,t);i.depend();var o=e.entity[e.property.fieldName],a=u(o);if(a)a.ensureObservable(),a.dep.depend();else if(Array.isArray(o)){var s=e.property.propertyType;s.meta&&s.meta instanceof r&&function e(t){for(var n,r=0,u=t.length;r<u;r++)if(n=t[r],Array.isArray(n))e.call(this,n);else{var i=Le(n,this._dependencies,!0);i.ensureObservable()}}.call(this,o),function e(t){for(var n,r=0,u=t.length;r<u;r++)(n=t[r])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&e(n)}(o)}}}.bind(this)),this.value.changed.subscribe(function(e){var t=this._dependencies,n=t.VueModel$observeEntity,r=Me.call(this,e.property,t);n(e.entity).ensureObservable(),r.notify()}.bind(this)),this._observable=!0)}function Me(e){var t,n=this._dependencies.Vue$Dep,r=this.value,u=e.fieldName+"_Dep";return Ve(r,u)&&r[u]instanceof n?t=r[u]:(t=new n,Object.defineProperty(r,u,{configurable:!0,enumerable:!1,value:t,writable:!0})),t}var Re=[];function ke(e,t){if(!(null==e||0<=Re.indexOf(e))){var n=t.Model$Model,r=t.VueModel$observeEntity;e instanceof n&&(e.entityRegistered.subscribe(function(e){r(e.entity)}),e.getTypes().forEach(function(e){e.known().forEach(function(e){r(e)})}),Re.push(e))}}function Le(e,t,n){void 0===n&&(n=!1);var r=t.VueModel$EntityObserver;return Ve(e,"__ob__")&&Se(e,"__ob__")instanceof r?Se(e,"__ob__"):n?new r(e):null}function De(e,t){var n,r,u,i;return t.entitiesAreVueObservable?ke(e,t):(r=(n=t).Vue$Observer,(((u=function(e){r.apply(this,arguments),this.ensureObservable=Fe.bind(this),Object.defineProperty(this,"_dependencies",{configurable:!1,enumerable:!1,value:n,writable:!1})}).prototype=new r({})).constructor=u).prototype.walk=function(){},n.VueModel$EntityObserver=u,(i=t).VueModel$observeEntity=function(e,t){if(void 0===t&&(t=!1),e instanceof i.Model$Entity){var n=Le(e,i,!0);return t&&n&&n.vmCount++,n}},ke(e,t),t.entitiesAreVueObservable=!0),t}function Be(e,t,n){var r=n.Model$Entity;return null!=t&&t instanceof r?(e._entity=t,{}):t}function Ue(e,t){var n=t.VueModel$observeEntity,r=e;r._data=r._entity,function(e,t){for(var n,r,u=t.meta.type.properties,i=e.$options.props,o=e.$options.methods,a=0;a<u.length;a++){var s=u[a];o&&Ve(o,s.name)?s.name:i&&Ve(i,s.name)?s.name:(n=s.name,36!==(r=(n+"").charCodeAt(0))&&95!==r&&$e(e,"_data",s.name))}}(e,r._entity),n(r._entity,!0),r._entity=null}function Ge(e,t){!t.Vue$Observer&&e.__ob__&&(t.Vue$Observer=e.__ob__.constructor),!t.Vue$Dep&&e.__ob__&&e.__ob__.dep&&(t.Vue$Dep=e.__ob__.dep.constructor)}function We(e,t){e.mixin({beforeCreate:function(){this.$options.data&&function(e,t){if(e.$options.data)if(e.$options.data instanceof Function){var n=e.$options.data;e.$options.data=function(){return Be(e,n.apply(this,arguments),t)}}else t.entitiesAreVueObservable||(e.$options.data=Be(e,e.$options.data,t))}(this,t)},created:function(){var e=this;e._data&&Ge(e._data,t),e._entity&&(Ge(e._entity,t),t.entitiesAreVueObservable||De(e._entity.meta.type.model,t),Le(e._entity,t,!0).ensureObservable(),Ue(this,t))}})}var Qe=function(){function e(e){e=function(e){void 0===e&&(e=null);var t={createOwnProperties:!1,extendModel:null};e&&(Object.prototype.hasOwnProperty.call(e,"createOwnProperties")&&"boolean"==typeof e.createOwnProperties&&(t.createOwnProperties=e.createOwnProperties),Object.prototype.hasOwnProperty.call(e,"extendModel")&&"function"==typeof e.extendModel&&(t.extendModel=e.extendModel));return t}(e);var t=new Te(e.createOwnProperties);Object.defineProperty(this,"$meta",{enumerable:!0,value:t}),e.extendModel&&(Object.defineProperty(t,"_ruleQueue",{configurable:!0,enumerable:!1,value:[],writable:!1}),e.extendModel(t),t.registerRules())}return e.prototype.perform=function(e){le(e)},e.prototype.onExit=function(e){fe(e)},e}();var Ze=function(){function e(e){Object.defineProperty(this,"entity",{enumerable:!0,value:e})}return Object.defineProperty(e.prototype,"value",{get:function(){return this.entity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){return this.entity.meta.type.fullName+"|"+this.entity.meta.id},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.entity.meta.type.fullName+"|"+this.entity.meta.id},e}(),qe=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"path",{enumerable:!0,value:t})}return Object.defineProperty(e.prototype,"property",{get:function(){return this.source.value.meta.type.getProperty(this.path)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.property.label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"helptext",{get:function(){return this.property.helptext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.property.value(this.source.value)},set:function(e){this.property.value(this.source.value,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e,t=this,n=this.property.value(this.source.value);if(null==n)e="";else if(null!=this.property.format){if(Array.isArray(n))e=n.map(function(e){return t.property.format.convert(e)});else e=this.property.format.convert(n)}else if(Array.isArray(n)){e=n.map(function(e){return null==n?"":e.toString()})}else e=n.toString();return Array.isArray(e)?e.join(", "):e},set:function(e){this.value=null!=this.property.format?this.property.format.convertBack(e):e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Source['"+this.path+"']"},e}(),ze=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"_index",{enumerable:!1,value:t,writable:!0}),this.subscribeToSourceChanges()}return e.prototype.subscribeToSourceChanges=function(){var t=this;$.ensureObservable(this.source.value).changed.subscribe(function(e){0<=e.addedIndex?e.addedIndex<t.index&&(t._index+=e.added.length):0<=e.removedIndex&&e.removedIndex<t.index&&(t._index-=e.removed.length)})},Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.source.value[this.index]},set:function(e){var t=this.source.value,n=t[this.index];if(e!==n){var r=n,u=e;t[this.index]=u;var i={entity:this.source.source.value,property:this.source.property,newValue:t,oldValue:void 0};i.changes=[{newItems:[u],oldItems:[r]}],i.collectionChanged=!0,this.source.property._events.changedEvent.publish(this.source.source.value,i)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e=this.source.value[this.index];return null!=this.source.property.format?this.source.property.format.convert(e):e.toString()},set:function(e){this.value=null!=this.source.property.format?this.source.property.format.convertBack(e):e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Source["+this.index+"]"},e}();function He(e){return e instanceof Ze||(e instanceof qe||e instanceof ze)}function Je(e,t){var n=e;Ve(n,"_source")&&He(n._source)||(n._source=t),Ve(e,"$source")||Object.defineProperty(e,"$source",{configurable:!1,enumerable:!0,get:function(){return this._source},set:function(){}})}function Ke(e,t,n){void 0===n&&(n=!1);var r=e,u=t.Model$Entity;if(Ve(e,"$source"))return null;if(r._source){var i=r._source;return"string"==typeof i?null:i instanceof u?i:He(i)?i:null}if(n){var o=r._data;if(o){if(o instanceof u)return o.meta.type.fullName,r.$options._componentTag,r._source=o;if(He(o))return r.$options._componentTag,r._source=o}if(r._entity){var a=r._entity;if(a instanceof u)return a.meta.type.fullName,r.$options._componentTag,r._source=a}}}function Xe(e,t,n){void 0===n&&(n=!1);for(var r=null,u=t.Model$Entity,i=e.$parent,o=1;null!=i;i=i.$parent,o+=1){var a=i,s=a.$source;if(s)return"string"==typeof s||He(s),a.$options._componentTag,i;n&&(void 0===Ke(i,t,!0)||r||(r=i,o))}if(n&&r&&Ke(r,t)instanceof u)return r.$options._componentTag,r}function Ye(e,t){var n=Xe(e,t);if(n.$source){var r=n.$source;He(r)&&Je(e,r)}}var et=function(c){function e(e,t,n,r){void 0===r&&(r=!1);var u,i,o=this,a=void 0;if(t||(t=n.name),n){var s=function(n){if(!n)return;var r={};Object.keys(n).filter(function(e){var t=n[e];if("property"===e){if(t instanceof R)return r.property=t,!0}else{if("calculate"!==e&&"fn"!==e)return"defaultIfError"===e?(r.defaultIfError=t,!0):void 0;if(t instanceof Function)return r.calculate=t,!0;if("string"==typeof t)return r.calculate=t,!0}}).forEach(function(e){delete n[e]});return r}(n);s.property&&(u="string"==typeof s.property?e.getProperty(s.property):s.property,n.returns=[u]),t||(t=n.name=e.fullName+"."+("string"==typeof u?u:u.name)+".Calculated"),a=s.defaultIfError,i=s.calculate}return o=c.call(this,e,t,n,!0)||this,Object.defineProperty(o,"property",{enumerable:!0,value:u}),o.defaultIfError=a,i&&Object.defineProperty(o,"_calculateFn",{enumerable:!1,value:i,writable:!0}),r||e.model.registerRule(o),o}return N(e,c),e.prototype.execute=function(e){var t,n;if(this._calculateFn.constructor===String){var r=this._calculateFn,u=new Function("return "+r+";");t=this._calculateFn=u}else t=this._calculateFn;if(void 0===this.defaultIfError)n=t.call(e);else try{n=t.apply(e)}catch(e){n=this.defaultIfError}if(void 0!==n){if(this.property.isList){var i=n,o=this.property.value(e);if(i.length===o.length){for(var a=!0,s=0;s<i.length;++s)if(i[s]!==o[s]){a=!1;break}if(a)return}throw new Error("Calculated list properties are not yet implemented.")}this.property.value(e,n,{calculated:!0})}},e.prototype.toString=function(){return"calculation of "+this.property.name},e.prototype.onRegister=function(){_e(this),this.property.isCalculated=!0},e}(be);var tt=function(i){function e(e,t,n){void 0===n&&(n=!1);var r;if(0!=arguments.length){t.name=t.name||"ValidatedProperty";var u="string"==typeof t.property?e.getProperty(t.property):t.property;return t.properties?t.properties.indexOf(u.name)<0&&t.properties.indexOf(u)<0&&t.properties.push(u.name):t.properties=[u.name],t.onChangeOf?t.onChangeOf.indexOf(u.name)<0&&t.onChangeOf.indexOf(u)<0&&t.onChangeOf.push(u):t.onChangeOf=[u],t.conditionType||(t.category="Error"),t.message&&"function"!=typeof t.message&&(t.message=t.message.replace("{property}",u.label)),r=i.call(this,e,t,!0)||this,Object.defineProperty(r,"property",{value:u}),t.isValid instanceof Function&&Object.defineProperty(r,"_isValid",{value:t.isValid}),n||e.model.registerRule(r),r}}return N(e,i),e.prototype.assert=function(e){var t=this._isValid(e,this.property,this.property.value(e));return void 0===t?t:!t},e.prototype.onRegister=function(){_e(this)},e}(function(o){function e(e,t,n){void 0===n&&(n=!1);var r=this;if(0!==arguments.length){t.hasOwnProperty("onInitNew")||(t.onInitNew=!0);var u=t.conditionType;"string"==typeof u&&(u=J.get(u)),!t.hasOwnProperty("onInitExisting")&&u&&"server"!==u.origin&&(t.onInitExisting=!0),r=o.call(this,e,name,t,!0)||this;var i=t.assert||t.fn;return i&&(r.assert=i),Object.defineProperty(r,"conditionType",{value:u||function(e,t,n){void 0===n&&(n="Error");for(var r,u=t instanceof R?t.containingType.fullName+"."+t.name+"."+e:t instanceof we?t+"."+e:e,i="";J.get(u+i);)i=("string"==typeof i?0:i)+1;if("Error"===n)r=X;else{if("Warning"!==n)throw new Error("Cannot create condition type for unsupported category '"+n+"'.");r=Y}return new r(u+i,"Generated condition type for "+e+" rule.",null,"client")}(t.name,e,t.category||"ErrorConditionType")}),t.message&&Object.defineProperty(r,"message",{value:t.message,writable:!0}),Object.defineProperty(r,"properties",{value:t.properties||[],writable:!0}),n||e.model.registerRule(r),r}}return N(e,o),Object.defineProperty(e.prototype,"properties",{get:function(){return d(this,"_properties")?this._properties:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.conditionType.message},enumerable:!0,configurable:!0}),e.prototype.assert=function(e){throw new Error("ConditionRule.assert() must be passed into the constructor or overriden by subclasses.")},e.prototype.execute=function(e,t){var n;void 0===t&&(t=null),n=d(this,"assert")?("string"==typeof this.assert&&(this.assert=new Function("obj",this.assert)),this.assert.call(e,e,t)):this.assert(e);var r=this.message;d(this,"message")&&r instanceof Function&&(r=this.hasOwnProperty("message")?r.bind(e):r.bind(this)),void 0!==n&&this.conditionType.when(n,e,this.properties instanceof Function?this.properties(e):this.properties,r)},e.prototype.toString=function(){return this.message||this.conditionType.message},e}(be));!function(e,t){for(var n in t)d(t,n)&&t[n]instanceof Function&&(e.prototype[n]=t[n])}(R,{calculated:function(e){e.property=this;var t=e.rootType?e.rootType.meta:this.containingType;return delete e.rootType,new et(t,e.name,e),this},conditionIf:function(e,t){var n,r,u,i=e.rootType?e.rootType.meta:this.containingType;return delete e.rootType,n=this,u=t,(r=e).property=n,u&&u.constructor===String?r.message=u:u instanceof J&&(r.conditionType=u),new tt(i,e=r),this}});var nt,rt,ut={entitiesAreVueObservable:!1,Model$Model:Te,Model$Type:we,Model$Property:R,Model$Entity:T},it=Qe;return it.SourceRootAdapter=Ze,it.SourcePathAdapter=qe,it.SourceIndexAdapter=ze,it.mixins={SourceProvider:(rt=ut,{props:{source:{},sourceIndex:{type:Number,validator:function(e){return 0<=e}}},beforeCreate:function(){this.$options.propsData&&function(e){var t=e;if(!t._source){var n=e.$options.propsData;Ve(n,"source")&&(t._source=n.source)}}(this)},created:function(){var e=this,t=e;He(t._data)&&Je(e,t._data),e.$options.propsData&&Ve(e.$options.propsData,"source")&&function e(t,n){var r=t;if(!r._sourcePending&&t.$options.propsData){var u=t.$options.propsData;if(Ve(u,"source")){r._sourcePending=!0;var i=n.Model$Entity;r.$options._componentTag,u.source;var o=Xe(t,n,!0);if(o){var a=o,s=a._source;"string"==typeof s&&(e(o,n),s=a._source);var c=parseInt(u.source,10);isNaN(c)&&(c=null);var f=null;s instanceof i?(s.meta.type.fullName,f=new qe(new Ze(s),u.source)):He(s)&&(f=null!==c?new ze(s,parseInt(u.source,10)):new qe(s,u.source)),null!=f&&Je(t,f)}delete r._sourcePending}}}(e,rt)}}),SourceConsumer:(nt=ut,{beforeCreate:function(){var e=this,t=e,n=e.$options.data;t.$options.data=function(){return Ye(e,nt),n?n instanceof Function?n.apply(this,arguments):n:{}}},created:function(){this.$source||Ye(this,nt)}})},it.install=function(e){return We(e,ut)},it});
