!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VueExoModel={})}(this,function(e){"use strict";function a(e,t){return e[t]}var r=Object.prototype.hasOwnProperty;function f(e,t){return r.call(e,t)}var o=[];function u(e,r){if(null!=e){if(0<=o.indexOf(e))return;var t=r.ExoModel$Model,n=(r.ExoModel$Property,r.VueExoModel$observeEntity);e instanceof t&&(e.entityRegisteredEvent.subscribe(function(e,t){n(t.entity)}),e.types.forEach(function(e){e.known().forEach(function(e){n(e)})}),e.propertyAddedEvent.subscribe(function(e,t){i(t.property,r)}),e.types.forEach(function(e){e.properties.forEach(function(e){return i(e,r)})}),o.push(e))}}var t=[];function i(e,o){if(null!=e){if(0<=t.indexOf(e))return;var i=o.Vue$Dep,a=o.VueExoModel$observeEntity;e instanceof o.ExoModel$Property&&(e.accessedEvent.subscribe(function(e,t){var r=p(e,t.property,o);if(i.target){r.depend();var n=a(t.value);n?n.dep.depend():Array.isArray(t.value)&&function e(t){for(var r,n=0,o=t.length;n<o;n++)(r=t[n])&&r.__ob__&&r.__ob__.dep.depend(),Array.isArray(r)&&e(r)}(t.value)}}),e.changedEvent.subscribe(function(e,t){var r=p(e,t.property,o);a(t.newValue),r.notify()}),t.push(e))}}function p(e,t,r){var n,o=t.fieldName+"_Dep",i=r.Vue$Dep,a=e;return f(a,o)&&a[o]instanceof i?n=a[o]:(n=new i,Object.defineProperty(a,o,{configurable:!0,enumerable:!1,value:n,writable:!0})),n}function s(e,t){var r,n,o,i;return t.entitiesAreVueObservable?u(e,t):(n=(r=t).Vue$Observer,(((o=function(){n.apply(this,arguments)}).prototype=new n({})).constructor=o).prototype.walk=function(){},r.VueExoModel$EntityObserver=o,(i=t).VueExoModel$observeEntity=function(e,t){void 0===t&&(t=!1);var r,n=i.ExoModel$Entity,o=i.VueExoModel$EntityObserver;if(e instanceof n)return r=f(e,"__ob__")&&a(e,"__ob__")instanceof o?a(e,"__ob__"):new o(e),t&&r&&r.vmCount++,r},u(e,t),t.entitiesAreVueObservable=!0),t}function l(e,t,r){Object.defineProperty(e,r.name,{configurable:!0,enumerable:!0,get:function(){return this[t][r.name]},set:function(e){this[t][r.name]=e}})}function n(e,n){var o=n.ExoModel$Entity;e.mixin({beforeCreate:function(){var t=this,e=function(e){return null!=e&&e instanceof o?(t._entity=e,{}):e};if(t.$options.data)if(t.$options.data instanceof Function){var r=t.$options.data;t.$options.data=function(){return e(r.apply(this,arguments))}}else{n.entitiesAreVueObservable||(t.$options.data=e(t.$options.data))}},created:function(){var e=this;if(e._entity){n.Vue$Observer=e._data.__ob__.constructor,n.Vue$Dep=e._data.__ob__.dep.constructor;var t=s(e._entity.meta.type.model,n).VueExoModel$observeEntity;e._data=e._entity,function(e,t){for(var r,n,o=e.meta.type.properties,i=t.$options.props,a=t.$options.methods,u=0;u<o.length;u++){var p=o[u];a&&f(a,p.name)?p.name:i&&f(i,p.name)?p.name:(r=p.name,36!==(n=(r+"").charCodeAt(0))&&95!==n&&l(t,"_data",p))}}(e._entity,e),t(e._entity,!0),e._entity=null}}})}var c=function(){function e(e,t){Object.defineProperty(this,"entity",{enumerable:!0,value:e}),Object.defineProperty(this,"path",{enumerable:!0,value:t})}return Object.defineProperty(e.prototype,"property",{get:function(){return this.entity.meta.type.property(this.path)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.property.label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"helptext",{get:function(){return this.property.helptext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.property.value(this.entity)},set:function(e){this.property.value(this.entity,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e,t=this,r=this.property.value(this.entity);if(null!=this.property.format)return this.property.format.convert(r);if(null==r)e="";else if(null!=this.property.format){if(Array.isArray(r))e=r.map(function(e){return t.property.format.convert(e)});else e=this.property.format.convert(r)}else if(Array.isArray(r)){e=r.map(function(e){return null==r?"":e.toString()})}else e=r.toString();return Array.isArray(e)?e.join(", "):e},set:function(e){if(null!=this.property.format){var t=this.property.format.convertBack(e);this.property.value(this.entity,t)}else this.property.value(this.entity,e)},enumerable:!0,configurable:!0}),e}(),y={entitiesAreVueObservable:!1,ExoModel$Model:exomodel.Model,ExoModel$Entity:exomodel.Entity,ExoModel$Property:exomodel.Property};e.install=function(e){return n(e,y)},e.FieldAdapter=c,Object.defineProperty(e,"__esModule",{value:!0})});
