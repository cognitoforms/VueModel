!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueModel=t()}(this,function(){"use strict";function d(n){void 0===n&&(n=!1);var i=[];var e=function(){var e;n&&(e=[]);for(var t=0;t<i.length;++t){var r=i[t];if(!0!==r.applied&&(!r.filter||!0===r.filter.apply(this,arguments))){!0===r.once&&(r.applied=!0);var u=r.fn.apply(this,arguments);n&&e.push(u)}}if(n)return e};return e._funcs=i,e.add=t,e.remove=r,e.isEmpty=u,e.clear=o,e}function t(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var u=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);var u={fn:e};return null!=t&&(u.filter=t),null!=r&&(u.once=r),u}(e,t,r);this._funcs.push(u)}function r(e){for(var t=this._funcs.length-1;0<=t;--t)if(this._funcs[t].fn===e)return this._funcs.splice(t,1),!0;return!1}function u(t){return void 0===t&&(t=null),!this._funcs.some(function(e){return!0!==e.applied&&(!t||!e.filter||e.filter.apply(this,t))},this)}function o(){this._funcs.length=0}function n(){return"object"==typeof window&&"[object Window]"===Object.prototype.toString.call(window)?window:"object"==typeof global?global:null}function l(e,t){var r,u=t;return"string"==typeof u?(r=u.split("."),u=n(),r.forEach(function(e){if(void 0===(u=u[e]))throw new Error('Parent namespace "'+t+'" could not be found.')})):null==u&&(u=n()),e in u?u[e]:u[e]={}}function a(e,t){var r,u,n=e["get_"+t];return n?void 0===(r=n.call(e))&&(r=null):("object"===p(u=e)||u&&u instanceof Object)&&t in e||Object.prototype.hasOwnProperty.call(e,t)||e.constructor===String&&/^[0-9]+$/.test(t)&&parseInt(t,10)<e.length?void 0===(r=e[t])&&(r=null):/\./.test(t),r}function s(e,t,r,u){void 0===r&&(r=null),void 0===u&&(u=void 0);for(var n=e,i=t.split("."),o=0;o<i.length;++o){if(null===(n=a(n,i[o])))return r;if(void 0===n)return u}return n}var i=/function\s*([\w_\$]*)/i;function c(e){var t=i.exec(e.toString());return t&&t[1]||"{anonymous}"}var f=/\s([a-z|A-Z]+)/;function p(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).match(f)[1].toLowerCase()}function h(e,t){void 0===e&&(e=0),void 0===t&&(t=9);var r=Math.random();return 1===r?t:Math.floor(r*(t-e+1))+e}function b(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function y(e){var t=e._func;if(t){var r=t._funcs;return 0<r.length?r.map(function(e){return{handler:e.fn,isExecuted:e.applied,isOnce:e.once}}):null}}var v=function(){function e(){}return e.prototype.stopPropagation=function(){throw new Error("Method 'stopPropagation' is not implemented.")},e}();var g=function(){function e(e){Object.defineProperty(this,"_event",{value:e})}return e.prototype.subscribe=function(e){this._event.subscribe(e)},e.prototype.subscribeOne=function(e){this._event.subscribeOne(e)},e.prototype.unsubscribe=function(e){this._event.unsubscribe(e)},e.prototype.hasSubscribers=function(e){return this._event.hasSubscribers(e)},e.prototype.clear=function(){this._event.clear()},e}(),m=function(){function e(){}return e.prototype.asEventSubscriber=function(){return this._subscriber||Object.defineProperty(this,"_subscriber",{value:new g(this)}),this._subscriber},e.prototype.publish=function(e,t){if(this._func){var r=function(e){var t=new v;for(var r in e)b(e,r)&&(t[r]=e[r]);return t}(t);this._func.call(e,r)}},e.prototype.subscribe=function(e){this._func||Object.defineProperty(this,"_func",{value:d()}),this._func.add(e)},e.prototype.subscribeOne=function(e){this._func||Object.defineProperty(this,"_func",{value:d()}),this._func.add(e,null,!0)},e.prototype.hasSubscribers=function(t){return!!this._func&&this._func._funcs.some(function(e){return e.fn===t})},e.prototype.unsubscribe=function(e){this._func&&this._func.remove(e)},e.prototype.clear=function(){this._func&&this._func.clear()},e}(),_=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function w(e,t){function r(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var P={"allowed-values":"{property} is not in the list of allowed values.","compare-after":"{property} must be after {compareSource}.","compare-before":"{property} must be before {compareSource}.","compare-equal":"{property} must be the same as {compareSource}.","compare-greater-than":"{property} must be greater than {compareSource}.","compare-greater-than-or-equal":"{property} must be greater than or equal to {compareSource}.","compare-less-than":"{property} must be less than {compareSource}.","compare-less-than-or-equal":"{property} must be less than or equal to {compareSource}.","compare-not-equal":"{property} must be different from {compareSource}.","compare-on-or-after":"{property} must be on or after {compareSource}.","compare-on-or-before":"{property} must be on or before {compareSource}.","listlength-at-least":"Please specify at least {min} {property}.","listlength-at-most":"Please specify no more than {max} {property}.","listlength-between":"Please specify between {min} and {max} {property}.","range-at-least":"{property} must be at least {min}.","range-at-most":"{property} must be at most {max}.","range-between":"{property} must be between {min} and {max}.","range-on-or-after":"{property} must be on or after {min}.","range-on-or-before":"{property} must be on or before {max}.",required:"{property} is required.","required-if-after":"{property} is required when {compareSource} is after {compareValue}.","required-if-before":"{property} is required when {compareSource} is before {compareValue}.","required-if-equal":"{property} is required when {compareSource} is {compareValue}.","required-if-exists":"{property} is required when {compareSource} is specified.","required-if-greater-than":"{property} is required when {compareSource} is greater than {compareValue}.","required-if-greater-than-or-equal":"{property} is required when {compareSource} is greater than or equal to {compareValue}.","required-if-less-than":"{property} is required when {compareSource} is less than {compareValue}.","required-if-less-than-or-equal":"{property} is required when {compareSource} is less than or equal to {compareValue}.","required-if-not-equal":"{property} is required when {compareSource} is not {compareValue}.","required-if-not-exists":"{property} is required when {compareSource} is not specified.","required-if-on-or-after":"{property} is required when {compareSource} is on or after {compareValue}.","required-if-on-or-before":"{property} is required when {compareSource} is on or before {compareValue}.","string-format":"{property} must be formatted as {formatDescription}.","string-length-at-least":"{property} must be at least {min} characters.","string-length-at-most":"{property} must be at most {max} characters.","string-length-between":"{property} must be between {min} and {max} characters.","format-with-description":"{property} must be formatted as {description}.","format-without-description":"{property} is not properly formatted.","format-currency":"$#,###.##","format-percentage":"#.##%","format-integer":"#,###","format-decimal":"#,###.##",get:function(e){return this[e]}},O=null,x=!1,E=function(){function e(e){Object.defineProperty(this,"label",{enumerable:!0,value:e}),Object.defineProperty(this,"_waitForAll",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"_pending",{enumerable:!1,value:0,writable:!0})}return Object.defineProperty(e.prototype,"isActive",{get:function(){return 0<this._pending},enumerable:!0,configurable:!0}),e.prototype.pending=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);var u=function(e,t,r,u){void 0===r&&(r=null);void 0===u&&(u=null);var n=!1;return function(){T("pending",r||this,function(){n||(n=!0,t&&t.apply(this,arguments),e.decrement())},0<arguments.length?Array.prototype.slice.call(arguments):null,u)}}(this,e,t,r);return this._pending++,u},e.prototype.waitForAll=function(e,t,r,u){void 0===t&&(t=null),void 0===r&&(r=null),void 0===u&&(u=null),e&&(0===this._pending?T("waitForAll",t,e,u,r):this._waitForAll.push({callback:e,thisPtr:t,executeImmediately:r,args:u}))},e.prototype.decrement=function(){for(--this._pending;0===this._pending&&0<this._waitForAll.length;){var e=this._waitForAll.shift();T("waitForAll",e.thisPtr,e.callback,e.args,e.executeImmediately)}},e}(),j=function u(n,i){void 0===i&&(i=null),setTimeout(function(){var e,t,r=("number"!==p(t=null)||isNaN(t),null);r&&O.length>r?(e=O.splice(0,r),u(n,i)):(e=O,O=null),e.forEach(function(e){return e.apply(n,i)})},1)};function T(e,t,r,u,n){if(void 0===u&&(u=null),void 0===n&&(n=null),!1===n||!0===x){var i=!1;null===O&&(O=[],i=!0),O.push(function(){r.apply(t,u||[])}),i&&j(t,u)}else r.apply(t,u||[])}var S=function(){function d(e,t,r){Object.defineProperty(this,"rootType",{enumerable:!0,value:e}),Object.defineProperty(this,"_properties",{value:t}),Object.defineProperty(this,"_propertyFilters",{value:r||new Array(t.length)}),Object.defineProperty(this,"_propertyAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChainAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChainChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_events",{value:new V})}return Object.defineProperty(d.prototype,"changed",{get:function(){return this._events.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"accessed",{get:function(){return this._events.accessedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),d.prototype.equals=function(e){if(null!=e){if(e instanceof J)return 1===this._properties.length&&this._properties[0]===e;if(e instanceof d){if(e._properties.length!==this._properties.length)return!1;for(var t=0;t<this._properties.length;t++)if(!this._properties[t].equals(e._properties[t]))return!1;return!0}}},d.prototype.forEach=function(e,t,r,u){if(void 0===r&&(r=null),void 0===u&&(u=null),null==e)throw new Error("Argument 'obj' cannot be null or undefined.");if(null==t)throw new Error("Argument 'callback' cannot be null or undefined.");if("function"!=typeof t)throw new Error("Argument 'callback' must be of type function: "+t+".");for(var n=arguments[4]||e,i=arguments[6]||null,o=this._properties.slice(arguments[5]||0),a=arguments[5]||0;a<this._properties.length;a++){var s=this._properties[a],c=a===this._properties.length-1||u&&i===u,f=!u||i===u;if(n instanceof Array){for(var l=0;l<n.length;++l)if(!this._propertyFilters||!this._propertyFilters[a]||this._propertyFilters[a](n[l])){if(f&&!1===t.call(r||this,n[l],l,n,s,a,o))return!1;if(!c){var p=s.value(n[l]);if(!p||!1===d.prototype.forEach.call(this,e,t,r,u,p,a+1,s))return!1}}return!0}if(this._propertyFilters&&this._propertyFilters[a]&&!1===this._propertyFilters[a](n))break;if(f&&!1===t.call(r||this,n,-1,null,s,a,o))return!1;if(c)break;if(null==(n=n[s.fieldName]))break;i=s}return!0},Object.defineProperty(d.prototype,"path",{get:function(){if(!this._path){var e=A(this,0);Object.defineProperty(this,"_path",{enumerable:!1,value:e,writable:!0})}return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"firstProperty",{get:function(){return this._properties[0]},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lastProperty",{get:function(){return this._properties[this._properties.length-1]},enumerable:!0,configurable:!0}),d.prototype.toPropertyArray=function(){return this._properties.slice()},d.prototype.getLastTarget=function(e,t){void 0===t&&(t=!1);for(var r=0;r<this._properties.length-1;r++){var u=this._properties[r];if(null==e){if(t)return e;throw new Error("Property chain is not complete.")}e=u.value(e)}return e},d.prototype.append=function(e){var t=this._properties.slice(),r=this._propertyFilters?this._propertyFilters.slice():new Array(this._properties.length);if(e instanceof J)t.push(e),r.push(null);else{if(!(e instanceof d))throw new Error("Method `IPropertyChain.append(prop)` expects an argument of type `IProperty` or `IPropertyChain`.");Array.prototype.push.apply(t,e._properties),Array.prototype.push.apply(r,e._propertyFilters||new Array(e._properties.length))}return new d(this.rootType,t,r)},d.prototype.prepend=function(e){var t,r,u;if(e instanceof J)t=this._properties.slice(),u=this._propertyFilters.slice(),r=e.containingType,t.splice(0,0,e),u.splice(0,0,null);else{if(!(e instanceof d))throw new Error("Method `IPropertyChain.prepend(prop)` expects an argument of type `IProperty` or `IPropertyChain`.");t=this._properties.slice(),u=this._propertyFilters.slice(),r=e._properties[0].containingType;var n=[0,0];Array.prototype.splice.apply(t,n.concat(e._properties)),Array.prototype.splice.apply(u,n.concat(e._propertyFilters||new Array(e._properties.length)))}return new d(r,t,u)},d.prototype.canSetValue=function(e,t){return this.lastProperty.canSetValue(this.getLastTarget(e),t)},d.prototype.testConnection=function(e,t,r){var u=!1;return r?(this.forEach(e,function(e){if(e===t)return!(u=!0)},this,r),u):e===t},d.prototype.getRootedPath=function(e){for(var t=0;t<this._properties.length;t++)if(e.hasModelProperty(this._properties[t])){var r=A(this,t);return this._properties[t].isStatic?this._properties[t].containingType+"."+r:r}},Object.defineProperty(d.prototype,"propertyType",{get:function(){return this.lastProperty.propertyType},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"format",{get:function(){return this.lastProperty.format},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isList",{get:function(){return this.lastProperty.isList},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"label",{get:function(){return this.lastProperty.label},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"helptext",{get:function(){return this.lastProperty.helptext},enumerable:!0,configurable:!0}),d.prototype.value=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null);var u=this.getLastTarget(e),n=this.lastProperty;if(1<arguments.length)n.value(u,t,r);else if(u)return n.value(u)},d.prototype.isInited=function(e,o){void 0===o&&(o=!1);var a=!0,s=[],t=arguments[2]||0,r=arguments[3]||null,u=this._properties.length-t;return d.prototype.forEach.call(this,e,function(e,t,r,u,n,i){return r&&o?(r.every(function(e){return this.isInited(e,!0,n,i[n-1])},this)?Array.prototype.push.apply(s,i.slice(n)):a=!1,!1):u.isInited(e)?void(r&&0!==t||s.push(u)):a=!1},this,null,e,t,r),a&&(!o||s.length===u)},d.prototype.getPath=function(){return this.path},d.prototype.toString=function(){var e=this._properties.map(function(e){return e.name}).join(".");return"this<"+this.rootType+">."+e},d}();function C(o,a){var s=o,c=[],f=[],l=[],p=!!(3<=arguments.length&&arguments[2]&&arguments[2].constructor===Boolean)&&arguments[2],d=4<=arguments.length&&arguments[3]&&arguments[3]instanceof Function?arguments[3]:null,h=5<=arguments.length&&arguments[4]&&arguments[4]instanceof Function?arguments[4]:function(e){if(d)throw new Error(e)},b=function(){var e=a.steps.shift();if(!e)return h("Syntax error in property path: "+a.expression),null;var t=s.getProperty(e.property);if(!t)return h("Path '"+a.expression+"' references unknown property \""+e.property+'" on type "'+s+'".'),null;if(t.isStatic)return h("Path '"+a.expression+"' references static property \""+e.property+'" on type "'+s+'".'),null;if(c.push(t),e.cast){if(!(s=et(e.cast,o.model._allTypesRoot,!0).meta))return h("Path '"+a.expression+"' references an invalid type: \""+e.cast+'".'),null;var r=s.jstype;l[c.length]=r,f[c.length]=function(e){return e instanceof r}}else s=t.propertyType.meta;if(0<a.steps.length)return Xe(s,p,b);if(0===c.length)return h("IPropertyChain cannot be zero-length."),null;var u,n=new E("filterType"),i=l[c.length-1];return i&&Xe(i.meta,p,n.pending(null,null,!0)),n.waitForAll(function(){var e=new S(o,c,f);d&&d(e),u=e},null,!0),u};return Xe(s,p,b)}var V=function(){this.changedEvent=new m,this.accessedEvent=new m};function A(e,t){var r,u=[],n=e.toPropertyArray();return n[t].isStatic&&u.push(n[t].containingType.fullName),n.slice(t).forEach(function(e,t){0!==t&&e.containingType!==r&&e.containingType.isSubclassOf(r)&&(u[u.length-1]=u[u.length-1]+"<"+e.containingType.fullName+">"),u.push(e.name),r=e.propertyType.meta}),u.join(".")}function I(t,r,u,e){void 0===u&&(u=null);var n,o,a,s,i,c,f,l=d(!0),p=null;u&&(l.add(function(e){return e===u}),p=u),l.add(function(e){return t.isInited(e,!0)}),a=(o=t)._properties,s=t._propertyAccessSubscriptions,i=y(o._events.accessedEvent),c=i&&0<i.length,f=null!==s&&0<s.length,!c&&f&&(a.forEach(function(e,t){return e.accessed.unsubscribe(s[t].handler)}),s.length=0),c&&!f&&(s.length=0,a.forEach(function(e,t){var i=0===t?void 0:a[t-1],r=function(e){var r,u,n;u=i,n=e,(r=o).rootType.known().forEach(function(e){if(r.testConnection(e,n.property,u)){var t={property:n.property,value:n.value};t.originalEntity=n.entity,t.originalProperty=t.property,(t.property=r)._events.accessedEvent.publish(e,t)}})};e._events.accessedEvent.subscribe(r),s.push({registeredHandler:r,handler:r})},o)),n=function(e){l(e.entity).some(function(e){return!e})||r.call(this,e)},t._events.accessedEvent.subscribe(n),t._propertyChainAccessSubscriptions.push({registeredHandler:n,handler:r,context:p})}function N(t,r,u,e){void 0===u&&(u=null);var n,i,o=d(!0);u&&(o.add(function(e){return e===u}),n=u),o.add(function(e){return t.isInited(e,!0)}),function(o,u,n){void 0===u&&(u=null);var e=y(o._events.changedEvent),t=e&&0<e.length,r=null!==n&&0<n.length;!t&&r&&(u.forEach(function(e,t){return e.changed.unsubscribe(n[t].registeredHandler)}),n.length=0),t&&!r&&(n.length=0,u.forEach(function(e,t){var i=0===t?void 0:u[t-1],r=function(e){var r,u,n;u=i,n=e,(r=o).rootType.known().forEach(function(e){if(r.testConnection(e,n.property,u)){var t={property:n.property,oldValue:n.oldValue,newValue:n.newValue};t.originalEntity=n.entity,t.originalProperty=n.property,(t.property=r)._events.changedEvent.publish(e,t)}})};e.changed.subscribe(r),n.push({registeredHandler:r,handler:r})},o))}(t,t._properties,t._propertyChangeSubscriptions),i=function(e){o(e.entity).some(function(e){return!e})||r.call(this,e)},t._events.changedEvent.subscribe(i),t._propertyChainChangeSubscriptions.push({registeredHandler:i,handler:r,context:n})}var F,e,R=function(){function r(){}return r.isObservableArray=function(e){return b(e,"__ob__")&&e.__ob__.constructor===z},r.ensureObservable=function(e){return this.isObservableArray&&r.isObservableArray(e)?e:b(e,"__ob__")?void 0:(Object.defineProperty(e,"__ob__",{configurable:!1,enumerable:!1,value:new z(e),writable:!1}),Object.defineProperty(e,"changed",{configurable:!1,enumerable:!0,get:function(){return this.__ob__.changedEvent.asEventSubscriber()}}),e.batchUpdate=k,$.call(e),e)},r.create=function(e){void 0===e&&(e=null);var t=new(q.bind.apply(q,[void 0].concat(e)));return r.ensureObservable(t),t},r}();(e=F||(F={}))[e.remove=0]="remove",e[e.add=1]="add",e[e.replace=2]="replace",e[e.reorder=4]="reorder";var q=function(u){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=u.apply(this,e)||this;return Object.defineProperty(r,"__ob__",{configurable:!1,enumerable:!1,value:new z(r),writable:!1}),Object.defineProperty(r,"changed",{get:function(){return this.__ob__.changedEvent.asEventSubscriber()}}),r.constructor!==n&&(r.batchUpdate=function(e){k.call(this,e)},$.call(r)),r}return w(n,u),Object.defineProperty(n.prototype,"changed",{get:function(){return this.__ob__.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),n.prototype.batchUpdate=function(e){k.call(this,e)},n.prototype.copyWithin=function(e,t,r){return D.apply(this,arguments)},n.prototype.fill=function(e,t,r){return L.apply(this,arguments)},n.prototype.pop=function(){return H.apply(this,arguments)},n.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return M.apply(this,arguments)},n.prototype.reverse=function(){return B.apply(this,arguments)},n.prototype.shift=function(){return Q.apply(this,arguments)},n.prototype.sort=function(e){return U.apply(this,arguments)},n.prototype.splice=function(e,t){for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];return W.apply(this,arguments)},n.prototype.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Z.apply(this,arguments)},n}(Array);function $(){this.copyWithin=D,this.fill=L,this.pop=H,this.push=M,this.reverse=B,this.shift=Q,this.sort=U,this.splice=W,this.unshift=Z}function k(e){this.__ob__.startQueueingChanges();try{e(this),this.__ob__.stopQueueingChanges(!0)}finally{this.__ob__._isQueuingChanges&&this.__ob__.stopQueueingChanges(!1)}}function D(e,t,r){return Array.prototype.copyWithin.apply(this,arguments),this.__ob__.raiseEvents({type:F.replace,startIndex:t,endIndex:r}),this}function L(e,t,r){return Array.prototype.fill.apply(this,arguments),this.__ob__.raiseEvents({type:F.replace,startIndex:t,endIndex:r}),this}function H(){var e=this.length,t=Array.prototype.pop.apply(this,arguments);if(this.length!==e){var r=e-1;this.__ob__.raiseEvents({type:F.remove,startIndex:r,endIndex:r,items:[t]})}return t}function M(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.length,u=Array.prototype.push.apply(this,arguments);return 0<u&&this.__ob__.raiseEvents({type:F.add,startIndex:r,endIndex:r+u,items:e}),u}function B(){return Array.prototype.reverse.apply(this,arguments),this.__ob__.raiseEvents({type:F.reorder,startIndex:0,endIndex:this.length-1}),this}function Q(){var e=this.length,t=Array.prototype.shift.apply(this,arguments);return this.length!==e&&this.__ob__.raiseEvents({type:F.remove,startIndex:0,endIndex:0,items:[t]}),t}function U(e){Array.prototype.sort.apply(this,arguments);return this.__ob__.raiseEvents({type:F.reorder,startIndex:0,endIndex:this.length-1}),this}function W(e,t){for(var r=[],u=2;u<arguments.length;u++)r[u-2]=arguments[u];var n=Array.prototype.splice.apply(this,arguments);if(0<n.length||0<r.length){var i=[];0<n.length&&i.push({type:F.remove,startIndex:e,endIndex:e+n.length-1,items:n}),0<r.length&&i.push({type:F.add,startIndex:e,endIndex:e+r.length-1,items:r}),this.__ob__.raiseEvents(i)}return n}function Z(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.length,u=Array.prototype.unshift.apply(this,arguments);return u!==r&&this.__ob__.raiseEvents({type:F.add,startIndex:0,endIndex:e.length-1,items:e}),u}var z=function(){function e(e){this.array=e,this.changedEvent=new m,this._isQueuingChanges=!1}return e.prototype.raiseEvents=function(e){this._isQueuingChanges?(this._queuedChanges||(this._queuedChanges=[]),Array.isArray(e)?Array.prototype.push.apply(this._queuedChanges,e):this._queuedChanges.push(e)):Array.isArray(e)?this.changedEvent.publish(this.array,{changes:e}):this.changedEvent.publish(this.array,{changes:[e]})},e.prototype.startQueueingChanges=function(){this._isQueuingChanges=!0,this._queuedChanges||(this._queuedChanges=[])},e.prototype.stopQueueingChanges=function(e){this._isQueuingChanges=!1,e&&(this.raiseEvents(this._queuedChanges),delete this._queuedChanges)},e}();function G(e,t,r,u,n){var i,o=e;if(u&&(i=1<u&&o.removeRange?o.removeRange(r,u):1===u&&o.remove?[o.removeAt(r)]:e.splice(r,u),t&&t.push({action:"remove",oldStartingIndex:r,oldItems:i,newStartingIndex:null,newItems:null})),0<n.length){if(1<n.length&&o.insertRange)o.insertRange(r,n);else if(1===n.length&&o.insert)o.insert(r,n[0]);else{var a=n.slice();a.splice(0,0,r,0),e.splice.apply(e,a)}t&&t.push({action:"add",oldStartingIndex:null,oldItems:null,newStartingIndex:r,newItems:n})}}function Y(e,t){for(var r=arguments[2]?[]:null,u=0,n=0,i=0;n<e.length;)e[n]===t[i]?u=n=u===n&&u===i?i=u+1:(G(e,r,u,n-u,t.slice(u,i)),i+=1):i>=t.length?(i=u,n+=1):i+=1;return G(e,r,u,n-u,t.slice(u,Math.max(i,t.length))),r}var J=function(){function t(e,t,r,u,n,i,o,a,s,c,f,l){var p,d;void 0===f&&(f=void 0),void 0===l&&(l="client"),Object.defineProperty(this,"containingType",{enumerable:!0,value:e}),Object.defineProperty(this,"name",{enumerable:!0,value:t}),Object.defineProperty(this,"propertyType",{enumerable:!0,value:r}),Object.defineProperty(this,"isList",{enumerable:!0,value:!0===o}),Object.defineProperty(this,"isStatic",{enumerable:!0,value:!0===a}),this.helptext=n,this.isPersisted=s,this.isCalculated=c,u&&Object.defineProperty(this,"_label",{enumerable:!1,value:u,writable:!0}),i&&Object.defineProperty(this,"_format",{enumerable:!1,value:i,writable:!0}),l&&Object.defineProperty(this,"_origin",{enumerable:!1,value:l,writable:!0}),f&&Object.defineProperty(this,"_defaultValue",{enumerable:!1,value:f,writable:!0}),Object.defineProperty(this,"_events",{value:new K}),Object.defineProperty(this,"_propertyAccessSubscriptions",{value:[]}),Object.defineProperty(this,"_propertyChangeSubscriptions",{value:[]}),Object.defineProperty(this,"_rules",{value:[]}),Object.defineProperty(this,"getter",{value:(p=this,d=ue,function(e){void 0===e&&(e=null);var t=d(p,this,e);return t})}),Object.defineProperty(this,"setter",{value:function(r,u,n){void 0===n&&(n=!1);return function(e,t){void 0===t&&(t=null),u(r,this,e,t,n)}}(this,ne)}),"client"===this.origin&&this.isPersisted}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return this.containingType.model._fieldNamePrefix+"_"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changed",{get:function(){return this._events.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessed",{get:function(){return this._events.accessedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ruleRegistered",{get:function(){return this._events.ruleRegisteredEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),t.prototype.getPath=function(){return this.isStatic?this.containingType+"."+this.name:this.name},t.prototype.equals=function(e){if(null!=e)return e instanceof S?e.equals(this):e instanceof t?this===e:void 0},t.prototype.toString=function(){return this.isStatic?this.containingType+"."+this.name:"this<"+this.containingType+">."+this.name},Object.defineProperty(t.prototype,"label",{get:function(){return this._label||function(e){var t,r,u,n,i;for(u=e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),t=0,r=(n=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;t<r;t++)u=u.replace(new RegExp("\\s"+n[t]+"\\s","g"),function(e){return e.toLowerCase()});for(t=0,r=(i=["Id","Tv"]).length;t<r;t++)u=u.replace(new RegExp("\\b"+i[t]+"\\b","g"),i[t].toUpperCase());return u}(this.name.replace(/([^A-Z]+)([A-Z])/g,"$1 $2"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultValue",{get:function(){return Object.prototype.hasOwnProperty.call(this,"_defaultValue")?this._defaultValue instanceof Array?this._defaultValue.slice():this._defaultValue instanceof Date?new Date(+this._defaultValue):this._defaultValue instanceof Function?this._defaultValue():this._defaultValue:(e=this.isList,t=this.propertyType,e?[]:t!==Boolean&&(t===Number?0:null));var e,t},enumerable:!0,configurable:!0}),t.prototype.canSetValue=function(e,t){if(void 0===t)return!0;if(null===t)return!0;if(t.constructor&&t.constructor.meta){for(var r=t.constructor.meta;r;r=r.baseType)if(r.jstype===this.propertyType)return!0;return!1}var u=t.constructor;switch(p(t)){case"string":u=String;break;case"number":u=Number;break;case"boolean":u=Boolean;break;case"date":u=Date;break;case"array":u=Array}return u===this.propertyType||u===Array&&this.isList&&t.every(function(e){if(e.constructor&&e.constructor.meta){for(var t=e.constructor.meta;t;t=t.baseType)if(t._jstype===this._jstype)return!0;return!1}},this)},t.prototype.value=function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null);var u=this.isStatic?this.containingType.jstype:e;if(null==u)throw new Error("Cannot "+(1<arguments.length?"set":"get")+" value for "+(this.isStatic?"":"non-")+'static property "'+this.name+'" on type "'+this.containingType+'": target is null or undefined.');if(!(1<arguments.length))return ue(this,e);ne(this,e,t,r)},t.prototype.isInited=function(e){return!!(this.isStatic?this.containingType.jstype:e).hasOwnProperty(this.fieldName)},t}(),K=function(){this.changedEvent=new m,this.accessedEvent=new m,this.ruleRegisteredEvent=new m};function X(e,t){if(e.format)return e.format.convert(t)}function ee(e,t){Object.defineProperty(t,e.name,{configurable:!1,enumerable:!0,get:e.getter,set:e.setter})}function te(e,t,r){var u;void 0===r&&(r=null);var n=t.isStatic?t.containingType.jstype:e;if(Object.prototype.hasOwnProperty.call(n,"_pendingInit")?u=n._pendingInit:Object.defineProperty(n,"_pendingInit",{enumerable:!1,value:u={},writable:!0}),!(2<arguments.length)){return void 0===(t.isStatic?t.containingType.jstype:e)[t.fieldName]||!0===u[t.name]}!1===r?delete u[t.name]:u[t.name]=r}function re(e,t){var r,u,n,i,o=e.isStatic?e.containingType.jstype:t;if(!t.hasOwnProperty(e.fieldName)){te(o,e,!1);var a=(i=e.defaultValue,Array.isArray(i)&&(i=R.ensureObservable(i)),i);Object.defineProperty(o,e.fieldName,{value:a,writable:!0}),Array.isArray(a)&&(r=t,u=e,(n=a).changed.subscribe(function(e){var t={entity:r,property:u,newValue:n};t.changes=e.changes,t.collectionChanged=!0,u._events.changedEvent.publish(r,t),r._events.changedEvent.publish(r,{entity:r,property:u})})),t._events.changedEvent.publish(t,{entity:t,property:e}),te(o,e,!0)}}function ue(e,t){return re(e,t),e._events.accessedEvent.publish(t,{entity:t,property:e,value:t[e.fieldName]}),t._events.accessedEvent.publish(t,{entity:t,property:e}),t[e.fieldName]}function ne(e,t,r,u,n){void 0===u&&(u=null),void 0===n&&(n=!1),re(e,t);var i=t[e.fieldName];(function(e,t,r,u,n){void 0===n&&(n=!1);if(!e.canSetValue(t,u))throw new Error("Cannot set "+e.name+"="+(void 0===u?"<undefined>":u)+" for instance "+t.meta.type.fullName+"|"+t.meta.id+": a value of type "+(e.propertyType&&e.propertyType.meta?e.propertyType.meta.fullName:c(e.propertyType))+" was expected.");{if(e.isList)throw new Error("Property set on lists is not permitted.");var i=null==r?r:r.valueOf(),o=null==u?u:u.valueOf();return i!==o&&!(e.propertyType===Number&&isNaN(i)&&isNaN(o))}})(e,t,i,r,n)&&function(e,t,r,u,n){void 0===n&&(n=null);if(e.isList){var i=r;i.batchUpdate(function(e){Y(e,u)})}else{var o=r;if(t.hasOwnProperty(e.fieldName)?t[e.fieldName]=u:Object.defineProperty(t,e.fieldName,{value:u,writable:!0}),te(t,e,!1),void 0!==o){var a={entity:t,property:e,newValue:u,oldValue:o};e._events.changedEvent.publish(t,n?function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var u={};for(var n in e)b(e,n)&&(u[n]=e[n]);for(var i=0;i<t.length;i++){var o=t[i];for(var n in o)b(o,n)&&(u[n]=o[n])}return u}(a,n):a),t._events.changedEvent.publish(t,{entity:t,property:e})}}}(e,t,i,r,u)}function ie(e,t,r,u){if(void 0===r&&(r=null),void 0===u&&(u=!1),e instanceof J)!function(e,t,r){void 0===r&&(r=null);var u=null,n=null;r&&(n=function(e){e.entity===r&&t.call(this,e)},u=r),e._events.changedEvent.subscribe(n||t),e._propertyChangeSubscriptions.push({registeredHandler:n||t,handler:t,context:u})}(e,t,r);else{if(!(e instanceof S))throw new Error("Invalid property passed to `Property$addChanged(prop)`.");N(e,t,r)}}var oe=function(){function e(e){0<(e=(this.expression=e).replace(/<[^>]*>/gi,function(e){return e.replace(/\./gi,function(){return"$_$"})})).length?this.steps=e.split(".").map(function(e){var t=e.match(/^([_0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]+)(<([_$0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc$]+)>)?$/i);if(!t)return null;var r={property:null,cast:null};return r.property=t[1],t[3]&&(r.cast=t[3].replace(/\$_\$/gi,function(){return"."})),r}):this.steps=[]}return e.prototype.buildExpression=function(){var t="";return this.steps.forEach(function(e){t+=(t?".":"")+e.property+(e.cast?"<"+e.cast+">":"")}),t},e.prototype.toString=function(){return this.expression},e}();function ae(e){var c=[];return e&&e.forEach(function(e){for(var t,r=e instanceof J?e.name:e instanceof S?e.path:e,u=[],n=0,i=r.length,o=0;o<i;++o){var a=r.charAt(o);if("{"===a||","===a||"}"===a){var s=r.substring(n,o).trim();n=o+1,"{"===a?t?(u.push(t),t+="."+s):t=s:(0<s.length&&c.push(new oe(t?t+"."+s:s)),"}"===a&&(t=0===u.length?void 0:u.pop()))}}if(0<u.length)throw new Error("Unclosed '{' in path: "+e);0===n&&c.push(new oe(r.trim()))}),c}var se,ce=function(e,t,r){this.condition=e,this.target=t,this.properties=r,t.meta.setCondition(this)},fe=function(){function e(e,t,r,u,n){void 0===n&&(n=null),this.type=e,this.message=t||(e?e.message:void 0),this.origin=n;var i=[];if(r){var o=ae(u||[]);if(o.every(function(e){return 1===e.steps.length}))i.push(new ce(this,r,o.map(function(e){return r.meta.type.getProperty(e.expression)})));else for(var a=o.length-1;0<=a;a--)for(var s=o[a].steps,c=[r],f=s.length-1,l=0;l<s.length;l++){for(var p=s[l].property,d=[],h=c.length-1;0<=h;h--){var b=c[h],y=b.meta.type.getProperty(p);if(y){if(l===f){for(var v=null,g=i.length-1;0<=g;g--)if(i[g].target===b){v=i[g];break}v?v.properties.indexOf(y)<0&&v.properties.push(y):(v=new ce(this,b,[y]),i.push(v))}var m=y.value(b);m instanceof Ee?d.push(m):m instanceof Array&&0<m.length&&m[0]instanceof Ee&&(d=d.concat(m))}}c=d}}if(Object.defineProperty(this,"targets",{value:i}),e!=ge()){for(var _=e,w=i.length-1;0<=w;w--){var P=(v=i[w]).target.meta;P._events.conditionsChangedEvent.publish(P,{conditionTarget:v,add:!0});for(var O=v.target.meta.type;null!=O;O=O.baseType)O._events.conditionsChangedEvent.publish(O,{conditionTarget:v,add:!0})}if(_.conditions.push(this),_._events.conditionsChangedEvent.publish(this.type,{condition:this,add:!0}),this.type.sets)for(var x=this.type.sets.length-1;0<=x;x--){var E=this.type.sets[x];E.conditions.push(this),E._events.conditionsChangedEvent.publish(E,{condition:this,add:!0})}}}return e.prototype.destroy=function(){if(this.type.sets)for(var e=this.type.sets.length-1;0<=e;e--){var t=this.type.sets[e],r=t.conditions.indexOf(this);0<=r&&t.conditions.splice(r,1)}var u=this.type.conditions.indexOf(this);0<=u&&this.type.conditions.splice(u,1);for(var n=this.targets.length-1;0<=n;n--){var i=this.targets[n],o=i.target.meta;o.clearCondition(i.condition.type),o._events.conditionsChangedEvent.publish(i.target.meta,{conditionTarget:i,remove:!0});for(var a=i.target.meta.type;null!=a;a=a.baseType)a._events.conditionsChangedEvent.publish(a,{conditionTarget:i,add:!1,remove:!0})}this.targets.splice(0)},e.prototype.toString=function(){return this.message},e}(),le={},pe=function(){function e(e,t,r,u,n){if(le[e])throw new Error('A condition type with the code "'+e+'" has already been created.');this.code=e,this.category=t,this.message=r,this.conditions=R.create(),this.sets=u||[],this.origin=n,Object.defineProperty(this,"_events",{value:new de}),le[e]=this}return Object.defineProperty(e.prototype,"conditionsChanged",{get:function(){return this._events.conditionsChangedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.when=function(e,t,r,u){var n=t.meta.getCondition(this);return e?(u=u instanceof Function?u(t):u,n?u&&u!=n.condition.message?(n.condition.destroy(),new fe(this,u,t,r,"client")):n.condition:new fe(this,u,t,r,"client")):(null!=n&&n.condition.destroy(),null)},e.all=function(){var e=[];for(var t in le.keys)e.push(le[t]);return e},e.get=function(e){return le[e]},e}(),de=function(){this.conditionsChangedEvent=new m},he=function(n){function e(e,t,r,u){return void 0===u&&(u=null),n.call(this,e,"Error",t,r,u)||this}return w(e,n),e}(pe),be=function(n){function e(e,t,r,u){return void 0===u&&(u=null),n.call(this,e,"Warning",t,r,u)||this}return w(e,n),e}(pe),ye=function(o){function e(e,t,r,u,n){void 0===n&&(n=null);var i=o.call(this,e,"Warning",t,r,n)||this;return i.isAllowed=u,i}return w(e,o),e}(pe);(se=pe||(pe={})).Error=he,se.Warning=be,se.Permission=ye;var ve=function(){function e(e,t){Object.defineProperty(this,"message",{value:e}),Object.defineProperty(this,"invalidValue",{value:t})}return e.prototype.createCondition=function(e,t){return new fe(ge(),this.message.replace("{property}",t.label),e,[t.name],"client")},e.prototype.toString=function(){return this.invalidValue},e}();function ge(){return ve._conditionType||(ve._conditionType=new he("FormatError","The value is not properly formatted.",[])),ve._conditionType}var me=/\[([_a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][_.0-9a-zA-Z\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u02bb-\u02c1\u02d0-\u02d1\u02e0-\u02e4\u02ee\u0370-\u0373\u0376-\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0523\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0621-\u064a\u0660-\u0669\u066e-\u066f\u0671-\u06d3\u06d5\u06e5-\u06e6\u06ee-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07c0-\u07ea\u07f4-\u07f5\u07fa\u0904-\u0939\u093d\u0950\u0958-\u0961\u0966-\u096f\u0971-\u0972\u097b-\u097f\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc-\u09dd\u09df-\u09e1\u09e6-\u09f1\u0a05-\u0a0a\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a66-\u0a6f\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0-\u0ae1\u0ae6-\u0aef\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32-\u0b33\u0b35-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b66-\u0b6f\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0be6-\u0bef\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58-\u0c59\u0c60-\u0c61\u0c66-\u0c6f\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0-\u0ce1\u0ce6-\u0cef\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d3d\u0d60-\u0d61\u0d66-\u0d6f\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32-\u0e33\u0e40-\u0e46\u0e50-\u0e59\u0e81-\u0e82\u0e84\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa-\u0eab\u0ead-\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0ed0-\u0ed9\u0edc-\u0edd\u0f00\u0f20-\u0f29\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8b\u1000-\u102a\u103f-\u1049\u1050-\u1055\u105a-\u105d\u1061\u1065-\u1066\u106e-\u1070\u1075-\u1081\u108e\u1090-\u1099\u10a0-\u10c5\u10d0-\u10fa\u10fc\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u17e0-\u17e9\u1810-\u1819\u1820-\u1877\u1880-\u18a8\u18aa\u1900-\u191c\u1946-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u19d0-\u19d9\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u1b50-\u1b59\u1b83-\u1ba0\u1bae-\u1bb9\u1c00-\u1c23\u1c40-\u1c49\u1c4d-\u1c7d\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u2094\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183-\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2c6f\u2c71-\u2c7d\u2c80-\u2ce4\u2d00-\u2d25\u2d30-\u2d65\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3006\u3031-\u3035\u303b-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fc3\ua000-\ua48c\ua500-\ua60c\ua610-\ua62b\ua640-\ua65f\ua662-\ua66e\ua680-\ua697\ua722-\ua788\ua78b-\ua78c\ua7fb-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8d0-\ua8d9\ua900-\ua925\ua930-\ua946\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa50-\uaa59\uac00-\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]*)(\:(.+?))?\]/gi,_e=/^(.*\.|)meta(\..*|)$/,we=function(){function e(e,t,r,u){if(void 0===t&&(t=null),void 0===r&&(r=null),void 0===u&&(u=void 0),1===arguments.length&&"object"==typeof e)throw new Error("Do not construct formats directly, call `Format.fromTemplate()` or `Format.create()` instead.");if(!e||"string"!=typeof e)throw new Error("Format specifier string must be provided.");Object.defineProperty(this,"specifier",{configurable:!1,enumerable:!0,value:e,writable:!1}),this.description=t,this.nullString=r||"",this.undefinedString=u||""}return e.prototype.convert=function(e){return void 0===e?this.undefinedString:null===e?this.nullString:e instanceof ve?e.invalidValue:this.convertToString(e)},e.prototype.convertBack=function(e){return null===e||e==this.nullString?null:void 0!==e&&e!=this.undefinedString?"string"==typeof e&&0===(e=e.trim()).length?null:this.convertFromString(e):void 0},e.prototype.toString=function(){return this.specifier},e.create=function(e){return new Pe(e)},e.fromTemplate=function(e,t,r){return void 0===r&&(r=null),new Oe(e,t,r)},e}(),Pe=function(r){function e(e){var t=r.call(this,e.specifier,e.description,e.nullString,e.undefinedString)||this;return Object.defineProperty(t,"_convert",{enumerable:!1,value:e.convert,writable:!0}),Object.defineProperty(t,"_convertBack",{enumerable:!1,value:e.convertBack,writable:!0}),Object.defineProperty(t,"_formatEval",{enumerable:!1,value:e.formatEval,writable:!0}),Object.defineProperty(t,"_paths",{enumerable:!1,value:e.paths,writable:!0}),t}return w(e,r),e.prototype.convertToString=function(e){return this._convert?this._convert(e):e},e.prototype.convertFromString=function(t){if(!this._convertBack)return t;try{return this._convertBack(t)}catch(e){return e instanceof ve?e:new ve(this.description?P.get("format-with-description").replace("{description}",this.description):P.get("format-without-description"),t)}},e.prototype.getPaths=function(){return this._paths},e}(we),Oe=function(n){function e(e,t,r){void 0===r&&(r=null);var u=n.call(this,t)||this;return Object.defineProperty(u,"type",{configurable:!1,enumerable:!0,value:e,writable:!1}),Object.defineProperty(u,"_compiled",{configurable:!1,enumerable:!1,value:!1,writable:!0}),Object.defineProperty(u,"_tokens",{configurable:!1,enumerable:!1,value:null,writable:!0}),Object.defineProperty(u,"_template",{configurable:!1,enumerable:!1,value:null,writable:!0}),Object.defineProperty(u,"_paths",{configurable:!1,enumerable:!1,value:null,writable:!0}),u}return w(e,n),e.prototype._ensureCompiled=function(){if(!this._compiled){if(!this._tokens){this._paths=[],this._tokens=[],this._template=this.specifier;var e=this._template.replace(/\\\\/g,"\0").replace(/\\\[/g,"").replace(/\\\]/g,""),t=0;me.lastIndex=0;for(var r=me.exec(e);r;){var u=r[1],n=u,i=null;try{var o=0<(n=n.replace(_e,"$1")).length&&n.length<u.length,a=!o;if(o&&(n=n.substring(0,n.length-1)),n){var s=tt(n,this.type,this.type.model._allTypesRoot);if(s)if(a){if(s instanceof J)i=s.format;else if(s instanceof S){i=s.lastProperty.format}var c=me.lastIndex;i&&i instanceof we&&i!==this&&0<i.getPaths().length?Array.prototype.push.apply(this._paths,i.getPaths().map(function(e){return n+"."+e})):this._paths.push(n),me.lastIndex=c}else this._paths.push(n)}}catch(e){}this._tokens.push({prefix:e.substring(t,me.lastIndex-r[0].length).replace(/\u0000/g,"\\").replace(/\u0001/g,"[").replace(/\u0002/g,"]"),path:u,format:r[3]?r[3].replace(/\u0000/g,"\\").replace(/\u0001/g,"[").replace(/\u0002/g,"]"):i}),t=me.lastIndex,r=me.exec(e)}t<e.length&&this._tokens.push({prefix:e.substring(t).replace(/\u0000/g,"\\").replace(/\u0001/g,"[").replace(/\u0002/g,"]")})}this._compiled=!0}},e.prototype.getPaths=function(){return this._ensureCompiled(),this._paths},e.prototype.convertToString=function(e){if(null==e)return"";this._ensureCompiled();for(var t="",r=0;r<this._tokens.length;r++){var u=this._tokens[r];if(u.prefix&&(t+=u.prefix),u.path){var n=s(e,u.path);if(null==n)n="";else if(u.format){var i=void 0;u.format instanceof we?i=u.format:"string"==typeof u.format&&(i=u.format=xe(e.meta.type.model,n.constructor,u.format)),n=i.convert(n)}t+=n}}return t},e.prototype.convertFromString=function(e){throw new Error("Cannot convert from a format string back to an entity.")},e}(we);function xe(e,t,r){if(!r||""===r)return null;var u,n=function(e,t){if(t.meta&&t.meta instanceof Ue)return t.meta._formats;var r=null;if(t===String?r="String":t===Number?r="Number":t===Boolean?r="Boolean":t===Date&&(r="Date"),r){var u=e._nativeTypeFormats[r];return u||(u=e._nativeTypeFormats[r]={}),u}var n=void 0;if(b(e,"_unknownTypeFormats")){n=e._unknownTypeFormats;for(var i=0;i<n.length;i++)if(n[i].type===t)return n[i].formats}else n=[],Object.defineProperty(e,"_unknownTypeFormats",{configurable:!1,enumerable:!1,value:n,writable:!1});var o={};return n.push({type:t,formats:o}),o}(e,t),i=n[r];return i||((u=t).meta&&u.meta instanceof Ue?n[r]=i=we.fromTemplate(t.meta,r):n[r]=i=function(e,t){if(e===Date)return we.create({specifier:t,description:"",paths:[],convert:function(e){if("d"!==t)throw new Error("Date format '"+t+"' is not supported.");return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()},convertBack:function(e){return new ve("Convert back from string to date is not implemented.",e)}});if(e===Number){var r=t.match(/[$c]+/i),u=t.match(/[%p]+/i),n=t.match(/[dnfg]0/i);return new Pe({specifier:t,description:r?P["format-currency"]:u?P["format-percentage"]:n?P["format-integer"]:P["format-decimal"],convert:function(e){if("g"===t.toLowerCase())return e.toString();throw new Error("Number format '"+t+"' is not implemented.")},convertBack:function(e){return new ve("Convert back from string to date is not implemented.",e)}})}if(e===Boolean){var i,o,a;if(t&&"g"===t.toLowerCase())i="True",o="False",a="";else{var s=t.split(";");i=0<s.length?s[0]:"",o=1<s.length?s[1]:"",a=2<s.length?s[2]:""}return new Pe({specifier:t,convert:function(e){return!0===e?i:!1===e?o:a},convertBack:function(e){return e.toLowerCase()===i.toLowerCase()||e.toLowerCase()!==o.toLowerCase()&&null}})}}(t,r),i)}var Ee=function(){function e(){Object.defineProperty(this,"_events",{value:new je})}return Object.defineProperty(e.prototype,"accessed",{get:function(){return this._events.accessedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changed",{get:function(){return this._events.changedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){var r;for(var u in"string"==typeof e?(r={})[e]=t:r=e,r)if(r.hasOwnProperty(u)){var n=this.meta.type.getProperty(u);if(!n)throw new Error('Could not find property "'+u+'" on type "'+this.meta.type.fullName+'".');n.value(this,t)}},e.prototype.set=function(e,t){var r;for(var u in"string"==typeof e?(r={})[e]=t:r=e,r)if(r.hasOwnProperty(u)){var n=this.meta.type.getProperty(u);if(!n)throw new Error('Could not find property "'+u+'" on type "'+this.meta.type.fullName+'".');n.value(this,t)}},e.prototype.get=function(e){return this.meta.type.getProperty(e).value(this)},e.prototype.toString=function(e){var t,r=null;return(r=e?xe(this.meta.type.model,this.constructor,e):this.meta.type.format)?r.convert(this):(t=this).meta.type.fullName+"|"+t.meta.id},e}(),je=function(){this.accessedEvent=new m,this.changedEvent=new m};var Te,Se,Ce=function(){function e(e,t,r,u){Object.defineProperty(this,"type",{enumerable:!0,value:e}),Object.defineProperty(this,"entity",{enumerable:!0,value:t}),Object.defineProperty(this,"_id",{enumerable:!1,value:r,writable:!0}),Object.defineProperty(this,"_isNew",{enumerable:!1,value:u,writable:!0}),Object.defineProperty(this,"_conditions",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"_events",{value:new Ve})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legacyId",{get:function(){return this._legacyId},set:function(e){this._legacyId=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conditionsChanged",{get:function(){return this._events.conditionsChangedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.getCondition=function(e){return this._conditions[e.code]},e.prototype.setCondition=function(e){e.condition.type!=ge()&&(this._conditions[e.condition.type.code]=e)},e.prototype.clearCondition=function(e){delete this._conditions[e.code]},e.prototype.isAllowed=function(){if(0!==arguments.length){for(var e=arguments.length-1;0<=e;e--){var t=arguments[e],r=pe.get(t);if(void 0===r)return;if(!(r instanceof ye))throw new Error('Condition type "'+t+'" should be a Permission.');if(this._conditions[r.code]?!r.isAllowed:r.isAllowed)return!1}return!0}},e.prototype.destroy=function(){this.type.unregister(this.entity);for(var e=this.type;e;e=e.baseType)e._events.destroyEvent.publish(e,{entity:this.entity})},e}(),Ve=function(){this.conditionsChangedEvent=new m};(Se=Te||(Te={}))[Se.InitExisting=2]="InitExisting",Se[Se.InitNew=4]="InitNew",Se[Se.PropertyGet=8]="PropertyGet",Se[Se.PropertyChanged=16]="PropertyChanged";var Ae=null,Ie=function(){function e(){var e=Ae;Object.defineProperty(this,"parent",{enumerable:!0,value:e}),Object.defineProperty(this,"_isActive",{enumerable:!1,value:!0,writable:!0}),Object.defineProperty(this,"_events",{value:new Ne}),Ae=this}return Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exitEvent",{get:function(){return this._events.exitEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"abortEvent",{get:function(){return this._events.abortEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){if(void 0===e&&(e=!1),!this.isActive)throw new Error("The event scope cannot be aborted because it is not active.");try{this._events.abortEvent.publish(this,{maxNestingExceeded:e}),this._events.abortEvent.clear(),this._events.exitEvent.clear()}finally{if(this._isActive=!1,Ae&&Ae===this)for(;Ae&&!Ae.isActive;)Ae=Ae.parent}},e.prototype.exit=function(){var t=this;if(!this.isActive)throw new Error("The event scope cannot be exited because it is not active.");try{var e=y(this._events.exitEvent);if(e&&0<e.length){if(null!==this.parent&&this.parent.isActive){if(this.parent.hasOwnProperty("_exitEventVersion")&&99<=this.parent._exitEventVersion)return void this.abort(!0);e.forEach(function(e){e.isOnce&&e.isExecuted||t.parent._events.exitEvent.subscribe(e.handler)}),this.parent.hasOwnProperty("_exitEventVersion")&&this.parent._exitEventVersion++}else this._exitEventVersion=0,this._exitEventHandlerCount=e.length,this._events.exitEvent.publish(this,{}),delete this._exitEventHandlerCount,delete this._exitEventVersion;this._events.abortEvent.clear(),this._events.exitEvent.clear()}}finally{if(this._isActive=!1,Ae&&Ae===this)for(;Ae&&!Ae.isActive;)Ae=Ae.parent}},e}(),Ne=function(){this.exitEvent=new m,this.abortEvent=new m};function Fe(e,t){if(void 0===t&&(t=null),null===Ae)t?e.call(t):e();else{if(!Ae.isActive)throw new Error("The current event scope cannot be inactive.");Ae._events.exitEvent.subscribe(e.bind(t))}}function Re(e,t){if(void 0===t&&(t=null),null!==Ae){if(!Ae.isActive)throw new Error("The current event scope cannot be inactive.");Ae._events.abortEvent.subscribe(e.bind(t))}}function qe(e,t){void 0===t&&(t=null);var r=new Ie;try{t?e.call(t):e()}finally{r.exit()}}var $e=100,ke=0,De=function(){function e(e,t,r,u){if(void 0===u&&(u=!1),this.invocationTypes=0,this.predicates=[],this.returnValues=[],this.rootType=e,this.name=t||(r?r.name:null)||e.fullName+".Custom."+ ++ke,r){var n=function(n){if(!n)return;var i={};return Object.keys(n).filter(function(e){var t=n[e];if("onInit"===e){if("boolean"==typeof t)return i.onInit=t,!0}else if("onInitNew"===e){if("boolean"==typeof t)return i.onInitNew=t,!0}else if("onInitExisting"===e){if("boolean"==typeof t)return i.onInitExisting=t,!0}else if("onChangeOf"===e){if(Array.isArray(t)){var r=null;return i.onChangeOf=t.filter(function(e){return"string"==typeof e||e instanceof S||e instanceof J||(r||(r=[]),r.push(e),!1)}),!r||(n.onChangeOf=r,!1)}if("string"==typeof t)return i.onChangeOf=[t],!0;if(t instanceof S)return i.onChangeOf=[t],!0;if(t instanceof J)return i.onChangeOf=[t],!0}else if("returns"===e){if(Array.isArray(t)){var u=null;return i.returns=t.filter(function(e){return"string"==typeof e||e instanceof S||e instanceof J||(u||(u=[]),!1)}),!u||(n.returns=u,!1)}if("string"==typeof t)return i.returns=[t],!0;if(t instanceof J)return i.returns=[t],!0}else{if("execute"!==e)return;if(t instanceof Function)return i.execute=t,!0}}).forEach(function(e){delete n[e]}),i}(r);n.onInit&&this.onInit(),n.onInitNew&&this.onInitNew(),n.onInitExisting&&this.onInitExisting(),n.onChangeOf&&this.onChangeOf(n.onChangeOf),n.returns&&this.returns(n.returns),n.execute instanceof Function&&(this._execute=n.execute)}u||e.model.registerRule(this)}return e.prototype.execute=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this._execute&&this._execute.call(e)},e.prototype.onInitNew=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=Te.InitNew,this},e.prototype.onInitExisting=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=Te.InitExisting,this},e.prototype.onInit=function(){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return this.invocationTypes|=Te.InitNew|Te.InitExisting,this},e.prototype.onChangeOf=function(e){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);return e&&e.constructor===String&&(e=Array.prototype.slice.call(arguments)),this.predicates=0<this.predicates.length?this.predicates.concat(e):e,0==(this.invocationTypes&Te.PropertyGet)&&(this.invocationTypes|=Te.PropertyChanged),this},e.prototype.returns=function(e){if(this._registered)throw new Error("Rules cannot be configured once they have been registered: "+this.name);if(e&&e.constructor===String&&(e=Array.prototype.slice.call(arguments)),!e)throw new Error("Rule must specify at least one property for returns.");return this.returnValues=0<this.returnValues.length?this.returnValues.concat(e):e,this.invocationTypes|=Te.PropertyGet,this.invocationTypes&=~Te.PropertyChanged,this},e.prototype.register=function(){if(this._registered)throw new Error("Rules cannot be registered more than once: "+this.name);Object.defineProperty(this,"_registered",{enumerable:!1,value:!0,writable:!1}),function(u,e){u.returnValues&&u.returnValues.forEach(function(e,t){e instanceof J||(u.returnValues[t]=u.rootType.getProperty(e))});if(u.predicates){for(var n,i=null,t=function(e){var t=u.predicates[e];if("string"==typeof t){i||(i=new E("prepare rule predicates"));var r=e;ae([t]).forEach(function(e){tt(e,u.rootType,u.rootType.model._allTypesRoot,!1,i.pending(function(e){u.predicates[r]=e},this,!0),this)},o)}else t instanceof J||t instanceof S||u.predicates.splice(e--,1);n=e},o=this,r=0;r<u.predicates.length;r++)t(r),r=n;i?i.waitForAll(e,this,!0,[u]):e(u)}}(this,Be)},e}();function Le(e,t,r){var u;void 0===r&&(r=null),Object.prototype.hasOwnProperty.call(e,"_pendingInvocation")?u=e._pendingInvocation:Object.defineProperty(e,"_pendingInvocation",{enumerable:!1,value:u=[],writable:!0});var n=u.indexOf(t);if(!(2<arguments.length))return 0<=n;r&&n<0?u.push(t):!r&&0<=n&&u.splice(n,1)}function He(e,t,r){return t instanceof e.rootType.jstype}function Me(r,u,e){He(r,u)&&qe(function(){if(Ae.parent){var e,t=Ae.parent;if(t._exitEventVersion)if(e=$e-1,t._exitEventVersion>e)return}r.execute(u)})}function Be(r){r.invocationTypes&Te.InitNew&&r.rootType._events.initNewEvent.subscribe(function(e){Me(r,e.entity)}),r.invocationTypes&Te.InitExisting&&r.rootType._events.initExistingEvent.subscribe(function(e){Me(r,e.entity)}),r.invocationTypes&Te.PropertyChanged&&r.predicates.forEach(function(e){ie(e,function(e){He(r,e.entity)&&!Le(e.entity.meta,r)&&(Le(e.entity.meta,r,!0),Fe(function(){Le(e.entity.meta,r,!1),Me(r,e.entity)}),Re(function(){Le(e.entity.meta,r,!1)}))},null,!0)}),r.invocationTypes&Te.PropertyGet&&r.returnValues&&(r.returnValues.forEach(function(t){!function(e,t,r,u){if(void 0===r&&(r=null),void 0===u&&(u=!1),e instanceof J)!function(e,t,r){void 0===r&&(r=null);var u=null,n=null;r&&(n=function(e){e.entity===r&&t.call(this,e)},u=r),e._events.accessedEvent.subscribe(n||t),e._propertyAccessSubscriptions.push({registeredHandler:n||t,handler:t,context:u})}(e,t,r);else{if(!(e instanceof S))throw new Error("Invalid property passed to `Property$addAccessed(prop)`.");I(e,t,r)}}(t,function(e){He(r,e.entity)&&te(e.entity,t)&&(te(e.entity,t,!1),Me(r,e.entity))})}),r.predicates.forEach(function(e){ie(e,function(n){r.returnValues.some(function(e){return t=e,r=n.entity,0<(u=t._propertyChangeSubscriptions).length&&u.some(function(e){return e.context===r});var t,r,u})?He(r,n.entity)&&!Le(n.entity.meta,r)&&(Le(n.entity.meta,r,!0),Fe(function(){Le(n.entity.meta,r,!1),Me(r,n.entity)}),Re(function(){Le(n.entity.meta,r,!1)})):(r.returnValues.forEach(function(e){te(n.entity,e,!0)}),Fe(function(){r.returnValues.forEach(function(e){n.entity._events.changedEvent.publish(n.entity,{entity:n.entity,property:e})})}))},null,!0)})),r.onRegister instanceof Function&&r.onRegister()}function Qe(e){var t,r,u;(t=e.property,(u=t)._rules?r=u._rules:(r=[],Object.defineProperty(u,"_rules",{enumerable:!1,value:r,writable:!1})),r).push(e);var n=y(e.property._events.ruleRegisteredEvent);n&&0<n.length&&e.property._events.ruleRegisteredEvent.publish(e.property,{rule:e})}var Ue=function(){function e(e,t,r,u){void 0===r&&(r=null),void 0===u&&(u="client"),Object.defineProperty(this,"model",{enumerable:!0,value:e}),Object.defineProperty(this,"fullName",{enumerable:!0,value:t}),Object.defineProperty(this,"jstype",{enumerable:!0,value:function(i,e,t,r){void 0===t&&(t=null);void 0===r&&(r=null);var u=e.split("."),n=u.shift(),o=i.model._allTypesRoot,a=r;for(;0<u.length;)o=l(n,o),r&&(a=l(n,a)),n=u.shift();var s=n;var c,f=new Function("construct","return function "+s+" () { construct.apply(this, arguments); }")(function(){if(!ze)if(0<arguments.length&&null!=arguments[0]&&arguments[0].constructor===String){var e=arguments[0],t=arguments[1],r=arguments[2],u=i.get(e,!0);if(u)return t&&u.init(t),u;i.register(this,e,r),t&&this.init(t);for(var n=i;n;n=n.baseType)n._events.initExistingEvent.publish(n,{entity:this})}else{var t=arguments[0],r=arguments[2];i.register(this,null,r),t&&this.set(t);for(var n=i;n;n=n.baseType)n._events.initNewEvent.publish(n,{entity:this})}});o[s]?o["$"+s]=f:o[s]=f;r&&(a[s]?a["$"+s]=f:a[s]=f);c=t?t.jstype:Ee;return ze=!0,f.prototype=new c,ze=!1,f.prototype.constructor=f,Object.defineProperty(f,"meta",{enumerable:!1,value:i,configurable:!1,writable:!1}),f}(this,t,r,e.settings.useGlobalObject?n():null)}),Object.defineProperty(this,"baseType",{enumerable:!0,value:r}),this.origin=u,this.originForNewProperties=this.origin,Object.defineProperty(this,"_lastId",{enumerable:!1,value:0,writable:!0}),Object.defineProperty(this,"_pool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_legacyPool",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_properties",{enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_formats",{configurable:!1,enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_derivedTypes",{enumerable:!1,value:[],writable:!1}),Object.defineProperty(this,"_events",{value:new We})}return Object.defineProperty(e.prototype,"destroy",{get:function(){return this._events.destroyEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initNew",{get:function(){return this._events.initNewEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initExisting",{get:function(){return this._events.initExistingEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conditionsChanged",{get:function(){return this._events.conditionsChangedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format?this._format:this.baseType?this.baseType.format:void 0},set:function(e){e&&"string"==typeof e&&(e=xe(this.model,this.jstype,e)),Object.defineProperty(this,"_format",{configurable:!0,enumerable:!1,value:e,writable:!0})},enumerable:!0,configurable:!0}),e.prototype.newId=function(){for(var e,t=this;t;t=t.baseType)e=Math.max(e||0,t._lastId);var r=e+1;for(t=this;t;t=t.baseType)t._lastId=r;return"+c"+r},e.prototype.register=function(e,t,r){var u;void 0===r&&(r=!1),2===arguments.length&&Ze.call(this,t),t||(t=this.newId(),u=!0),Object.defineProperty(e,"meta",{value:new Ce(this,e,t,u),configurable:!1,enumerable:!1,writable:!1});for(var n=t.toLowerCase(),i=this;i;i=i.baseType){if(i._pool.hasOwnProperty(n))throw new Error('Object "'+this.fullName+"|"+t+'" has already been registered.');i._pool[n]=e,i._known&&i._known.push(e)}if(!0===this.model.settings.createOwnProperties)for(var o in this._properties)if(Object.prototype.hasOwnProperty.call(this._properties,o)){var a=this._properties[o];a.isStatic||ee(a,e)}r||this.model._events.entityRegisteredEvent.publish(this.model,{entity:e})},e.prototype.changeObjectId=function(e,t){Ze.call(this,e),Ze.call(this,t);var r=e.toLowerCase(),u=t.toLowerCase(),n=this._pool[r];if(n){n.meta.legacyId=e;for(var i=this;i;i=i.baseType)i._pool[u]=n,delete i._pool[r],i._legacyPool[r]=n;return n.meta.id=t,n}},e.prototype.unregister=function(e){for(var t=this;t;t=t.baseType)if(delete t._pool[e.meta.id.toLowerCase()],e.meta.legacyId&&delete t._legacyPool[e.meta.legacyId.toLowerCase()],t._known){var r=t._known.indexOf(e);0<=r&&t._known.splice(r,1)}this.model._events.entityUnregisteredEvent.publish(this.model,{entity:e})},e.prototype.get=function(e,t){if(void 0===t&&(t=!1),!e)throw new Error('Method "'+this.fullName+'.meta.get()" was called without a valid id argument.');var r=e.toLowerCase(),u=this._pool[r]||this._legacyPool[r];if(u&&!0===t&&u.meta.type!==this)throw new Error("The entity with id='"+e+"' is expected to be of type '"+this.fullName+"' but found type '"+u.meta.type.fullName+"'.");return u},e.prototype.known=function(){var e=this._known;if(!e){var t=[];for(var r in this._pool)Object.prototype.hasOwnProperty.call(this._pool,r)&&t.push(this._pool[r]);e=this._known=R.ensureObservable(t)}return e},e.prototype.addProperty=function(e,t,r,u,n){var i=null;n.format&&("string"==typeof n.format?i=xe(this.model,t,n.format):i.constructor===we&&(i=n.format));var o,a,s,c,f=new J(this,e,t,n.label,n.helptext,i,r,u,n.isPersisted,n.isCalculated,n.defaultValue);if(function(e,t,r){void 0===r&&(r=null);var u="$"+e.name;Object.prototype.hasOwnProperty.call(t,u)&&!r||(t[u]=e)}(this._properties[e]=f,f.containingType.jstype),f.isStatic)s=f,c=this.jstype,Object.defineProperty(c,s.name,{configurable:!1,enumerable:!0,get:s.getter,set:s.setter});else if(!0===this.model.settings.createOwnProperties)for(var l in this._pool)Object.prototype.hasOwnProperty.call(this._pool,l)&&ee(f,this._pool[l]);else o=f,a=this.jstype.prototype,Object.defineProperty(a,o.name,{configurable:!1,enumerable:!0,get:o.getter,set:o.setter});return this.model._events.propertyAddedEvent.publish(this.model,{property:f}),f},e.prototype.getProperty=function(e){for(var t,r=this;r&&!t;r=r.baseType)if(t=r._properties[e])return t;return null},Object.defineProperty(e.prototype,"properties",{get:function(){for(var e=[],t=this;null!=t;t=t.baseType)for(var r in t._properties)t._properties.hasOwnProperty(r)&&e.push(t._properties[r]);return e},enumerable:!0,configurable:!0}),e.prototype.addRule=function(e){var t;return e&&(t=e instanceof Function?{execute:e}:e),new De(this,t.name,t)},Object.defineProperty(e.prototype,"derivedTypes",{get:function(){return this._derivedTypes},enumerable:!0,configurable:!0}),e.prototype.hasModelProperty=function(e){return e.containingType===this||this.isSubclassOf(e.containingType)},e.prototype.isSubclassOf=function(t){var r=!1;return function(e,t,r,u){void 0===u&&(u=null);for(var n=e[t];null!=n;n=n[t])if(!1===r.call(u||e,n))return}(this,"baseType",function(e){if(e===t)return!(r=!0)}),r},e.prototype.toString=function(){return this.fullName},e.prototype.extend=function(e){},e}(),We=function(){this.initNewEvent=new m,this.initExistingEvent=new m,this.destroyEvent=new m,this.conditionsChangedEvent=new m};function Ze(e){if(null==e)throw new Error("Id cannot be "+(null===e?"null":"undefined")+" (entity = "+this.fullName+").");if("string"!==p(e))throw new Error("Id must be a string:  encountered id "+e+' of type "'+c(e.constructor)+'" (entity = '+this.fullName+").");if(""===e)throw new Error("Id cannot be a blank string (entity = "+this.fullName+").")}var ze=!1;var Ge=["Object","String","Number","Boolean","Date","Array"],Ye=function(){function e(e,t){void 0===e&&(e=void 0),void 0===t&&(t=void 0),Object.defineProperty(this,"settings",{configurable:!1,enumerable:!0,value:new Ke(e,t),writable:!1}),Object.defineProperty(this,"_types",{value:{}}),Object.defineProperty(this,"_allTypesRoot",{value:{}}),Object.defineProperty(this,"_nativeTypeFormats",{configurable:!1,enumerable:!1,value:{},writable:!1}),Object.defineProperty(this,"_fieldNamePrefix",{value:"_fN"+function(e,t,r){if(void 0===t&&(t=!0),void 0===r&&(r=!0),t||r){for(var u="",n=0;n<e;n++){var i,o=h(t?0:26,r?35:25);i=o<=25?o+97:o-26+48,u+=String.fromCharCode(i)}return u}}(3,!1,!0)}),Object.defineProperty(this,"_events",{value:new Je})}return Object.defineProperty(e.prototype,"entityRegistered",{get:function(){return this._events.entityRegisteredEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entityUnregistered",{get:function(){return this._events.entityUnregisteredEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"propertyAdded",{get:function(){return this._events.propertyAddedEvent.asEventSubscriber()},enumerable:!0,configurable:!0}),e.prototype.getTypes=function(){var e=[];for(var t in this._types)this._types.hasOwnProperty(t)&&e.push(this._types[t]);return e},e.prototype.addType=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r="client");var u=new Ue(this,e,t||null,r);return this._types[e]=u},e.prototype.registerRule=function(e){this._ruleQueue?e.register():this._ruleQueue.push(e)},e.prototype.registerRules=function(){var e,t=this._ruleQueue;for(delete this._ruleQueue,e=0;e<t.length;e+=1)t[e].register()},e.prototype.extend=function(e){for(var t in e){var r=e[t];if(!(i=this._types[t])){var u=this._types[r.$extends];i=this.addType(t,u)}var n=r.$format;n&&(i.format=xe(this,i.jstype,n)),delete r.$extends,delete r.$format}for(var t in e){r=e[t];var i=this._types[t];for(var o in r){var a=r[o];if("string"==typeof a?a={type:a}:"function"==typeof a&&(a=a===String||a===Number||a===Date||a===Boolean?{type:a}:{function:a}),a.hasOwnProperty("function"));else if(!i.getProperty(o)){a.get;a.label||(a.label=o.replace(/(^[a-z]+|[A-Z]{2,}(?=[A-Z][a-z]|$)|[A-Z][a-z]*)/g," $1").trimLeft());var s=!1;"string"==typeof a.type&&(a.type.lastIndexOf("[]")===a.type.length-2&&(s=!0,a.type=a.type.substr(0,a.type.length-2)),a.type=et(a.type,this._allTypesRoot,!1)),"string"==typeof a.format&&(a.format=xe(this,a.type,a.format)),i.addProperty(o,a.type,s,a.static,{})}}}},e}(),Je=function(){this.entityRegisteredEvent=new m,this.entityUnregisteredEvent=new m,this.propertyAddedEvent=new m},Ke=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.createOwnProperties=!1,this.useGlobalObject=!1,Object.defineProperty(this,"createOwnProperties",{configurable:!1,enumerable:!0,value:e,writable:!1}),Object.defineProperty(this,"useGlobalObject",{configurable:!1,enumerable:!0,value:t,writable:!1})};function Xe(e,t,r){return r()}function et(e,t,r){void 0===r&&(r=!1);var u=e.split(".");if(1===u.length&&-1<Ge.indexOf(e))return t[e];for(var n=void 0,i=t,o=0;void 0!==i&&o<u.length-1;o++){var a=u[o];i=i[a]}if(void 0!==i&&(n=i[u[u.length-1]]),void 0!==n)return n;if(!r)throw new Error('The type "'+e+'" could not be found.  Failed on step "'+a+'".')}function tt(e,t,r,u,n,i){void 0===u&&(u=!1),void 0===n&&(n=null),void 0===i&&(i=null);var o,a,s,c=null,f=null;if(e.constructor===oe)c=(f=e).expression;else{if("string"!=typeof e)throw new Error("Invalid valud for argument `pathOrTokens`.");c=e}if(t&&t._chains&&t._chains[c])return n?(n.call(i||this,t._chains[c]),null):t._chains[c];if(f||(f=new oe(c)),o=t instanceof Function?t.meta:t,"this"===f.steps[0].property&&f.steps[0].cast&&(o=et(f.steps[0].cast,r,!1).meta,f.steps.shift()),a=function(e,t,r){Xe(0,0,function(){r.call(i||this,e.getProperty(t))})},1===f.steps.length){if(s=f.steps[0].property,!n)return o.getProperty(s);a(o,s,n)}else{var l=f.steps.slice(0,f.steps.length-1).map(function(e){return e.property}).join("."),p=f.steps[f.steps.length-1].property,d=(Array.prototype.slice.call(arguments),function(e){var t=et(l,r,!0);if(!o)throw new Error(e||'Error getting type "'+l+'".');if(o=t.meta,!n)return o.getProperty(p);a(o,p,n)});if(!n)return C.call(null,o,f,u)||d(null);C.call(null,o,f,u,i?n.bind(i):n,d)}}var rt,ut,nt={Vue:null,Observer:null,Dep:null},it=(rt=!1,ut=function(e,t){return(ut=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){rt||(function(e,t){ut(e,t);var r=function(){this.constructor=e};e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(e,t),rt=!0)}),ot=function e(t){return it(e,nt.Observer),nt.Observer.call(this,t)||this};var at=function(e,t){return(at=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function st(e,t){function r(){this.constructor=e}at(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function ct(e,t){return e[t]}var ft=Object.prototype.hasOwnProperty;function lt(e,t){return ft.call(e,t)}var pt=function(r){function e(e){var t=r.call(this,e)||this;return Object.defineProperty(t,"propertyDeps",{configurable:!1,enumerable:!0,value:{},writable:!1}),t}return st(e,r),e.prototype.walk=function(){},e.prototype.getPropertyDep=function(e,t){var r;void 0===t&&(t=!1);var u=nt.Dep,n=this.propertyDeps;return lt(n,e)&&n[e]instanceof u?r=n[e]:t&&(r=new u,Object.defineProperty(n,e,{configurable:!0,enumerable:!0,value:r,writable:!0})),r},e.prototype.onPropertyAccess=function(e,t){if(nt.Dep.target){this.getPropertyDep(e,!0).depend();var r=bt(t);r&&r.dep.depend(),Array.isArray(t)&&function e(t){for(var r,u=0,n=t.length;u<n;u++)if(null!=(r=t[u])){if(r instanceof Ee){var i=ht(r,!0);i.ensureObservable(),i.dep.depend()}else lt(r,"__ob__")&&r.__ob__.dep.depend();Array.isArray(r)&&e(r)}}(t)}},e.prototype.onPropertyChange=function(e,t){var r=this.getPropertyDep(e,!0);t&&t instanceof Ee&&bt(t).ensureObservable(),r.notify()},e}(ot),dt=function(t){function e(e){return t.call(this,e)||this}return st(e,t),e.prototype.walk=function(){},e.prototype.ensureObservable=function(){!0!==this._observable&&(this.value.accessed.subscribe(this._onAccess.bind(this)),this.value.changed.subscribe(this._onChange.bind(this)),this._observable=!0)},e.prototype._onAccess=function(e){var t=e.entity[e.property.fieldName];this.onPropertyAccess(e.property.name,t)},e.prototype._onChange=function(e){var t=e.entity[e.property.fieldName];this.onPropertyChange(e.property.name,t)},e}(pt);function ht(e,t){return void 0===t&&(t=!1),lt(e,"__ob__")&&ct(e,"__ob__")instanceof dt?ct(e,"__ob__"):t?new dt(e):null}function bt(e,t){if(void 0===t&&(t=!1),e instanceof Ee){var r=ht(e,!0);return t&&r&&r.vmCount++,r}}var yt=[];function vt(e,t,r){Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:function(){return this[t][r]},set:function(e){this[t][r]=e}})}function gt(e,t){return null!=t&&t instanceof Ee?(e._entity=t,{}):t}function mt(e){var t=e;t._data=t._entity,function(e,t){for(var r,u,n=t.meta.type.properties,i=e.$options.props,o=e.$options.methods,a=0;a<n.length;a++){var s=n[a];o&&lt(o,s.name)?s.name:i&&lt(i,s.name)?s.name:(r=s.name,36!==(u=(r+"").charCodeAt(0))&&95!==u&&vt(e,"_data",s.name))}}(e,t._entity),bt(t._entity,!0),t._entity=null}function _t(e){e.mixin({beforeCreate:function(){this.$options.data&&function(e){if(e.$options.data)if(e.$options.data instanceof Function){var t=e.$options.data;e.$options.data=function(){return gt(e,t.apply(this,arguments))}}else e.$options.data=gt(e,e.$options.data)}(this)},created:function(){var e;this._entity&&(this._entity.meta.type.model._entitiesAreVueObservable||(e=this._entity.meta.type.model)&&e instanceof Ye&&(0<=yt.indexOf(e)||!0===e._entitiesAreVueObservable||(e.entityRegistered.subscribe(function(e){bt(e.entity)}),e.getTypes().forEach(function(e){e.known().forEach(function(e){bt(e)})}),yt.push(e),e._entitiesAreVueObservable=!0)),ht(this._entity,!0).ensureObservable(),mt(this))}})}var wt=function(){function e(e){Object.defineProperty(this,"entity",{enumerable:!0,value:e}),ht(e).ensureObservable(),Object.defineProperty(this,"__ob__",{configurable:!1,enumerable:!1,value:new pt(this),writable:!1})}return Object.defineProperty(e.prototype,"value",{get:function(){var e=this.entity;return this.__ob__.onPropertyAccess("value",e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e=this.entity.meta.type.fullName+"|"+this.entity.meta.id;return this.__ob__.onPropertyAccess("displayValue",e),e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.entity.meta.type.fullName+"|"+this.entity.meta.id},e}(),Pt=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"_value",{enumerable:!0,value:t}),Object.defineProperty(this,"__ob__",{configurable:!1,enumerable:!1,value:new pt(this),writable:!1})}return Object.defineProperty(e.prototype,"label",{get:function(){return this.source.label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){var e=this._value;return this.__ob__.onPropertyAccess("value",e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e=this._value,t=Tt.call(this.source,e);return this.__ob__.onPropertyAccess("displayValue",t),t},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Option for Source['"+this.source.property.name+"']"},e}(),Ot=function(i){function e(e,t,r){void 0===r&&(r=!1);var u;if(0!=arguments.length){t.name=t.name||"ValidatedProperty";var n="string"==typeof t.property?e.getProperty(t.property):t.property;return t.properties?t.properties.indexOf(n.name)<0&&t.properties.indexOf(n)<0&&t.properties.push(n.name):t.properties=[n.name],t.onChangeOf?t.onChangeOf.indexOf(n.name)<0&&t.onChangeOf.indexOf(n)<0&&t.onChangeOf.push(n):t.onChangeOf=[n],t.conditionType||(t.category="Error"),t.message&&"function"!=typeof t.message&&(t.message=t.message.replace("{property}",n.label)),u=i.call(this,e,t,!0)||this,Object.defineProperty(u,"property",{value:n}),t.isValid instanceof Function&&Object.defineProperty(u,"_isValid",{value:t.isValid}),r||e.model.registerRule(u),u}}return w(e,i),e.prototype.isValid=function(e,t,r){return this._isValid.call(e,t,r)},e.prototype.assert=function(e){var t=this.isValid(e,this.property,this.property.value(e));return void 0===t?t:!t},e.prototype.onRegister=function(){Qe(this)},e}(function(o){function u(e,t,r){void 0===r&&(r=!1);var u=this;if(0!==arguments.length){t.hasOwnProperty("onInitNew")||(t.onInitNew=!0);var n=t.conditionType;"string"==typeof n&&(n=pe.get(n)),!t.hasOwnProperty("onInitExisting")&&n&&"server"!==n.origin&&(t.onInitExisting=!0),u=o.call(this,e,name,t,!0)||this;var i=t.assert||t.fn;return i&&(u._assert=i),n||(n=function(e,t,r){void 0===r&&(r="Error");for(var u,n=t instanceof J?t.containingType.fullName+"."+t.name+"."+e:t instanceof Ue?t+"."+e:e,i="";pe.get(n+i);)i=("string"==typeof i?0:i)+1;if("Error"===r)u=he;else{if("Warning"!==r)throw new Error("Cannot create condition type for unsupported category '"+r+"'.");u=be}return new u(n+i,"Generated condition type for "+e+" rule.",null,"client")}(t.name,e,t.category||"ErrorConditionType")),Object.defineProperty(u,"conditionType",{enumerable:!0,value:n}),t.message&&Object.defineProperty(u,"_message",{value:t.message,writable:!0}),Object.defineProperty(u,"_properties",{value:t.properties||[],writable:!0}),r||e.model.registerRule(u),u}}return w(u,o),u.prototype.getProperties=function(){return b(this,"_properties")?this._properties:[]},u.prototype.getMessage=function(e){if(b(this,"_message")){if("string"==typeof this._message){var t=new Function(this._message);this._message=t}if(this._message instanceof Function)return this._message.call(e)}return this.conditionType.message},u.prototype.assert=function(e){if(b(this,"_assert"))return"string"==typeof this._assert&&(this._assert=new Function(this.assert)),this._assert.call(e);throw new Error("ConditionRule.assert() must be passed into the constructor or overriden by subclasses.")},u.prototype.execute=function(e){var t,r=this.assert(e);b(this,"message")&&(t=u.prototype.getMessage.bind(this)),void 0!==r&&this.conditionType.when(r,e,this._properties instanceof Function?this._properties.call(e):this._properties,t)},u.prototype.toString=function(){return"string"==typeof this._message?this._message:this.conditionType.message},u}(De)),xt=function(a){function e(e,t,r){void 0===r&&(r=!1);var u,n,i,o;return t.name=t.name||"AllowedValues",t.message=t.message||P.get("allowed-values"),t.source&&(t.source instanceof J||t.source instanceof S?(i=t.source.getPath(),n=t.source,t.onChangeOf=[t.source]):t.source instanceof Function?o=t.source:(i=t.source,t.onChangeOf=[t.source])),t.conditionType||(t.category="Error"),!t.hasOwnProperty("onInitExisting")&&t.conditionType instanceof pe&&"server"===t.conditionType.origin&&(t.onInitExisting=!1),u=a.call(this,e,t,!0)||this,n&&Object.defineProperty(u,"_source",{enumerable:!1,value:n}),i&&Object.defineProperty(u,"_sourcePath",{enumerable:!1,value:i}),o&&Object.defineProperty(u,"_sourceFn",{enumerable:!1,value:o}),t.ignoreValidation&&Object.defineProperty(u,"ignoreValidation",{value:t.ignoreValidation}),r||e.model.registerRule(u),u}return w(e,a),e.prototype.onRegister=function(){this._source||this._sourceFn||(this._source=tt(this._sourcePath,this.rootType,this.rootType.model._allTypesRoot)),a.prototype.onRegister.call(this)},e.prototype.isValid=function(e,t,r){if(this.ignoreValidation)return!0;if(!r)return!0;var u=this.values(e);return r instanceof Array?r.every(function(e){return 0<=u.indexOf(e)}):0<=u.indexOf(r)},e.prototype.values=function(e,t){if(void 0===t&&(t=!1),this._source||this._sourceFn){if(this._sourceFn)return"string"==typeof this._sourceFn&&(this._sourceFn=new Function(this._sourceFn)),this._sourceFn.call(e);if(!(this._source instanceof J&&this._source.isStatic)){var r=e;if(this._source instanceof S&&this._source.getLastTarget(e,t),void 0===r)return;if(null===r)return null}return this._source.value(e)}},e.prototype.toString=function(){return this.property.containingType.fullName+"."+this.property.name+" allowed values = "+this._sourcePath},e}(Ot),Et=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"path",{enumerable:!0,value:t}),ht(e.value).ensureObservable(),Object.defineProperty(this,"__ob__",{configurable:!1,enumerable:!1,value:new pt(this),writable:!1})}return Object.defineProperty(e.prototype,"property",{get:function(){return this.source.value.meta.type.getProperty(this.path)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this.property.label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"helptext",{get:function(){return this.property.helptext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){var e=this.property.value(this.source.value);return jt.call(e),this.__ob__.onPropertyAccess("value",e),e},set:function(e){var t=this.property,r=this.source.value;e instanceof Ee&&bt(e).ensureObservable();var u=r[t.fieldName];t.value(r,e),e!==u&&this.__ob__.onPropertyChange("value",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e=this.property.value(this.source.value);jt.call(e);var t=Tt.call(this,e);return this.__ob__.onPropertyAccess("displayValue",t),t},set:function(e){var t=this.property,r=this.source.value[t.fieldName],u=null!=t.format?t.format.convertBack(e):e;(this.value=u)!==r&&this.__ob__.onPropertyChange("displayValue",e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowedValuesRule",{get:function(){var e;if(b(this,"_allowedValuesRule"))e=this._allowedValuesRule;else{var t=this.property;if(e=t._rules.filter(function(e){return e instanceof xt})[0])Object.defineProperty(this,"_allowedValuesRule",{enumerable:!1,value:e,writable:!0});else if(!this._allowedValuesRuleExistsHandler){var r=Vt.bind(this);Object.defineProperty(this,"_allowedValuesRuleExistsHandler",{enumerable:!1,value:r,writable:!0}),t.ruleRegistered.subscribe(r)}}return this.__ob__.onPropertyAccess("allowedValuesRule",e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowedValuesSource",{get:function(){var e;if(b(this,"_allowedValuesSource"))e=this._allowedValuesSource;else{var t=this.allowedValuesRule;t&&(e=t._source)&&Object.defineProperty(this,"_allowedValuesSource",{enumerable:!1,value:e,writable:!0})}return this.__ob__.onPropertyAccess("allowedValuesSource",e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowedValues",{get:function(){var e;if(b(this,"_allowedValues"))e=this._allowedValues;else{var t=this.property,r=this.allowedValuesRule;if(!r){var u=Vt.bind(this);return Object.defineProperty(this,"_allowedValuesRuleExistsHandler",{enumerable:!1,value:u,writable:!0}),t.ruleRegistered.subscribe(u),this._allowedValues=null,void this.__ob__.onPropertyAccess("allowedValues",null)}var n=this.source.value,i=r.values(n,this.allowedValuesMayBeNull);if(!i){if((a=this.allowedValuesSource)&&!this._allowedValuesExistHandler){var o=function(e){this.property;var t=this.allowedValuesRule,r=this.source.value;if(t.values(r,this.allowedValuesMayBeNull)instanceof Array){var u=this.allowedValuesSource;u&&(!function(e,t,r,u){if(void 0===r&&(r=null),void 0===u&&(u=!1),e instanceof J)s=t,void 0===(c=r)&&(c=null),(a=e)._propertyChangeSubscriptions.forEach(function(e){s===e.handler&&(!c&&!e.context||c&&c===e.context)&&a._events.changedEvent.unsubscribe(e.registeredHandler)});else{if(!(e instanceof S))throw new Error("Invalid property passed to `Property$addChanged(prop)`.");i=t,void 0===(o=r)&&(o=null),(n=e)._propertyChangeSubscriptions.forEach(function(e){i===e.handler&&(!o&&!e.context||o&&o===e.context)&&n._events.changedEvent.unsubscribe(e.registeredHandler)})}var n,i,o,a,s,c}(u,this._allowedValuesExistHandler),delete this._allowedValuesExistHandler),St.call(this)}}.bind(this);Object.defineProperty(this,"_allowedValuesExistHandler",{enumerable:!1,value:o,writable:!0}),ie(a,o,n)}return r.ignoreValidation||Ct.call(this),void(this._allowedValues=null)}if(e=R.create(i.slice()),!this._allowedValuesChangedHandler){var a=this.allowedValuesSource,s=function(e){this.property;var t=this.source.value,r=this.allowedValuesRule,u=r.values(t,this.allowedValuesMayBeNull),n=this._allowedValues;n.batchUpdate(function(e){Y(e,u)}),r.ignoreValidation||Ct.call(this,n);var i=this.__ob__.getPropertyDep("allowedValues");i&&i.notify()}.bind(this);Object.defineProperty(this,"_allowedValuesChangedHandler",{enumerable:!1,value:s,writable:!0}),ie(a,s,n,!0)}r.ignoreValidation||Ct.call(this,e),this._allowedValues=e}return this.__ob__.onPropertyAccess("allowedValues",e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){var e,t=this;if(b(this,"_options"))e=this._options;else{var r=this.allowedValues;if(this._allowedValuesCollectionChangedHandler&&(r.changed.unsubscribe(this._allowedValuesCollectionChangedHandler),delete this._allowedValuesCollectionChangedHandler),r){var u=function(e){var r=this,t=this._allowedValues,u=this._options;if(u){var n=!0;e.changes.forEach(function(e){if(n)if(e.type===F.add){var t=e.items.map(function(e){return new Pt(r,e)});u.splice.apply(u,[e.startIndex,0].concat(t))}else e.type===F.remove?u.splice(e.startIndex,e.items.length):n=!1}),n||(delete this._options,this._allowedValuesCollectionChangedHandler&&(t.changed.unsubscribe(this._allowedValuesCollectionChangedHandler),delete this._allowedValuesCollectionChangedHandler));var i=this.__ob__.getPropertyDep("options");i&&i.notify()}}.bind(this);Object.defineProperty(this,"_allowedValuesCollectionChangedHandler",{enumerable:!1,value:u,writable:!0}),r.changed.subscribe(u)}else this.property.propertyType===Boolean&&(r=R.create([!0,!1]));e=r?r.map(function(e){return new Pt(t,e)}):null,this._options=e}return this.__ob__.onPropertyAccess("options",e),e},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Source['"+this.path+"']"},e}();function jt(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t];r instanceof Ee&&bt(r).ensureObservable()}else e instanceof Ee&&bt(e).ensureObservable()}function Tt(t){var e,r=this.property;if(null==t)e="";else if(null!=r.format){if(Array.isArray(t))e=t.map(function(e){return r.format.convert(e)});else e=r.format.convert(t)}else if(Array.isArray(t)){e=t.map(function(e){return null==t?"":e.toString()})}else e=t.toString();return e=Array.isArray(e)?e.join(", "):e}function St(){delete this._options;var e=this.__ob__.getPropertyDep("options");e&&e.notify()}function Ct(u){var e=this.property,t=this.value;if(u)t instanceof Array?(r=t).batchUpdate(function(e){for(var t=0;t<e.length;t++){var r=e[t];u.indexOf(r)<0&&e.splice(t--,1)}}):null!==t&&u.indexOf(t)<0&&e.value(this.source.value,null);else if(t instanceof Array){var r;(r=t).splice(0,r.length)}else null!==t&&e.value(this.source.value,null)}function Vt(e){e instanceof xt&&(this.property.ruleRegistered.unsubscribe(this._allowedValuesRuleExistsHandler),St.call(this))}var At=function(){function e(e,t){Object.defineProperty(this,"source",{enumerable:!0,value:e}),Object.defineProperty(this,"_index",{enumerable:!1,value:t,writable:!0}),Object.defineProperty(this,"_isOrphaned",{enumerable:!1,value:!1,writable:!0}),Object.defineProperty(this,"__ob__",{configurable:!1,enumerable:!1,value:new pt(this),writable:!1}),this.subscribeToSourceChanges()}return e.prototype.subscribeToSourceChanges=function(){var u=this;R.ensureObservable(this.source.value).changed.subscribe(function(e){var t=u._index,r=u._isOrphaned;e.changes.forEach(function(e){e.type===F.remove?e.startIndex===t?(t=-1,r=!0):e.startIndex<t&&(e.items.length>t-e.startIndex?(t=-1,r=!0):t-=e.items.length):e.type===F.add&&0<=e.startIndex&&e.startIndex<=t&&(t+=e.items.length)}),r!=u._isOrphaned&&(u._isOrphaned=r,u.__ob__.onPropertyChange("isOrphaned",r)),t!=u._index&&(u._index=t,u.__ob__.onPropertyChange("index",t))})},Object.defineProperty(e.prototype,"index",{get:function(){var e=this._index;return this.__ob__.onPropertyAccess("index",e),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOrphaned",{get:function(){return this._isOrphaned},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){var e=this.source.value[this.index];return this.__ob__.onPropertyAccess("value",e),e},set:function(e){var t=this.source.value;if(e!==t[this.index]){t[this.index]=e;var r={entity:this.source.source.value,property:this.source.property,newValue:t,oldValue:void 0};r.changes=[{type:F.replace,startIndex:this.index,endIndex:this.index}],r.collectionChanged=!0,this.source.property._events.changedEvent.publish(this.source.source.value,r),this.__ob__.onPropertyChange("value",e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayValue",{get:function(){var e,t=this.source.value[this.index];return e=null!=this.source.property.format?this.source.property.format.convert(t):t.toString(),this.__ob__.onPropertyAccess("displayValue",e),e},set:function(e){var t=this.source.value[this.index],r=null!=this.source.property.format?this.source.property.format.convertBack(e):e;(this.value=r)!==t&&this.__ob__.onPropertyChange("displayValue",e)},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Source["+this.index+"]"},e}();function It(e){return e instanceof wt||(e instanceof Et||e instanceof At)}function Nt(e,t){var r=e;lt(r,"_source")&&It(r._source)||(r._source=t),lt(e,"$source")||Object.defineProperty(e,"$source",{configurable:!1,enumerable:!0,get:function(){return this._source},set:function(){}})}function Ft(e,t){void 0===t&&(t=!1);var r=e;if(lt(e,"$source"))return null;if(r._source){var u=r._source;return"string"==typeof u?null:u instanceof Ee?u:It(u)?u:null}if(t){var n=r._data;if(n){if(n instanceof Ee)return n.meta.type.fullName,r.$options._componentTag,r._source=n;if(It(n))return r.$options._componentTag,r._source=n}if(r._entity){var i=r._entity;if(i instanceof Ee)return i.meta.type.fullName,r.$options._componentTag,r._source=i}}}function Rt(e,t){void 0===t&&(t=!1);for(var r=null,u=e.$parent,n=1;null!=u;u=u.$parent,n+=1){var i=u,o=i.$source;if(o)return"string"==typeof o||It(o),i.$options._componentTag,u;t&&(void 0===Ft(u,!0)||r||(r=u,n))}if(t&&r&&Ft(r)instanceof Ee)return r.$options._componentTag,r}var qt={props:{source:{},sourceIndex:{type:Number,validator:function(e){return 0<=e}}},beforeCreate:function(){this.$options.propsData&&function(e){var t=e;if(!t._source){var r=e.$options.propsData;lt(r,"source")&&(t._source=r.source)}}(this)},created:function(){var e=this,t=e;It(t._data)&&Nt(e,t._data);e.$options.propsData&&(lt(e.$options.propsData,"source")&&function e(t){var r=t;if(!r._sourcePending&&t.$options.propsData){var u=t.$options.propsData;if(lt(u,"source")){r._sourcePending=!0,r.$options._componentTag,u.source;var n=Rt(t,!0);if(n){var i=n,o=i._source;"string"==typeof o&&(e(n),o=i._source);var a=parseInt(u.source,10);isNaN(a)&&(a=null);var s=null;o instanceof Ee?(o.meta.type.fullName,s=new Et(new wt(o),u.source)):It(o)&&(s=null!==a?new At(o,parseInt(u.source,10)):new Et(o,u.source)),null!=s&&Nt(t,s)}delete r._sourcePending}}}(e))}};function $t(e){var t=Rt(e);if(t.$source){var r=t.$source;It(r)&&Nt(e,r)}}var kt={beforeCreate:function(){var e=this,t=e,r=e.$options.data;t.$options.data=function(){return $t(e),r?r instanceof Function?r.apply(this,arguments):r:{}}},created:function(){this.$source||$t(this)}},Dt=function(){function e(e){e=function(e){void 0===e&&(e=null);var t={createOwnProperties:!1,extendModel:null};e&&(Object.prototype.hasOwnProperty.call(e,"createOwnProperties")&&"boolean"==typeof e.createOwnProperties&&(t.createOwnProperties=e.createOwnProperties),Object.prototype.hasOwnProperty.call(e,"extendModel")&&"function"==typeof e.extendModel&&(t.extendModel=e.extendModel));return t}(e);var t=new Ye(e.createOwnProperties);Object.defineProperty(this,"$meta",{enumerable:!0,value:t}),e.extendModel&&(Object.defineProperty(t,"_ruleQueue",{configurable:!0,enumerable:!1,value:[],writable:!1}),e.extendModel(t),t.registerRules())}return e.install=function(e,t){return function(e){if(null!=nt.Vue)return;var t=new e({data:function(){return{}}}).$data,r=t.__ob__,u=t.__ob__.constructor,n=r.dep.constructor;nt.Vue=e,nt.Observer=u,nt.Dep=n}(e),_t(e)},e.prototype.perform=function(e){qe(e)},e.prototype.onExit=function(e){Fe(e)},e.mixins={SourceProvider:qt,SourceConsumer:kt},e.SourceRootAdapter=wt,e.SourcePathAdapter=Et,e.SourceIndexAdapter=At,e}();var Lt=function(c){function e(e,t,r,u){void 0===u&&(u=!1);var n,i,o=this,a=void 0;if(t||(t=r.name),r){var s=function(r){if(!r)return;var u={};Object.keys(r).filter(function(e){var t=r[e];if("property"===e){if(t instanceof J)return u.property=t,!0}else{if("calculate"!==e&&"fn"!==e)return"defaultIfError"===e?(u.defaultIfError=t,!0):void 0;if(t instanceof Function)return u.calculate=t,!0;if("string"==typeof t)return u.calculate=t,!0}}).forEach(function(e){delete r[e]});return u}(r);s.property&&(n="string"==typeof s.property?e.getProperty(s.property):s.property,r.returns=[n]),t||(t=r.name=e.fullName+"."+("string"==typeof n?n:n.name)+".Calculated"),a=s.defaultIfError,i=s.calculate}return o=c.call(this,e,t,r,!0)||this,Object.defineProperty(o,"property",{enumerable:!0,value:n}),o.defaultIfError=a,i&&Object.defineProperty(o,"_calculateFn",{enumerable:!1,value:i,writable:!0}),u||e.model.registerRule(o),o}return w(e,c),e.prototype.execute=function(e){var t,r;if(this._calculateFn.constructor===String){var u=this._calculateFn,n=new Function("return "+u+";");t=this._calculateFn=n}else t=this._calculateFn;if(void 0===this.defaultIfError)r=t.call(e);else try{r=t.call(e)}catch(e){r=this.defaultIfError}if(void 0!==r)if(this.property.isList){var i=r,o=this.property.value(e);if(i.length===o.length){for(var a=!0,s=0;s<i.length;++s)if(i[s]!==o[s]){a=!1;break}if(a)return}o.batchUpdate(function(e){Y(e,i)})}else this.property.value(e,r,{calculated:!0})},e.prototype.toString=function(){return"calculation of "+this.property.name},e.prototype.onRegister=function(){Qe(this),this.property.isCalculated=!0},e}(De);var Ht=function(n){function u(e,t,r){void 0===r&&(r=!1);var u;return t.name=t.name||"Required",t.message=t.message||P.get("required"),u=n.call(this,e,t,!0)||this,t.requiredValue&&Object.defineProperty(u,"requiredValue",{value:t.requiredValue}),r||e.model.registerRule(u),u}return w(u,n),u.hasValue=function(e){return!(null==e||e.constructor===String&&""===e.trim()||e instanceof Array&&!(0<e.length))},u.prototype.isValid=function(e,t,r){return this.requiredValue?r===this.requiredValue:u.hasValue(r)},u.prototype.toString=function(){return this.property.containingType.fullName+"."+this.property.name+" is required"},u}(Ot),Mt=function(n){function e(e,t,r){void 0===r&&(r=!1);var u;return t.name=t.name||"RequiredIf",!t.onChangeOf&&t.compareSource&&(t.onChangeOf=[t.compareSource]),!t.isRequired&&t.fn&&(t.isRequired=t.fn,t.fn=null),t.isRequired&&(t.message=t.message||P.get("required")),u=n.call(this,e,t,!0)||this,t.isRequired&&Object.defineProperty(u,"_isRequired",{value:t.isRequired,writable:!0}),t.requiredValue&&Object.defineProperty(u,"requiredValue",{value:t.requiredValue}),r||e.model.registerRule(u),u}return w(e,n),e.prototype.assert=function(e){var t;"string"==typeof this._isRequired&&(this._isRequired=new Function(this._isRequired));try{t=this._isRequired.call(e)}catch(e){t=!1}return this.requiredValue?t&&this.property.value(e)!==this.requiredValue:t&&!Ht.hasValue(this.property.value(e))},e}(Ot),Bt=function(i){function e(e,t,r){void 0===r&&(r=!1);var u;if(0!=arguments.length){t.name=t.name||"Range";var n=t.property instanceof J?t.property:e.getProperty(t.property);return!t.min||t.min instanceof Function||"string"==typeof t.min||n.propertyType!==Date||(t.min=new Date(t.min)),!t.max||t.max instanceof Function||"string"==typeof t.max||n.propertyType!==Date||(t.max=new Date(t.max)),null===t.min&&(t.min=void 0),null===t.max&&(t.max=void 0),u=i.call(this,e,t,!0)||this,Object.defineProperty(u,"_min",{value:t.min,writable:!0}),Object.defineProperty(u,"_max",{value:t.max,writable:!0}),r||e.model.registerRule(u),u}}return w(e,i),e.prototype.range=function(e){if(this._min&&!(this._min instanceof Function))if("string"==typeof this._min)this._min=new Function(this._min);else{var t=this._min;this._min=function(){return t}}if(this._max&&!(this._max instanceof Function))if("string"==typeof this._max)this._max=new Function(this._max);else{var r=this._max;this._max=function(){return r}}var u={};if(this._min&&this._min instanceof Function)try{u.min=this._min.call(e)}catch(e){}if(this._max&&this._max instanceof Function)try{u.max=this._max.call(e)}catch(e){}return u.min=null==u.min?void 0:u.min,u.max=null==u.max?void 0:u.max,u},e.prototype.isValid=function(e,t,r){var u=this.range(e);return null==r||(void 0===u.min||r>=u.min)&&(void 0===u.max||r<=u.max)},e.prototype.getMessage=function(e){var t=this.range(e);return(void 0!==t.min&&void 0!==t.max?P.get("range-between").replace("{min}",X(this.property,t.min)||t.min).replace("{max}",X(this.property,t.max)||t.max):this.property.propertyType===Date?void 0!==t.min?P.get("range-on-or-after").replace("{min}",X(this.property,t.min)||t.min):P.get("range-on-or-before").replace("{max}",X(this.property,t.max)||t.max):void 0!==t.min?P.get("range-at-least").replace("{min}",X(this.property,t.min)||t.min):P.get("range-at-most").replace("{max}",X(this.property,t.max)||t.max)).replace("{property}",this.property.label)},e.prototype.toString=function(){return this.property.containingType.fullName+"."+this.property.name+" in range, min: , max: "},e}(Ot),Qt=function(o){function e(e,t,r){void 0===r&&(r=!1);var u;t.name=t.name||"StringLength",t.message=t.message||(t.min&&t.max?P.get("string-length-between").replace("{min}",t.min).replace("{max}",t.max):t.min?P.get("string-length-at-least").replace("{min}",t.min):P.get("string-length-at-most").replace("{max}",t.max));var n=t.min;delete t.min;var i=t.max;return delete t.max,u=o.call(this,e,t,!0)||this,Object.defineProperty(u,"_min",{value:n}),Object.defineProperty(u,"_max",{value:i}),r||e.model.registerRule(u),u}return w(e,o),e.prototype.isValid=function(e,t,r){return!r||""===r||(!this._min||r.length>=this._min)&&(!this._max||r.length<=this._max)},e.prototype.toString=function(){return this.property.containingType.fullName+"."+this.property.name+" in range, min: , max: "},e}(Bt),Ut=function(n){function e(e,t,r){void 0===r&&(r=!1);var u;if(0!=arguments.length)return t.name=t.name||"StringFormat",P.get(t.message)?t.message=P.get(t.message):t.message=t.message||P.get("string-format").replace("{formatDescription}",t.description),u=n.call(this,e,t,!0)||this,Object.defineProperty(u,"description",{value:t.description}),Object.defineProperty(u,"expression",{value:t.expression instanceof RegExp?t.expression:RegExp(t.expression)}),Object.defineProperty(u,"reformat",{value:t.reformat}),r||e.model.registerRule(u),u}return w(e,n),e.prototype.isValid=function(e,t,r){var u=!0;return r&&""!=r&&(this.expression.lastIndex=0,(u=this.expression.test(r))&&this.reformat&&(r=this.reformat instanceof Function?this.reformat(r):(this.expression.lastIndex=0,r.replace(this.expression,this.reformat)),t.value(e,r))),u},e.prototype.toString=function(){return this.property.containingType.fullName+"."+this.property.name+" formatted as "+this.description},e}(Ot),Wt=function(o){function e(e,t,r){void 0===r&&(r=!1);var u;t.name=t.name||"ListLength";var n=t.min;delete t.min;var i=t.max;return delete t.max,u=o.call(this,e,t,!0)||this,Object.defineProperty(u,"_min",{value:n}),Object.defineProperty(u,"_max",{value:i}),r||e.model.registerRule(u),u}return w(e,o),e.prototype.isValid=function(e,t,r){var u=this.range(e);return null==r||(!u.min||r.length>=u.min)&&(!u.max||r.length<=u.max)},e.prototype.getMessage=function(e){var t=this.range(e);return(t.min&&t.max?P.get("listlength-between").replace("{min}",X(this.property,t.min)||t.min).replace("{max}",X(this.property,t.max)||t.max):t.min?P.get("listlength-at-least").replace("{min}",X(this.property,t.min)||t.min):P.get("listlength-at-most").replace("{max}",X(this.property,t.max)||t.max)).replace("{property}",this.property.label)},e}(Bt);function Zt(e,t,r){return t.property=e,r&&r.constructor===String?t.message=r:r instanceof pe&&(t.conditionType=r),t}return function(e,t){for(var r in t)b(t,r)&&t[r]instanceof Function&&(e.prototype[r]=t[r])}(J,{calculated:function(e){e.property=this;var t=e.rootType?e.rootType.meta:this.containingType;return delete e.rootType,new Lt(t,e.name,e),this},conditionIf:function(e,t){var r=e.rootType?e.rootType.meta:this.containingType;return delete e.rootType,e=Zt(this,e,t),new Ot(r,e),this},required:function(e){var t=Zt(this,{},e);return new Ht(this.containingType,t),this},requiredIf:function(e,t){var r=e.rootType?e.rootType.meta:this.containingType;delete e.rootType;e=Zt(this,e,t);return new Mt(r,e),this},allowedValues:function(e,t){var r=Zt(this,{source:e},t);return new xt(this.containingType,r),this},optionValues:function(e,t){var r=Zt(this,{source:e,onInit:!1,onInitNew:!1,onInitExisting:!1},t);return r.ignoreValidation=!0,new xt(this.containingType,r),this},range:function(e,t,r){var u=Zt(this,{min:e,max:t},r);return new Bt(this.containingType,u),this},stringLength:function(e,t,r){var u=Zt(this,{min:e,max:t},r);return new Qt(this.containingType,u),this},stringFormat:function(e,t,r,u){var n=Zt(this,{description:e,expression:t,reformat:r},u);return new Ut(this.containingType,n),this},listLength:function(e,t,r){var u=Zt(this,{min:e,max:t},r);return new Wt(this.containingType,u),this}}),Dt});
